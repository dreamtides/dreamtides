{"id":"dr-2jd","title":"CLI Framework","description":"Implement the CLI framework layer for Lattice: argument parsing, command dispatch, output formatting, and color theme.\n\n## Scope\n\n- **Argument Parser**: Clap-based command definitions for all `lat` subcommands\n- **Command Dispatch**: Route parsed arguments to command implementations with startup operations hook\n- **Output Formatting**: Text/JSON/pretty output helpers with consistent document reference format\n- **Color Theme**: Ayu color palette with terminal detection and semantic coloring\n\n## Status\n\n- C5 (Global Options) is already implemented in `@rules_engine/src/lattice/src/cli/global_options.rs`\n- Files exist as stubs for C1-C4; implementation needed\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/lattice_design.md#command-overview\n- @rules_engine/docs/lattice/appendix_cli_structure.md\n- @rules_engine/docs/lattice/appendix_file_layout.md (cli/ section)\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/argument_parser.rs`\n- `@rules_engine/src/lattice/src/cli/command_dispatch.rs`\n- `@rules_engine/src/lattice/src/cli/output_format.rs`\n- `@rules_engine/src/lattice/src/cli/color_theme.rs`","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-16T21:09:29.278535-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:11:57.100003-08:00","closed_at":"2026-01-16T21:11:57.100003-08:00","close_reason":"Recreating as hierarchical children of dr-epv","labels":["lattice"],"dependencies":[{"issue_id":"dr-2jd","depends_on_id":"dr-beu","type":"blocks","created_at":"2026-01-16T21:10:21.141438-08:00","created_by":"dthurn"},{"issue_id":"dr-2jd","depends_on_id":"dr-in8","type":"blocks","created_at":"2026-01-16T21:10:35.652093-08:00","created_by":"dthurn"},{"issue_id":"dr-2jd","depends_on_id":"dr-5hf","type":"blocks","created_at":"2026-01-16T21:10:50.959154-08:00","created_by":"dthurn"},{"issue_id":"dr-2jd","depends_on_id":"dr-did","type":"blocks","created_at":"2026-01-16T21:11:04.493782-08:00","created_by":"dthurn"}]}
{"id":"dr-5hf","title":"Implement Argument Parser","description":"Implement Clap-based argument parsing for all `lat` subcommands.\n\n## Scope\n\n- Define main `Lat` CLI struct with Clap derive macros\n- Define all subcommands with their arguments per CLI spec\n- Set up global options: `--json`, `--verbose`, `--quiet`, `--help`, `--version`\n- Configure environment variable bindings (`LATTICE_LOG_LEVEL`, etc.)\n- Include subcommands: show, create, update, close, reopen, prune, list, ready, search, stale, blocked, changes, stats, tree, roots, children, dep, label, links-from, links-to, path, orphans, impact, claim, overview, prime, track, generate-ids, split, mv, edit, fmt, check, doctor, setup, completion, chaosmonkey\n\n## Implementation Notes\n\n- Use Clap's derive API (`Parser`, `Subcommand`, `Args`)\n- Flatten `GlobalOptions` into each command\n- Group related arguments (e.g., filter options as a shared Args struct)\n- Add help text and examples for each command\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/appendix_cli_structure.md (complete command list)\n- @rules_engine/docs/lattice/lattice_design.md#command-overview\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/argument_parser.rs`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:10:46.946145-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:11:57.151118-08:00","closed_at":"2026-01-16T21:11:57.151118-08:00","close_reason":"Recreating as hierarchical children of dr-epv","labels":["lattice"],"dependencies":[{"issue_id":"dr-5hf","depends_on_id":"dr-in8","type":"blocks","created_at":"2026-01-16T21:10:50.897078-08:00","created_by":"dthurn"}]}
{"id":"dr-beu","title":"Implement Color Theme","description":"Implement the Ayu color theme for Lattice CLI output.\n\n## Scope\n\n- Define Ayu color palette constants:\n  - Green for success states\n  - Yellow for warnings\n  - Red for errors\n  - Blue for accent/highlighting\n  - Gray for muted/secondary text\n- Implement terminal detection for color support\n- Support `LATTICE_NO_COLOR` environment variable\n- Create semantic coloring functions for common output patterns\n\n## Implementation Notes\n\n- Use a crate like `termcolor` or `owo-colors` for cross-platform terminal colors\n- Detect TTY vs piped output to disable colors when not interactive\n- Provide fallback for terminals without color support\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/lattice_design.md#ui-design\n- @rules_engine/docs/lattice/appendix_cli_structure.md#environment-variables\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/color_theme.rs`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:10:16.746851-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:11:57.118111-08:00","closed_at":"2026-01-16T21:11:57.118111-08:00","close_reason":"Recreating as hierarchical children of dr-epv","labels":["lattice"]}
{"id":"dr-did","title":"Implement Command Dispatch","description":"Implement command dispatch to route parsed arguments to handler functions.\n\n## Scope\n\n- Match parsed commands to handler functions\n- Thread context (GitOps, Index) through handlers\n- Implement startup operations hook (runs before each command)\n- Map results to exit codes per error handling spec\n- Implement hidden `--no-startup` flag for debugging\n\n## Startup Operations Hook\n\nPer @rules_engine/docs/lattice/appendix_startup_operations.md:\n- Index reconciliation\n- Skill symlink sync\n- Claim cleanup\n- Log rotation\n- Performance budget: \u003c100ms total; emit debug log if exceeded\n\n## Implementation Notes\n\n- Create a `CommandContext` struct holding shared state (GitOps, Index, Config)\n- Each command handler receives context and returns `LatticeResult\u003c()\u003e`\n- Convert `LatticeError` to appropriate exit codes\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/appendix_startup_operations.md\n- @rules_engine/docs/lattice/appendix_error_handling.md (exit codes)\n- @rules_engine/docs/lattice/appendix_cli_structure.md#exit-codes\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/command_dispatch.rs`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:10:59.832021-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:11:57.168048-08:00","closed_at":"2026-01-16T21:11:57.168048-08:00","close_reason":"Recreating as hierarchical children of dr-epv","labels":["lattice"],"dependencies":[{"issue_id":"dr-did","depends_on_id":"dr-5hf","type":"blocks","created_at":"2026-01-16T21:11:04.42939-08:00","created_by":"dthurn"}]}
{"id":"dr-epv","title":"Lattice Document System Implementation","description":"Lattice is a unified knowledge base and task tracking system built on markdown files stored in git repositories, with SQLite providing an ephemeral index for query performance.\n\n## Core Innovation\n\nLattice treats markdown documents as first-class database entities while maintaining full git compatibility and human readability. Documents can exist anywhere in a project hierarchy, colocated with relevant code, and are identified by their `lattice-id` YAML annotation rather than filesystem location.\n\n## Design Philosophy\n\n- **Document Atomicity**: 500-line soft limit encourages focused documentation\n- **Git as Source of Truth**: SQLite serves exclusively as a performance cache\n- **Bulletproof Self-Healing**: Graceful error recovery with clear human-readable messages\n- **No Background Daemons**: Maintenance operations run opportunistically before commands\n\n## Key Features\n\n- YAML frontmatter for metadata (lattice-id, name, description, task tracking)\n- ID-based linking with automatic path resolution via `lat fmt`\n- Task tracking (bug/feature/task/chore) with blocking/blocked-by dependencies\n- Filesystem-based state: open tasks vs `.closed/` directory\n- Claude Skill integration (documents with `skill: true` become Skills)\n- Full-text search via FTS5\n- Comprehensive linting and validation\n\n## Design Documents\n\nMain design: @rules_engine/docs/lattice/lattice_design.md\n\n### Core Systems\n- ID System: @rules_engine/docs/lattice/appendix_id_system.md\n- Indexing: @rules_engine/docs/lattice/appendix_indexing.md\n- Linking System: @rules_engine/docs/lattice/appendix_linking_system.md\n- Error Handling: @rules_engine/docs/lattice/appendix_error_handling.md\n\n### Task \u0026 Workflow\n- Task Tracking: @rules_engine/docs/lattice/appendix_task_tracking.md\n- Task Templates: @rules_engine/docs/lattice/appendix_task_templates.md\n- Workflow Commands: @rules_engine/docs/lattice/appendix_workflow.md\n- Overview Command: @rules_engine/docs/lattice/appendix_overview_command.md\n\n### CLI \u0026 Validation\n- CLI Structure: @rules_engine/docs/lattice/appendix_cli_structure.md\n- Linter Rules: @rules_engine/docs/lattice/appendix_linter.md\n- Doctor Command: @rules_engine/docs/lattice/appendix_doctor.md\n\n### Integration\n- Git Integration: @rules_engine/docs/lattice/appendix_git_integration.md\n- Git Edge Cases: @rules_engine/docs/lattice/appendix_git_edge_cases.md\n- AI Integration: @rules_engine/docs/lattice/appendix_ai_integration.md\n- Configuration: @rules_engine/docs/lattice/appendix_configuration.md\n\n### Operations\n- Startup Operations: @rules_engine/docs/lattice/appendix_startup_operations.md\n- File Layout: @rules_engine/docs/lattice/appendix_file_layout.md\n\n### Testing \u0026 Quality\n- Testing Strategy: @rules_engine/docs/lattice/appendix_testing_strategy.md\n- Benchmarking: @rules_engine/docs/lattice/appendix_benchmarking.md\n- Chaos Monkey: @rules_engine/docs/lattice/appendix_chaos_monkey.md\n- Code Review: @rules_engine/docs/lattice/appendix_code_review.md\n\n## Implementation Location\n\nSource code: @rules_engine/src/lattice/\n\nThis epic serves as the parent for all Lattice implementation work. Child tasks should be created with `--parent` referencing this epic.\n","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2026-01-15T16:13:50.275342-08:00","created_by":"dthurn","updated_at":"2026-01-15T16:21:16.166011-08:00","labels":["test2"],"dependencies":[{"issue_id":"dr-epv","depends_on_id":"dr-2jd","type":"blocks","created_at":"2026-01-16T21:09:48.380835-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1","title":"Foundation: Core types, error handling, logging, configuration","description":"Core infrastructure that all other Lattice modules depend on. This feature must be completed before any other work can begin.\n\n## Scope\n\n- Error types and handling patterns (`LatticeError` enum)\n- Lattice ID system (generation, validation, encoding)\n- JSONL logging infrastructure\n- Configuration loading (layered: defaults → user → repo → env → CLI)\n\n## Design References\n\n- Error handling: @rules_engine/docs/lattice/appendix_error_handling.md\n- ID system: @rules_engine/docs/lattice/appendix_id_system.md\n- Configuration: @rules_engine/docs/lattice/appendix_configuration.md\n- Main design: @rules_engine/docs/lattice/lattice_design.md\n\n## Exports\n\n- `LatticeId` type with parsing/validation\n- `LatticeError` enum with all variants\n- `LatticeResult\u003cT\u003e` type alias\n- Logging macros and JSONL writer\n- `Config` struct with layered loading\n","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-15T16:15:55.629387-08:00","created_by":"dthurn","updated_at":"2026-01-16T12:54:00.426565-08:00","closed_at":"2026-01-16T12:54:00.426565-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-15T16:15:55.630127-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1.1","title":"Error Types: LatticeError enum and error handling infrastructure","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nDefine the error handling infrastructure for Lattice, distinguishing between user errors (recoverable) and system errors (panics).\n\n## Files to Create\n\n- `error/error_types.rs` - `LatticeError` enum with all variants\n- `error/error_formatting.rs` - `Display` and `Error` trait implementations\n- `error/exit_codes.rs` - Exit code constants (0=success, 1=system, 2=validation, 3=user, 4=not found)\n- `error/structured_output.rs` - JSON error serialization for `--json` mode\n\n## Implementation Notes\n\n- Use `thiserror` crate for derive macros\n- Integrate `human-panic` crate for panic formatting\n- Follow the expected/unexpected error distinction from design doc\n- Provide clear guidance messages for user errors\n- Log extensively for system errors\n\n## Design Reference\n\n- @rules_engine/docs/lattice/appendix_error_handling.md (complete error taxonomy)\n- @rules_engine/docs/lattice/lattice_design.md#error-handling\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T16:16:12.921579-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:41.841755-08:00","closed_at":"2026-01-16T06:47:42.954929-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1.1","depends_on_id":"dr-epv.1","type":"parent-child","created_at":"2026-01-15T16:16:12.922222-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1.2","title":"ID System: LatticeId type with generation and validation","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the Lattice ID system: compact, human-typeable identifiers using Base32 encoding.\n\n## Files to Create\n\n- `id/lattice_id.rs` - `LatticeId` newtype with validation\n- `id/base32_encoding.rs` - RFC 4648 Base32 encoding/decoding (alphabet: A-Z, 2-7)\n- `id/id_generator.rs` - Document counter and ID generation\n- `id/client_selection.rs` - Client ID generation with length scaling\n\n## ID Format\n\n- Structure: `L` prefix + Base32 document counter + Base32 client ID\n- Example: `LK3DTX` (document 675, client DTX)\n- Minimum 6 characters total\n- Counter starts at 50 to ensure 6+ char IDs\n\n## Implementation Notes\n\n- Validate: minimum 6 chars, valid Base32, `L` prefix\n- Client ID length scales with known client count (3-6 chars)\n- Counter recovery: scan existing documents on repo re-clone to find highest counter per client\n- Use `LatticeError` for validation failures\n\n## Design Reference\n\n- @rules_engine/docs/lattice/appendix_id_system.md (generation algorithm, collision handling)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T16:16:22.976198-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:41.921119-08:00","closed_at":"2026-01-16T10:45:29.574672-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1.2","depends_on_id":"dr-epv.1","type":"parent-child","created_at":"2026-01-15T16:16:22.976848-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.1.2","depends_on_id":"dr-epv.1.1","type":"blocks","created_at":"2026-01-15T16:16:44.767351-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1.3","title":"Logging: JSONL logging infrastructure with tracing","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement JSONL-based logging infrastructure using the tracing crate.\n\n## Files to Create\n\n- `log/jsonl_writer.rs` - JSONL file writer with rotation\n- `log/log_entry.rs` - Log entry struct (timestamp, level, operation, duration, details)\n- `log/log_reader.rs` - Log file reading utilities for debugging\n\n## Logging Behavior\n\n- Write to `.lattice/logs.jsonl`\n- Log rotation: rename to `.1` when \u003e10MB\n- Support `--verbose` flag for debug output to stderr\n- All git/SQLite/file operations must be logged\n\n## Implementation Notes\n\n- Configure `tracing` crate with custom JSONL subscriber\n- Structured logging for git operations, SQLite queries, file I/O\n- Include operation duration for performance tracking\n- Silent failure is a critical design flaw - log everything\n\n## Design Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#logging\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T16:16:31.260375-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:41.998323-08:00","closed_at":"2026-01-16T12:01:59.386101-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1.3","depends_on_id":"dr-epv.1","type":"parent-child","created_at":"2026-01-15T16:16:31.261082-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.1.3","depends_on_id":"dr-epv.1.2","type":"blocks","created_at":"2026-01-15T16:16:44.804667-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1.4","title":"Configuration: Layered config loading from multiple sources","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement layered configuration loading with precedence: defaults → user → repo → env vars → CLI flags.\n\n## Files to Create\n\n- `config/config_loader.rs` - Layered configuration loading logic\n- `config/config_schema.rs` - `Config` struct with all configuration fields\n- `git/client_config.rs` - Client ID storage and retrieval\n\n## Configuration Sources (in precedence order)\n\n1. Built-in defaults\n2. `~/.lattice.toml` - User config (client IDs, personal defaults)\n3. `.lattice/config.toml` - Repo config (overview weights, format settings)\n4. Environment variables (`LATTICE_*`)\n5. CLI flags (highest precedence)\n\n## Implementation Notes\n\n- Use TOML format for config files\n- All fields should have sensible defaults\n- Log config loading with sources for debugging\n- Handle missing config files gracefully\n- Validate config values are in acceptable ranges\n\n## Design Reference\n\n- @rules_engine/docs/lattice/appendix_configuration.md (complete field list and defaults)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T16:16:38.741186-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:42.075871-08:00","closed_at":"2026-01-16T12:14:23.480445-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1.4","depends_on_id":"dr-epv.1","type":"parent-child","created_at":"2026-01-15T16:16:38.74182-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.1.4","depends_on_id":"dr-epv.1.3","type":"blocks","created_at":"2026-01-15T16:16:44.841773-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.10","title":"Task System","description":"# Task System Feature\n\nImplement task management types, states, and dependency tracking for the Lattice document system.\n\n## Scope\n\n- Task type enumeration (bug, feature, task, chore)\n- Priority levels (P0-P4)\n- Task state computation from filesystem location (open/blocked/closed)\n- Ready work calculation for identifying actionable tasks\n- Dependency graph for blocking relationships and cycle detection\n- Closed directory path utilities for `.closed/` handling\n- Root document detection (filename matches directory)\n- Directory structure validation (`tasks/` and `docs/` placement)\n\n## External Dependencies\n\n- Foundation (for error types, ID types)\n- Document Model (for frontmatter parsing)\n- Index Core (for querying document metadata)\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/lattice_design.md#task-tracking\n- @rules_engine/docs/lattice/appendix_task_tracking.md\n- @rules_engine/docs/lattice/appendix_file_layout.md#task","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2026-01-17T16:54:42.002786-08:00","created_by":"dthurn","updated_at":"2026-01-17T16:57:12.627297-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.10","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-17T16:54:42.003514-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.10.1","title":"Task Types and Priority Enums","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n# Task Types and Priority Enums\n\nImplement foundational type definitions for task categorization and prioritization.\n\n## Implementation Files\n\n- `@rules_engine/src/lattice/src/task/task_types.rs`\n- `@rules_engine/src/lattice/src/task/task_priority.rs`\n\n## TaskType Enum\n\n- `Bug`: Defects and regressions\n- `Feature`: User-facing capabilities\n- `Task`: Tests, documentation, refactoring\n- `Chore`: Dependencies, tooling updates\n\n## Priority Enum (P0-P4)\n\n- P0: Critical (security, data loss, broken builds)\n- P1: High (major features, important bugs)\n- P2: Medium (default priority)\n- P3: Low (polish, optimization)\n- P4: Backlog (future ideas, excluded from `lat ready`)\n\n## Requirements\n\n- Implement `FromStr` and `Display` traits for parsing from YAML\n- Serialize/deserialize via serde for index storage\n- Priority should implement `Ord` for sorting (lower number = higher priority)\n- Support both numeric (\"2\") and prefixed (\"P2\") parsing formats\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_task_tracking.md#task-types\n- @rules_engine/docs/lattice/appendix_task_tracking.md#priority\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:55:07.780025-08:00","created_by":"dthurn","updated_at":"2026-01-17T19:06:12.853303-08:00","closed_at":"2026-01-17T19:06:12.853303-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.10.1","depends_on_id":"dr-epv.10","type":"parent-child","created_at":"2026-01-17T16:55:07.780808-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.10.2","title":"Task State Computation","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n# Task State Computation\n\nImplement task state determination from filesystem location and blocker analysis.\n\n## Implementation File\n\n- `@rules_engine/src/lattice/src/task/task_state.rs`\n\n## TaskState Enum\n\n- `Open`: Not in `.closed/` directory and not blocked\n- `Blocked`: Not in `.closed/` but has open (non-closed) `blocked-by` entries\n- `Closed`: Resides in a `.closed/` subdirectory\n\n## State Computation Logic\n\n- Check if document path contains `/.closed/` segment → Closed\n- Check `blocked-by` field: any entry referencing non-closed task → Blocked\n- Otherwise → Open\n\n## Requirements\n\n- Function to compute state from path alone (for fast path checks)\n- Function to compute state with blocker resolution (requires index queries)\n- State determines appearance in `lat ready` output\n- No `in_progress` state - use claim system for work tracking\n\n## Edge Cases\n\n- Empty `blocked-by` field → not blocked\n- All `blocked-by` entries closed → not blocked\n- Mixed closed/open blockers → still blocked\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_task_tracking.md#task-state\n- @rules_engine/docs/lattice/lattice_design.md#task-tracking\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:55:18.825693-08:00","created_by":"dthurn","updated_at":"2026-01-17T19:53:18.959741-08:00","closed_at":"2026-01-17T19:53:18.959741-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.10.2","depends_on_id":"dr-epv.10","type":"parent-child","created_at":"2026-01-17T16:55:18.826497-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.10.2","depends_on_id":"dr-epv.10.1","type":"blocks","created_at":"2026-01-17T16:55:23.954023-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.10.3","title":"Ready Calculator","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n# Ready Calculator\n\nImplement logic to determine which tasks are available for work.\n\n## Implementation File\n\n- `@rules_engine/src/lattice/src/task/ready_calculator.rs`\n\n## Ready Criteria\n\nA task is \"ready\" when ALL conditions are met:\n- Not closed (not in `.closed/` directory)\n- Not blocked (no open entries in `blocked-by`)\n- Priority is not P4 (backlog items excluded by default)\n- Not claimed by any worktree\n\n## Query Interface\n\n- Build index filter query from ready criteria\n- Support optional filters: `--include-backlog` (allow P4), `--include-claimed`\n- Support parent path filtering for directory-scoped queries\n\n## Sort Policies\n\n- `hybrid`: Balance priority, age, and recency (default)\n- `priority`: Strict priority ordering (P0 first)\n- `oldest`: Creation date ordering\n\n## Integration Points\n\n- Uses Task State for open/blocked determination\n- Uses Dependency Graph for blocker resolution\n- Queries Claim System to exclude claimed tasks (external dependency)\n- Returns list of ready task IDs/rows for `lat ready` command\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_task_tracking.md\n- @rules_engine/docs/lattice/appendix_workflow.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:55:35.865109-08:00","created_by":"dthurn","updated_at":"2026-01-17T20:50:32.321304-08:00","closed_at":"2026-01-17T20:50:32.321304-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.10.3","depends_on_id":"dr-epv.10","type":"parent-child","created_at":"2026-01-17T16:55:35.865936-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.10.3","depends_on_id":"dr-epv.10.2","type":"blocks","created_at":"2026-01-17T16:55:39.498039-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.10.4","title":"Dependency Graph","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n# Dependency Graph\n\nImplement graph structure for task blocking relationships with cycle detection.\n\n## Implementation File\n\n- `@rules_engine/src/lattice/src/task/dependency_graph.rs`\n\n## Graph Construction\n\n- Build from `blocking` and `blocked-by` frontmatter fields\n- Bidirectional edge representation: A blocks B ↔ B blocked-by A\n- Support incremental updates when documents change\n\n## Cycle Detection\n\n- DFS-based back-edge detection\n- Return cycle path on detection for error reporting (E006)\n- Validate graph on document update before persisting\n\n## Query Operations\n\n- Get all blockers for a task (transitive closure optional)\n- Get all blocked tasks (what does this task block?)\n- Topological ordering for impact analysis\n- Dependency tree traversal for `lat dep tree` output\n\n## Tree Display\n\n- Visual tree format showing upstream (depends-on) and downstream (blocks)\n- State indicators for each node (open/blocked/closed)\n- Depth limiting for large graphs\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_task_tracking.md#dependencies\n- @rules_engine/docs/lattice/appendix_linter.md (E006 circular blocking)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:55:50.767414-08:00","created_by":"dthurn","updated_at":"2026-01-17T21:16:59.355081-08:00","closed_at":"2026-01-17T21:16:59.355081-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.10.4","depends_on_id":"dr-epv.10","type":"parent-child","created_at":"2026-01-17T16:55:50.768199-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.10.4","depends_on_id":"dr-epv.10.3","type":"blocks","created_at":"2026-01-17T16:55:54.244532-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.10.5","title":"Closed Directory Utilities","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n# Closed Directory Utilities\n\nImplement path manipulation utilities for `.closed/` directory handling.\n\n## Implementation File\n\n- `@rules_engine/src/lattice/src/task/closed_directory.rs`\n\n## Core Functions\n\n- `is_in_closed(path)`: Check if path contains `/.closed/` segment\n- `closed_path_for(task_path)`: Compute `.closed/` destination path\n  - Example: `auth/tasks/foo.md` → `auth/tasks/.closed/foo.md`\n- `unclosed_path_for(closed_path)`: Reverse - compute original location\n  - Example: `auth/tasks/.closed/foo.md` → `auth/tasks/foo.md`\n- `ensure_closed_dir(parent_path)`: Create `.closed/` directory if needed\n\n## Path Validation\n\n- Closed directory must be immediate child of `tasks/` directory\n- Validate path structure before move operations\n- Handle edge case: nested `.closed/` directories (error)\n\n## Integration Points\n\n- Used by `lat close` to move tasks to closed directory\n- Used by `lat reopen` to move tasks back out\n- Used by Task State to determine closed status from path\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_task_tracking.md#the-closed-directory\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:56:04.085565-08:00","created_by":"dthurn","updated_at":"2026-01-17T21:45:46.836244-08:00","closed_at":"2026-01-17T21:45:46.836244-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.10.5","depends_on_id":"dr-epv.10","type":"parent-child","created_at":"2026-01-17T16:56:04.086368-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.10.5","depends_on_id":"dr-epv.10.4","type":"blocks","created_at":"2026-01-17T16:56:07.640507-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.10.6","title":"Root Detection","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n# Root Detection\n\nImplement logic to detect root documents and compute parent relationships.\n\n## Implementation File\n\n- `@rules_engine/src/lattice/src/task/root_detection.rs`\n\n## Root Document Definition\n\nA root document has a filename (without `.md`) matching its directory name:\n- `api/api.md` → root (filename \"api\" matches directory \"api\")\n- `auth/auth.md` → root\n- `auth/tasks/login.md` → NOT root (filename \"login\" ≠ directory \"tasks\")\n\n## Core Functions\n\n- `is_root_document(path)`: Check if document is a root\n- `find_root_for(path)`: Find the root document for a directory\n- `compute_parent_id(doc_path)`: Get parent-id from directory's root document\n\n## Hierarchy Queries\n\n- Walk up directory tree to find enclosing root documents\n- Support queries for ancestor chain (for template composition)\n- Handle nested directories (e.g., `api/v2/v2.md` under `api/api.md`)\n\n## Integration Points\n\n- Used by `lat fmt` to auto-populate `parent-id` field\n- Used by `lat create` to set parent-id on new documents\n- Populates `directory_roots` index table for hierarchy queries\n- Used by Template System for ancestor traversal\n\n## Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#root-documents-and-hierarchy\n- @rules_engine/docs/lattice/appendix_task_tracking.md#filesystem-hierarchy\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:56:19.313817-08:00","created_by":"dthurn","updated_at":"2026-01-17T22:12:37.546816-08:00","closed_at":"2026-01-17T22:12:37.546816-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.10.6","depends_on_id":"dr-epv.10","type":"parent-child","created_at":"2026-01-17T16:56:19.314579-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.10.6","depends_on_id":"dr-epv.10.5","type":"blocks","created_at":"2026-01-17T16:56:23.469747-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.10.7","title":"Directory Structure Validation","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n# Directory Structure Validation\n\nImplement validation for `tasks/` and `docs/` directory placement rules.\n\n## Implementation File\n\n- `@rules_engine/src/lattice/src/task/directory_structure.rs`\n\n## Validation Rules\n\nDocuments must be in one of these locations:\n- Root document (filename matches directory name)\n- `tasks/` subdirectory (for task documents with `task-type`)\n- `docs/` subdirectory (for knowledge base documents without `task-type`)\n\n## Validation Functions\n\n- `validate_location(doc_path, has_task_type)`: Check placement is valid\n- `expected_location(doc_path, has_task_type)`: Suggest correct location\n- `is_in_tasks_dir(path)`: Check if path is under `tasks/`\n- `is_in_docs_dir(path)`: Check if path is under `docs/`\n\n## Lint Rule Support\n\nProvides logic for structure-related warnings:\n- W017: Document not in standard location (root, tasks/, or docs/)\n- W018: Task document found in docs/ directory\n- W019: Knowledge base document found in tasks/ directory\n\n## Edge Cases\n\n- Root documents at any depth (not just top-level)\n- Nested `tasks/` or `docs/` directories (allowed)\n- `.closed/` subdirectory under `tasks/` (valid for closed tasks)\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_task_tracking.md#filesystem-hierarchy\n- @rules_engine/docs/lattice/appendix_linter.md (W017-W019)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:56:35.212536-08:00","created_by":"dthurn","updated_at":"2026-01-17T22:37:57.625272-08:00","closed_at":"2026-01-17T22:37:57.625272-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.10.7","depends_on_id":"dr-epv.10","type":"parent-child","created_at":"2026-01-17T16:56:35.213321-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.10.7","depends_on_id":"dr-epv.10.6","type":"blocks","created_at":"2026-01-17T16:56:38.832543-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.10.8","title":"Task System Post-Implementation Review","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n# Task System Post-Implementation Review\n\nPerform structural review of the Task System feature implementation.\n\n## Review Questions\n\n### 1. Scope Completeness\n\nReview @rules_engine/docs/lattice/lattice_implementation_plan.md Task System section:\n\n- Was the implementation plan scope complete?\n- Are there items that should have been included but were not implemented?\n- Are there missing capabilities required by downstream features?\n- Do Ready Calculator and Dependency Graph fully support Query Commands?\n- Does Root Detection fully support Template System requirements?\n\n### 2. Specification Conformance\n\nReview @rules_engine/docs/lattice/appendix_task_tracking.md for full spec:\n\n- Does TaskType enum cover all specified types with correct semantics?\n- Does Priority enum support all parsing formats (numeric and prefixed)?\n- Does Task State correctly handle all edge cases for blocking?\n- Does Ready Calculator implement all sort policies?\n- Does Dependency Graph detect cycles correctly?\n- Do path utilities handle all directory structure variations?\n\n## Required Actions\n\nFor any identified gaps:\n1. Update documentation if spec was unclear\n2. Add future milestone work items if non-critical (do NOT modify current milestone)\n3. Fix immediately if blocking downstream work\n\n## Files to Review\n\n- `@rules_engine/src/lattice/src/task/*.rs`\n- `@rules_engine/docs/lattice/appendix_task_tracking.md`\n- `@rules_engine/docs/lattice/appendix_file_layout.md#task`\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:56:59.622388-08:00","created_by":"dthurn","updated_at":"2026-01-17T22:56:03.263445-08:00","closed_at":"2026-01-17T22:56:03.263445-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.10.8","depends_on_id":"dr-epv.10","type":"parent-child","created_at":"2026-01-17T16:56:59.625002-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.10.8","depends_on_id":"dr-epv.10.7","type":"blocks","created_at":"2026-01-17T16:57:03.80099-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.11","title":"Claim System","description":"Implement local work tracking via file-based claims stored in `~/.lattice/claims/`.\n\n## Goal\n\nTrack which tasks are being worked on locally without polluting git-tracked files. Claims are stored per-repository in the user's home directory, enabling concurrent-safe coordination across worktrees and multiple repositories.\n\n## Design Overview\n\n- Claims stored as individual JSON files in `~/.lattice/claims/\u003crepo-hash\u003e/`\n- Repo hash is first 8 characters of SHA-256 of canonical repository root path\n- Atomic file creation/deletion for concurrent safety (POSIX guarantees)\n- Each claim contains: `claimed_at` timestamp and `work_path` (worktree path)\n- Claims are automatically released when tasks are closed via `lat close`\n\n## Integration Points\n\n- `lat show`: Display claimed status for tasks\n- `lat ready`: Exclude claimed tasks by default (unless `--include-claimed`)\n- `lat close`: Auto-release claim when task moves to `.closed/`\n- Startup operations: Run stale claim cleanup opportunistically\n\n## References\n\n- Implementation plan: @rules_engine/docs/lattice/lattice_implementation_plan.md (Feature: Claim System)\n- Workflow commands: @rules_engine/docs/lattice/appendix_workflow.md#lat-claim\n- File layout: @rules_engine/docs/lattice/appendix_file_layout.md (claim/ section)","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-17T17:00:17.940103-08:00","created_by":"dthurn","updated_at":"2026-01-17T17:01:44.611033-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.11","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-17T17:00:17.940983-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.11.1","title":"Claim Storage","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement file-based claim persistence in `~/.lattice/claims/`.\n\n## Files to Create\n\n- `rules_engine/src/lattice/src/claim/mod.rs` - Module declarations only\n- `rules_engine/src/lattice/src/claim/claim_storage.rs` - Core storage logic\n\n## Implementation Details\n\n- Storage path: `~/.lattice/claims/\u003crepo-hash\u003e/\u003clattice-id\u003e.json`\n- Repo hash: First 8 characters of SHA-256 hash of canonical repository root path\n- Create `~/.lattice/` and `claims/` directories if missing\n\n## Claim File Format\n\n```json\n{\n  \"claimed_at\": \"2026-01-14T10:30:00Z\",\n  \"work_path\": \"/path/to/repo/worktree-feature\"\n}\n```\n\n## Concurrency Safety\n\n- File create/delete operations are atomic on POSIX systems\n- No explicit locking needed\n- Directory creation must use `create_dir_all` with proper error handling\n\n## API Surface\n\n- `claim_dir_path(repo_root: \u0026Path) -\u003e PathBuf` - Compute claims directory\n- `claim_file_path(repo_root: \u0026Path, id: \u0026LatticeId) -\u003e PathBuf` - Compute specific claim path\n- `write_claim(path: \u0026Path, claim: \u0026ClaimData) -\u003e LatticeResult\u003c()\u003e` - Atomic write\n- `read_claim(path: \u0026Path) -\u003e LatticeResult\u003cOption\u003cClaimData\u003e\u003e` - Read if exists\n- `delete_claim(path: \u0026Path) -\u003e LatticeResult\u003c()\u003e` - Remove claim file\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_workflow.md#claim-storage\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T17:00:29.017698-08:00","created_by":"dthurn","updated_at":"2026-01-17T19:05:12.479566-08:00","closed_at":"2026-01-17T19:05:12.479566-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.11.1","depends_on_id":"dr-epv.11","type":"parent-child","created_at":"2026-01-17T17:00:29.018362-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.11.2","title":"Claim Operations","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement core claim/release/check/list operations.\n\n## Files to Create\n\n- `rules_engine/src/lattice/src/claim/claim_operations.rs`\n\n## Operations to Implement\n\n### claim_task\n- Create claim file for the given task ID\n- Error if task is already claimed (check existing claim file)\n- Record current worktree path and timestamp\n\n### release_claim\n- Delete the claim file for the given task ID\n- Idempotent: no error if claim doesn't exist\n\n### is_claimed\n- Check if a claim file exists for the task ID\n- Used by `lat ready` filtering and `lat show` display\n\n### list_claims\n- List all claim files in the repository's claims directory\n- Parse each to extract task ID and claim data\n- Return sorted by claimed_at timestamp\n\n### get_claim\n- Retrieve claim data for a specific task ID\n- Return None if not claimed\n\n## Error Handling\n\n- Use `LatticeError::ClaimError` for claim-specific failures\n- Handle filesystem errors (permission denied, disk full)\n- Provide clear error messages indicating claim state\n\n## Integration Notes\n\n- These operations are called by `lat claim` command\n- Also called by `lat close` for auto-release\n- Query operations used by `lat ready` and `lat show`\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_workflow.md#lat-claim\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T17:00:39.091501-08:00","created_by":"dthurn","updated_at":"2026-01-17T19:56:24.153116-08:00","closed_at":"2026-01-17T19:56:24.153116-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.11.2","depends_on_id":"dr-epv.11","type":"parent-child","created_at":"2026-01-17T17:00:39.092203-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.11.2","depends_on_id":"dr-epv.11.1","type":"blocks","created_at":"2026-01-17T17:00:43.229059-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.11.3","title":"Stale Claim Cleanup","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement garbage collection for stale or invalid claims.\n\n## Files to Create\n\n- `rules_engine/src/lattice/src/claim/stale_cleanup.rs`\n\n## Stale Claim Criteria\n\nA claim is stale if ANY of these conditions are true:\n- Task is in a `.closed/` directory (task was closed externally)\n- Task file no longer exists (task was deleted)\n- `work_path` no longer exists (worktree removed)\n- Claim age exceeds threshold (default: 7 days, configurable)\n\n## API Surface\n\n### cleanup_stale_claims\n- Scan all claims in repository's claims directory\n- Check each claim against staleness criteria\n- Delete stale claim files\n- Return summary: released claims, kept claims, errors\n\n### is_claim_stale\n- Check single claim against staleness criteria\n- Used by cleanup and by --gc subcommand\n\n## Configuration\n\nAge threshold configurable via:\n- `~/.lattice.toml` under `[claims]` section\n- `.lattice/config.toml` for repository-specific override\n- Default: 7 days\n\n## Startup Integration\n\nThis cleanup runs during startup operations (see S2: Startup Operations).\nThe startup hook will call into this module's cleanup function.\n\n## Output Format for --gc\n\n```\nChecking 3 claims...\nReleased: LB234X (task closed)\nReleased: L567CX (work path no longer exists)\nKept: LDAB2X (active)\n```\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_workflow.md#stale-claim-detection\n- @rules_engine/docs/lattice/appendix_startup_operations.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T17:00:56.334106-08:00","created_by":"dthurn","updated_at":"2026-01-17T20:48:52.233429-08:00","closed_at":"2026-01-17T20:48:52.233429-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.11.3","depends_on_id":"dr-epv.11","type":"parent-child","created_at":"2026-01-17T17:00:56.334808-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.11.3","depends_on_id":"dr-epv.11.2","type":"blocks","created_at":"2026-01-17T17:01:01.450789-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.11.4","title":"Claim Command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the `lat claim` CLI command for local work tracking.\n\n## Files to Create\n\n- `rules_engine/src/lattice/src/cli/commands/claim_command.rs`\n\n## Command Syntax\n\n```\nlat claim \u003cid\u003e                     # Claim a task\nlat claim --list                   # Show all claims\nlat claim --release \u003cid\u003e           # Release a claim\nlat claim --release-all            # Release all claims\nlat claim --release-worktree \u003cpath\u003e # Release claims from specific worktree\nlat claim --gc                     # Garbage collection\n```\n\n## Subcommand Behavior\n\n### `lat claim \u003cid\u003e`\n- Validate task exists and is not closed\n- Error if already claimed (by this or another worktree)\n- Create claim file via claim_operations::claim_task\n- Output: \"Claimed: LB234X\"\n\n### `lat claim --list`\n- List all claims for current repository\n- Show task ID, claimed_at, work_path\n- Indicate if claim may be stale (work_path missing, etc.)\n\n### `lat claim --release \u003cid\u003e`\n- Release specific claim\n- Idempotent: no error if not claimed\n- Output: \"Released: LB234X\"\n\n### `lat claim --release-all`\n- Release all claims for current repository\n- Output count of released claims\n\n### `lat claim --release-worktree \u003cpath\u003e`\n- Release claims whose work_path matches the given path\n- Used when cleaning up after worktree removal\n\n### `lat claim --gc`\n- Run stale claim cleanup\n- Output summary of released/kept claims\n\n## Output Formats\n\n- Default: Human-readable text\n- `--json`: Structured JSON output for programmatic access\n- `--quiet`: Minimal output (success/failure only)\n\n## Integration with CLI Framework\n\n- Add to argument_parser.rs command definitions\n- Add to command_dispatch.rs routing\n- Follow output formatting conventions from output_format.rs\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_workflow.md#lat-claim\n- @rules_engine/docs/lattice/appendix_cli_structure.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T17:01:14.61878-08:00","created_by":"dthurn","updated_at":"2026-01-17T21:13:08.285409-08:00","closed_at":"2026-01-17T21:13:08.285409-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.11.4","depends_on_id":"dr-epv.11","type":"parent-child","created_at":"2026-01-17T17:01:14.619477-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.11.4","depends_on_id":"dr-epv.11.3","type":"blocks","created_at":"2026-01-17T17:01:19.071349-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.11.5","title":"Claim System Post-Implementation Review","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nPerform post-implementation structural review of the Claim System feature.\n\n## Review Context\n\nThe Claim System provides local work tracking via file-based claims stored in `~/.lattice/claims/`. This review validates completeness against the implementation plan and design specifications.\n\n## Review Questions\n\n### 1. Scope Completeness\n\nWas the scope in `lattice_implementation_plan.md` complete? Are there items which should have been included that are now missing or required for later work?\n\nCheck:\n- All work items (CL1-CL4) implemented as specified\n- File layout matches @rules_engine/docs/lattice/appendix_file_layout.md\n- API surface covers all operations from @rules_engine/docs/lattice/appendix_workflow.md\n\n### 2. Specification Satisfaction\n\nDoes the implementation fully satisfy the specification, including edge cases?\n\nVerify:\n- Repo hash calculation (first 8 chars of SHA-256)\n- Concurrent safety via atomic file operations\n- Stale claim detection for all criteria (closed, deleted, missing worktree, age)\n- Integration points documented for dependent features\n- Error handling follows LatticeError patterns\n\n## Actions for Issues Found\n\n1. Update documentation if specs need clarification\n2. Add future implementation plan milestones for missing scope (do NOT modify current milestone)\n3. Fix immediately if issues are blocking or trivial\n\n## Integration Verification\n\nConfirm these integration points are documented/ready:\n- `lat close` auto-releases claims (handled in TC3: Close Command)\n- `lat show` displays claim status (show_command)\n- `lat ready` filters claimed tasks (Q2: Ready Command)\n- Startup operations run cleanup (S2: Startup Operations)\n\n## References\n\n- @rules_engine/docs/lattice/lattice_implementation_plan.md (Feature: Claim System)\n- @rules_engine/docs/lattice/appendix_workflow.md#lat-claim\n- @rules_engine/docs/lattice/appendix_file_layout.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T17:01:35.152643-08:00","created_by":"dthurn","updated_at":"2026-01-17T22:11:46.129242-08:00","closed_at":"2026-01-17T22:11:46.129242-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.11.5","depends_on_id":"dr-epv.11","type":"parent-child","created_at":"2026-01-17T17:01:35.153475-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.11.5","depends_on_id":"dr-epv.11.4","type":"blocks","created_at":"2026-01-17T17:01:39.445325-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.12","title":"Linting and Formatting","description":"Implement document validation (`lat check`) and formatting (`lat fmt`) commands.\n\n## Scope\n\n- Lint rule engine for executing validation rules\n- Error-level rules E001-E012 (blocking errors)\n- Warning-level rules W001-W020 (advisory warnings)\n- Skill-specific rules S001-S003\n- Autofix capability for fixable warnings\n- Result reporting (text and JSON formats)\n- Markdown formatting operations (wrapping, headers, lists, whitespace)\n- `lat check` command for validation\n- `lat fmt` command for formatting and link normalization\n\n## Dependencies\n\nRequires completed features:\n- Document Model (frontmatter parsing, field validation)\n- Link System (link extraction, resolution, validation)\n- Task System (state computation, directory structure validation)\n- Index Core (document queries, ID lookups)\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/lattice_design.md#linter-and-formatter\n- @rules_engine/docs/lattice/appendix_linter.md\n- @rules_engine/docs/lattice/appendix_file_layout.md (lint/ and format/ sections)\n- @rules_engine/docs/lattice/appendix_linking_system.md#link-normalization","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-17T23:03:13.250065-08:00","created_by":"dthurn","updated_at":"2026-01-17T23:06:10.325559-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.12","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-17T23:03:13.256044-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.12.1","title":"Rule Engine","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the core lint rule execution framework.\n\n## Files to Create\n\n- `rules_engine/src/lattice/src/lint/mod.rs` (module declarations only)\n- `rules_engine/src/lattice/src/lint/rule_engine.rs`\n\n## Implementation Details\n\n- Define `LintRule` trait with `check(document, context) -\u003e Vec\u003cLintResult\u003e`\n- Create `LintContext` with access to index, link resolver, task state\n- Execute all registered rules against documents\n- Collect results distinguishing errors vs warnings\n- Support `--errors-only` flag filtering\n- Support `--path` prefix filtering\n- Aggregate results for reporting\n\n## Output Types\n\n- `LintResult` with code (E001, W001, etc.), severity, path, line, message\n- `LintSummary` with error_count, warning_count, affected_documents\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_linter.md#overview\n- @rules_engine/docs/lattice/appendix_file_layout.md (lint/ section)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:03:23.975217-08:00","created_by":"dthurn","updated_at":"2026-01-18T06:20:04.637301-08:00","closed_at":"2026-01-18T06:20:04.637301-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.12.1","depends_on_id":"dr-epv.12","type":"parent-child","created_at":"2026-01-17T23:03:23.976462-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.12.10","title":"Header/List/Whitespace Normalizers","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement markdown structure normalization utilities.\n\n## Files to Create\n\n- `rules_engine/src/lattice/src/format/header_normalizer.rs`\n- `rules_engine/src/lattice/src/format/list_normalizer.rs`\n- `rules_engine/src/lattice/src/format/whitespace_cleaner.rs`\n\n## header_normalizer.rs\n\n### ATX Header Enforcement\n- Convert setext-style headers (underline) to ATX style (#)\n- Normalize header spacing (single space after #)\n- Preserve header level hierarchy\n\n### Blank Line Rules\n- Ensure blank line before each heading\n- Ensure blank line after each heading\n- Don't add duplicate blank lines\n\n## list_normalizer.rs\n\n### List Marker Consistency\n- Convert all list markers (*, +) to dashes (-)\n- Preserve indentation for nested lists\n- Maintain spacing between marker and content\n\n### Blank Line Rules\n- Ensure blank line before list start\n- Ensure blank line after list end\n- Don't add extra lines within tight lists\n\n## whitespace_cleaner.rs\n\n### Trailing Whitespace\n- Remove trailing spaces and tabs from all lines\n- Preserve intentional trailing backslash (line continuation)\n\n### Multiple Blank Lines\n- Collapse 2+ consecutive blank lines to single blank line\n\n### Final Newline\n- Ensure file ends with exactly one newline character\n- Don't add newline to empty files\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_linter.md (W005, W006, W011-W015)\n- @rules_engine/docs/lattice/appendix_file_layout.md (format/ section)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:05:06.028551-08:00","created_by":"dthurn","updated_at":"2026-01-18T15:22:34.133559-08:00","closed_at":"2026-01-18T15:22:34.133559-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.12.10","depends_on_id":"dr-epv.12","type":"parent-child","created_at":"2026-01-17T23:05:06.029464-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.12.10","depends_on_id":"dr-epv.12.9","type":"blocks","created_at":"2026-01-17T23:06:00.798792-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.12.11","title":"Markdown Formatter","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement orchestration layer for all markdown formatting operations.\n\n## File to Create\n\n- `rules_engine/src/lattice/src/format/markdown_formatter.rs`\n\n## Implementation Details\n\n### Orchestration\n\nCoordinate all formatting operations in correct order:\n1. Whitespace cleaning (trailing, multiple blanks)\n2. Header normalization (ATX conversion, blank lines)\n3. List normalization (markers, blank lines)\n4. Text wrapping at configured width\n5. Final newline enforcement\n\n### Entry Points\n\n- `format_document(path, config) -\u003e Result\u003cbool\u003e` - format single file\n- `format_directory(path, config) -\u003e Result\u003cFormatSummary\u003e` - format all .md files\n- Returns whether changes were made\n\n### Configuration\n\n- Line width (default 80)\n- Enabled/disabled operations\n- Dry-run mode (check without writing)\n\n### Atomic Writes\n\n- Write to temp file first\n- Rename temp to target on success\n- Log all formatting operations\n\n### Output\n\n- Report files formatted\n- Report files unchanged\n- Report errors encountered\n\n## Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#linter-and-formatter\n- @rules_engine/docs/lattice/appendix_file_layout.md (format/ section)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:05:07.196902-08:00","created_by":"dthurn","updated_at":"2026-01-18T15:24:05.489255-08:00","closed_at":"2026-01-18T15:24:05.489255-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.12.11","depends_on_id":"dr-epv.12","type":"parent-child","created_at":"2026-01-17T23:05:07.197592-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.12.11","depends_on_id":"dr-epv.12.10","type":"blocks","created_at":"2026-01-17T23:06:01.606295-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.12.12","title":"Fmt Command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the lat fmt command for formatting and link normalization.\n\n## File to Create\n\n- `rules_engine/src/lattice/src/cli/commands/fmt_command.rs`\n\n## Command Options\n\n- `lat fmt` - Format all documents\n- `lat fmt \u003cpath\u003e` - Format files under specified path\n- `--check` - Exit 1 if changes needed (don't modify files)\n- `--line-width \u003cn\u003e` - Override default 80 character wrap width\n\n## Implementation Details\n\n### Document Formatting\n\nUse markdown_formatter.rs for:\n- Text wrapping at configured width\n- ATX header normalization\n- List marker consistency (dashes)\n- Trailing whitespace removal\n- Multiple blank line collapse\n- Final newline enforcement\n\n### Link Normalization\n\nUse link/link_normalization/ module for:\n- Add missing Lattice ID fragments to path-only links\n- Expand ID-only links to full path + fragment\n- Update stale paths when documents have moved\n- Derive correct relative path from source document location\n\n### Auto-populate Fields\n\n- Set `name` field from filename (strip .md, underscores to hyphens)\n- Set `parent-id` from directory's root document\n- Update `updated-at` timestamp\n\n### Output\n\n- Report files formatted with changes\n- Report files already formatted (no changes)\n- In --check mode, list files needing formatting\n\n## Exit Codes\n\n- 0: All files formatted (or already formatted)\n- 1: Changes needed (with --check)\n- 2: Errors during formatting\n\n## Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#linter-and-formatter\n- @rules_engine/docs/lattice/appendix_linking_system.md#link-normalization\n- @rules_engine/docs/lattice/appendix_file_layout.md (fmt_command.rs)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:05:33.047448-08:00","created_by":"dthurn","updated_at":"2026-01-18T15:47:36.807949-08:00","closed_at":"2026-01-18T15:47:36.807949-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.12.12","depends_on_id":"dr-epv.12","type":"parent-child","created_at":"2026-01-17T23:05:33.048228-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.12.12","depends_on_id":"dr-epv.12.11","type":"blocks","created_at":"2026-01-17T23:06:02.766353-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.12.13","title":"Post-Implementation Review","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nPerform structural review of Linting and Formatting feature for completeness.\n\n## Feature Context\n\nThe Linting and Formatting feature provides:\n- `lat check` command for document validation\n- `lat fmt` command for formatting and link normalization\n- Rule engine with E001-E012 errors, W001-W020 warnings, S001-S003 skill rules\n- Autofix capability for fixable warnings\n- Markdown formatting utilities\n\n## Review Questions\n\n### 1. Scope Completeness\n\nReview @rules_engine/docs/lattice/lattice_implementation_plan.md (Linting and Formatting section):\n- Were all work items (LF1-LF12) implemented?\n- Are there items that should have been included but were missed?\n- Are there items required for later features that are now missing?\n\n### 2. Specification Compliance\n\nReview @rules_engine/docs/lattice/appendix_linter.md:\n- Does lat check implement all documented rules (E001-E012, W001-W020, S001-S003)?\n- Are all command options implemented (--errors-only, --path, --fix, --staged-only, --rebuild-index)?\n- Does output format match the specification (text and JSON)?\n\nReview @rules_engine/docs/lattice/appendix_linking_system.md#link-normalization:\n- Does lat fmt handle all link normalization cases?\n- Are path updates handled correctly when documents move?\n\n### 3. Edge Cases\n\n- What happens with malformed YAML frontmatter?\n- What happens with empty files?\n- What happens with binary files that have .md extension?\n- Are concurrent fmt operations safe (atomic writes)?\n\n## Actions\n\n1. Update documentation if scope changes are needed\n2. Add future implementation plan milestone if features are missing\n3. Fix any specification gaps immediately\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-17T23:05:34.187431-08:00","created_by":"dthurn","updated_at":"2026-01-18T15:51:10.022997-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.12.13","depends_on_id":"dr-epv.12","type":"parent-child","created_at":"2026-01-17T23:05:34.188221-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.12.13","depends_on_id":"dr-epv.12.12","type":"blocks","created_at":"2026-01-17T23:06:03.495354-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.12.2","title":"Error Rules (E001-E012)","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement blocking error-level lint rules that must be fixed before operations.\n\n## File to Create\n\n- `rules_engine/src/lattice/src/lint/error_rules.rs`\n\n## Rules to Implement\n\n- E001: Duplicate Lattice ID - query documents grouped by ID\n- E002: Missing reference target - compare link targets against index\n- E003: Invalid frontmatter key - compare against allowed key list with typo suggestions\n- E004: Missing required field - tasks must have priority\n- E005: Invalid field value - validate against allowed values per field\n- E006: Circular blocking - DFS on blocking graph for back edges\n- E007: Invalid ID format - regex validation on ID fields\n- E008: Name-filename mismatch - compare name field vs derived filename\n- E009: Missing name field\n- E010: Missing description field\n- E011: Invalid closed directory structure - no nested .closed/ directories\n- E012: Non-task in closed directory - require task-type for documents in .closed/\n\n## Dependencies\n\nUses index queries for E001, E002, E006. Uses document model for E003-E010.\nUses task/directory_structure.rs for E011, E012.\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_linter.md#error-level-rules\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:03:37.018187-08:00","created_by":"dthurn","updated_at":"2026-01-18T07:15:07.820414-08:00","closed_at":"2026-01-18T07:15:07.820414-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.12.2","depends_on_id":"dr-epv.12","type":"parent-child","created_at":"2026-01-17T23:03:37.019419-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.12.2","depends_on_id":"dr-epv.12.1","type":"blocks","created_at":"2026-01-17T23:05:52.657102-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.12.3","title":"Warning Rules (W001-W016)","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement advisory warning-level lint rules for formatting and style issues.\n\n## File to Create\n\n- `rules_engine/src/lattice/src/lint/warning_rules.rs`\n\n## Rules to Implement\n\n- W001: Document too large - count lines, warn at 500+\n- W002: Name too long - warn at 64+ characters\n- W003: Description too long - warn at 1024+ characters\n- W004: Invalid name characters - regex for lowercase-hyphen format\n- W005: Inconsistent header style - detect mixed ATX/setext\n- W006: Inconsistent list markers - detect mixed -, *, + markers\n- W007: Bare URL - regex for URLs outside []() or \u003c\u003e\n- W008: Self-reference - check if link target equals document's own ID\n- W009: Backslash in path - check for \\ in link paths\n- W010: Link path mismatch - compare link path against current path in index\n- W010b: Missing link fragment - path-only links without #LXXXXX\n- W011: Trailing whitespace - regex for end-of-line spaces/tabs\n- W012: Multiple blank lines - detect 2+ consecutive empty lines\n- W013: Missing final newline - check last byte of file\n- W014: Heading without blank lines - parse headings and check adjacent lines\n- W015: List without blank lines - parse lists and check adjacent lines\n- W016: Template section in non-root - [Lattice] headings in non-root docs\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_linter.md#warning-level-rules\n- @rules_engine/docs/lattice/appendix_linking_system.md#path-mismatches\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:03:50.768038-08:00","created_by":"dthurn","updated_at":"2026-01-18T07:42:48.853242-08:00","closed_at":"2026-01-18T07:42:48.853242-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.12.3","depends_on_id":"dr-epv.12","type":"parent-child","created_at":"2026-01-17T23:03:50.76904-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.12.3","depends_on_id":"dr-epv.12.2","type":"blocks","created_at":"2026-01-17T23:05:53.310827-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.12.4","title":"Structure Rules (W017-W020)","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement directory structure and naming convention warning rules.\n\n## File to Create\n\n- `rules_engine/src/lattice/src/lint/structure_rules.rs`\n\n## Rules to Implement\n\n- W017: Document not in standard location\n  - Non-root documents must be in tasks/ or docs/ directory\n  - Check if document is root (filename matches directory) OR path contains /tasks/ or /docs/\n\n- W018: Task in docs/ directory\n  - Documents with task-type field should not be in /docs/\n  - Suggest moving to tasks/ directory\n\n- W019: Knowledge base document in tasks/ directory\n  - Documents without task-type in /tasks/ (excluding .closed/ subdirectories)\n  - Suggest moving to docs/ directory\n\n- W020: Invalid document name format\n  - Non-root documents must have at least two underscore-separated words\n  - Validate lowercase letters, numbers, underscores only\n\n## Dependencies\n\nUses task/root_detection.rs for root document detection.\nUses task/directory_structure.rs for path validation utilities.\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_linter.md (W017-W020 sections)\n- @rules_engine/docs/lattice/lattice_design.md#root-documents-and-hierarchy\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:04:14.150916-08:00","created_by":"dthurn","updated_at":"2026-01-18T08:44:42.267516-08:00","closed_at":"2026-01-18T08:44:42.267516-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.12.4","depends_on_id":"dr-epv.12","type":"parent-child","created_at":"2026-01-17T23:04:14.151726-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.12.4","depends_on_id":"dr-epv.12.3","type":"blocks","created_at":"2026-01-17T23:05:54.629221-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.12.5","title":"Skill Rules (S001-S003)","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement skill-specific validation rules for Claude skill documents.\n\n## File to Create\n\n- `rules_engine/src/lattice/src/lint/skill_rules.rs`\n\n## Rules to Implement\n\nOnly apply when `skill: true` is present in frontmatter:\n\n- S001: Name contains reserved word\n  - Check name for \"anthropic\" or \"claude\" substrings\n  - Error severity (blocking)\n\n- S002: Description empty\n  - Skill must have non-empty description field\n  - Error severity (blocking)\n\n- S003: Name contains XML\n  - Check name for \u003c or \u003e characters\n  - Error severity (blocking)\n\n## Dependencies\n\nUses document/frontmatter_schema.rs to check skill field.\nUses skill/skill_validation.rs for validation helpers.\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_linter.md#skill-specific-rules\n- @rules_engine/docs/lattice/lattice_design.md#skill-integration\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:04:16.296306-08:00","created_by":"dthurn","updated_at":"2026-01-18T09:25:24.137486-08:00","closed_at":"2026-01-18T09:25:24.137486-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.12.5","depends_on_id":"dr-epv.12","type":"parent-child","created_at":"2026-01-17T23:04:16.297055-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.12.5","depends_on_id":"dr-epv.12.4","type":"blocks","created_at":"2026-01-17T23:05:55.958171-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.12.6","title":"Result Reporter","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement lint result formatting and output for lat check command.\n\n## File to Create\n\n- `rules_engine/src/lattice/src/lint/result_reporter.rs`\n\n## Implementation Details\n\n### Text Output Format\n\n- Group errors/warnings by file path\n- Show rule code, line number, and message\n- Display summary line: \"Found N errors, M warnings in K documents\"\n- Use color theme: red for errors, yellow for warnings\n\n### JSON Output Format\n\n```json\n{\n  \"documents_checked\": 234,\n  \"errors\": [{\"code\": \"E002\", \"path\": \"...\", \"line\": 42, \"message\": \"...\"}],\n  \"warnings\": [...],\n  \"summary\": {\"error_count\": 1, \"warning_count\": 2, \"affected_documents\": 2}\n}\n```\n\n### Features\n\n- Support --errors-only to suppress warnings\n- Use cli/color_theme.rs for consistent coloring\n- Match output format from appendix examples\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_linter.md#output-format\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:04:17.635652-08:00","created_by":"dthurn","updated_at":"2026-01-18T13:35:38.129163-08:00","closed_at":"2026-01-18T13:35:38.129163-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.12.6","depends_on_id":"dr-epv.12","type":"parent-child","created_at":"2026-01-17T23:04:17.636538-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.12.6","depends_on_id":"dr-epv.12.5","type":"blocks","created_at":"2026-01-17T23:05:56.810622-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.12.7","title":"Autofix Engine","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement automatic fix capability for lint warnings.\n\n## File to Create\n\n- `rules_engine/src/lattice/src/lint/autofix_engine.rs`\n\n## Implementation Details\n\n### Fixable Rules\n\nSupport --fix flag for these rules:\n- W004: Invalid name characters - normalize to lowercase-hyphen\n- W005: Inconsistent header style - convert to ATX (#) headers\n- W006: Inconsistent list markers - convert to dashes (-)\n- W011: Trailing whitespace - strip trailing spaces/tabs\n- W012: Multiple blank lines - collapse to single blank line\n- W013: Missing final newline - add newline at end\n- W014: Heading without blank lines - insert blank lines\n- W015: List without blank lines - insert blank lines\n- E008: Name-filename mismatch - correct name field to match filename\n\n### Fix Application\n\n- Apply fixes to document content\n- Use atomic write (temp file + rename) for safety\n- Track which fixes were applied for reporting\n- Skip fixes that would conflict with each other\n- Log all fix operations\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_linter.md#command-options (--fix)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:04:37.487614-08:00","created_by":"dthurn","updated_at":"2026-01-18T14:07:52.647824-08:00","closed_at":"2026-01-18T14:07:52.647824-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.12.7","depends_on_id":"dr-epv.12","type":"parent-child","created_at":"2026-01-17T23:04:37.488475-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.12.7","depends_on_id":"dr-epv.12.6","type":"blocks","created_at":"2026-01-17T23:05:57.675245-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.12.8","title":"Check Command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the lat check command for document validation.\n\n## Files to Create\n\n- `rules_engine/src/lattice/src/cli/commands/check_command/mod.rs`\n- `rules_engine/src/lattice/src/cli/commands/check_command/check_executor.rs`\n- `rules_engine/src/lattice/src/cli/commands/check_command/check_fixes.rs`\n- `rules_engine/src/lattice/src/cli/commands/check_command/check_output.rs`\n\n## Command Options\n\n- `--errors-only` - Suppress warnings, show only errors\n- `--path \u003cprefix\u003e` - Check only files under specified path\n- `--fix` - Apply automatic fixes where possible\n- `--staged-only` - Check only git staged files\n- `--rebuild-index` - Force index rebuild before checking\n- `--json` - Output results in JSON format\n\n## Implementation Details\n\n### check_executor.rs\n- Orchestrate rule execution across all documents\n- Coordinate with rule engine for collecting results\n- Handle --rebuild-index flag (call index reconciliation)\n\n### check_fixes.rs\n- Apply autofix engine for --fix flag\n- Filter documents for --staged-only (use git status)\n- Aggregate fix results\n\n### check_output.rs\n- Format results using result_reporter.rs\n- Handle --json output mode\n- Determine exit code based on results\n\n## Exit Codes\n\n- 0: No errors or warnings\n- 1: System error (internal failure)\n- 2: Validation errors found\n- 3: Only warnings found\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_linter.md#command-options\n- @rules_engine/docs/lattice/appendix_file_layout.md (check_command/ section)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:04:38.631957-08:00","created_by":"dthurn","updated_at":"2026-01-18T14:34:19.994542-08:00","closed_at":"2026-01-18T14:34:19.994542-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.12.8","depends_on_id":"dr-epv.12","type":"parent-child","created_at":"2026-01-17T23:04:38.63277-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.12.8","depends_on_id":"dr-epv.12.7","type":"blocks","created_at":"2026-01-17T23:05:58.894109-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.12.9","title":"Text Wrapper","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement line wrapping for markdown content.\n\n## Files to Create\n\n- `rules_engine/src/lattice/src/format/mod.rs` (module declarations only)\n- `rules_engine/src/lattice/src/format/text_wrapper.rs`\n\n## Implementation Details\n\n### Line Wrapping\n\n- Default wrap width: 80 characters\n- Support configurable width via --line-width flag\n- Preserve indentation in wrapped content\n\n### Preserve Structure\n\nDo not wrap content inside:\n- Code blocks (fenced ``` and indented)\n- Tables (lines containing |)\n- Lists (maintain list item integrity)\n- Links (don't break markdown link syntax)\n\n### Unicode Handling\n\n- Handle CJK character width (double-width characters)\n- Preserve emoji and combining characters\n\n### Algorithm\n\n- Split content by paragraphs (blank line separation)\n- Wrap each paragraph independently\n- Preserve leading whitespace for continuation\n- Handle soft vs hard breaks appropriately\n\n## Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#linter-and-formatter\n- @rules_engine/docs/lattice/appendix_file_layout.md (format/ section)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:05:04.515751-08:00","created_by":"dthurn","updated_at":"2026-01-18T14:59:59.06667-08:00","closed_at":"2026-01-18T14:59:59.06667-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.12.9","depends_on_id":"dr-epv.12","type":"parent-child","created_at":"2026-01-17T23:05:04.516468-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.12.9","depends_on_id":"dr-epv.12.8","type":"blocks","created_at":"2026-01-17T23:05:59.763645-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.13","title":"Core Task Commands Feature","description":"Implement the Core Task Commands feature: create, update, close, reopen, and prune commands for managing task and document lifecycle.\n\n## Goal\n- Enable creation of new tasks and knowledge base documents with auto-placement\n- Support modification of existing documents (priority, type, labels)\n- Implement task state transitions (close, reopen) with link rewriting\n- Support permanent deletion of closed tasks with reference cleanup\n\n## Dependencies\n- Document Model [DONE]\n- Task System [DONE]\n- Link System [DONE]\n- Index Core [DONE]\n\n## Reference Documentation\n- @rules_engine/docs/lattice/lattice_design.md#command-overview\n- @rules_engine/docs/lattice/appendix_cli_structure.md#task-commands\n- @rules_engine/docs/lattice/appendix_task_tracking.md\n- @rules_engine/docs/lattice/appendix_linking_system.md#closed-task-link-handling","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-17T23:09:43.995677-08:00","created_by":"dthurn","updated_at":"2026-01-17T23:11:05.361871-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.13","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-17T23:09:43.999673-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.13.1","title":"Implement Create Command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement `lat create` command for creating new tasks and knowledge base documents.\n\n## File\n- `rules_engine/src/lattice/src/cli/commands/create_command.rs`\n\n## Key Requirements\n\n**Argument Parsing:**\n- `lat create \u003cparent\u003e \"\u003cdescription\u003e\" [options]`\n- Options: `-t/--type`, `-p/--priority`, `--body-file`, `-l/--labels`, `--deps`\n\n**Auto-Placement Logic:**\n- With `-t {type}`: create in `{parent}/tasks/`\n- Without `-t`: create in `{parent}/docs/`\n- Explicit path override for full control\n\n**Auto-Naming from Description:**\n- Extract significant words (skip articles: \"the\", \"a\", \"an\")\n- Convert to lowercase with underscores\n- Cap at ~40 characters\n- Append numeric suffix on collision (`fix_bug.md`, `fix_bug_2.md`)\n\n**Document Creation:**\n- Generate new unique Lattice ID via `id/id_generator.rs`\n- Populate frontmatter with required fields\n- Set `created-at` timestamp\n- Derive `name` from generated filename\n- Auto-populate `parent-id` from directory's root document\n- Support `--body-file` for extended content\n\n**Index Update:**\n- Add new document to index after creation\n\n## Reference\n- @rules_engine/docs/lattice/appendix_cli_structure.md#lat-create-parent-description-options\n- @rules_engine/docs/lattice/appendix_task_tracking.md#creating-documents\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:09:55.973175-08:00","created_by":"dthurn","updated_at":"2026-01-18T06:18:19.491283-08:00","closed_at":"2026-01-18T06:18:19.491283-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.13.1","depends_on_id":"dr-epv.13","type":"parent-child","created_at":"2026-01-17T23:09:55.973961-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.13.2","title":"Implement Update Command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement `lat update` command for modifying existing tasks and documents.\n\n## File\n- `rules_engine/src/lattice/src/cli/commands/update_command.rs`\n\n## Key Requirements\n\n**Argument Parsing:**\n- `lat update \u003cid\u003e [id...] [options]`\n- Support batch updates for multiple IDs in a single invocation\n\n**Modifiable Fields:**\n- `--priority {n}`: Change priority (0-4)\n- `--type {type}`: Change task type (bug/feature/task/chore)\n- `--add-labels {list}`: Add labels to existing set\n- `--remove-labels {list}`: Remove labels from set\n\n**Timestamp Handling:**\n- Update `updated-at` to current time on any change\n- Preserve other timestamps (`created-at`, `closed-at`)\n\n**Validation:**\n- Verify document exists in index\n- Validate priority range (0-4)\n- Validate task type enum values\n- Error on invalid IDs (exit code 4)\n\n**Document Writing:**\n- Read existing document\n- Modify frontmatter fields\n- Write atomically (temp file + rename)\n- Update index entry\n\n**Note:** State changes (close/reopen) are handled by separate commands.\n\n## Reference\n- @rules_engine/docs/lattice/appendix_cli_structure.md#lat-update-id-id-options\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:10:07.183202-08:00","created_by":"dthurn","updated_at":"2026-01-18T07:06:52.284032-08:00","closed_at":"2026-01-18T07:06:52.284032-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.13.2","depends_on_id":"dr-epv.13","type":"parent-child","created_at":"2026-01-17T23:10:07.184029-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.13.2","depends_on_id":"dr-epv.13.1","type":"blocks","created_at":"2026-01-17T23:10:07.249104-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.13.3","title":"Implement Close Command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement `lat close` command to close tasks by moving them to `.closed/` subdirectory.\n\n## File\n- `rules_engine/src/lattice/src/cli/commands/close_command.rs`\n\n## Key Requirements\n\n**Argument Parsing:**\n- `lat close \u003cid\u003e [id...] [options]`\n- Options: `--reason {text}`, `--dry-run`\n\n**Move to .closed/ Directory:**\n- Compute `.closed/` path using `task/closed_directory.rs`\n- Create `.closed/` directory if it doesn't exist\n- Move document: `tasks/foo.md` → `tasks/.closed/foo.md`\n- Handle batch closes (multiple IDs)\n\n**Link Rewriting:**\n- Find all documents linking to this task (via index backlinks)\n- Rewrite paths to point to new `.closed/` location\n- Use Link System (`link/link_normalization/`) for path updates\n- This is similar to `lat mv` behavior\n\n**Timestamp Handling:**\n- Set `closed-at` to current ISO 8601 timestamp\n- Update `updated-at` timestamp\n\n**Claim Release:**\n- Auto-release any active claims on closed tasks\n- Use `claim/claim_operations.rs` release logic\n\n**--reason Option:**\n- Append reason text to document body under a \"Closure Reason\" heading\n\n**Index Update:**\n- Update document path in index\n- Update link entries to reflect new paths\n\n## Reference\n- @rules_engine/docs/lattice/appendix_cli_structure.md#lat-close-id-id-options\n- @rules_engine/docs/lattice/appendix_linking_system.md#closed-task-link-handling\n- @rules_engine/docs/lattice/appendix_task_tracking.md#the-closed-directory\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:10:20.354697-08:00","created_by":"dthurn","updated_at":"2026-01-18T07:41:41.293913-08:00","closed_at":"2026-01-18T07:41:41.293913-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.13.3","depends_on_id":"dr-epv.13","type":"parent-child","created_at":"2026-01-17T23:10:20.355436-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.13.3","depends_on_id":"dr-epv.13.2","type":"blocks","created_at":"2026-01-17T23:10:20.424304-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.13.4","title":"Implement Reopen Command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement `lat reopen` command to restore closed tasks from `.closed/` subdirectory.\n\n## File\n- `rules_engine/src/lattice/src/cli/commands/reopen_command.rs`\n\n## Key Requirements\n\n**Argument Parsing:**\n- `lat reopen \u003cid\u003e [id...]`\n- Options: `--dry-run`\n\n**Move from .closed/ Directory:**\n- Verify task is currently in a `.closed/` directory\n- Compute original parent path (remove `.closed/` from path)\n- Move document: `tasks/.closed/foo.md` → `tasks/foo.md`\n- Handle batch reopens (multiple IDs)\n\n**Link Rewriting:**\n- Find all documents linking to this task (via index backlinks)\n- Rewrite paths from `.closed/` location to restored path\n- Use Link System (`link/link_normalization/`) for path updates\n- Mirrors the link handling in Close Command\n\n**Timestamp Handling:**\n- Clear `closed-at` field (remove or set to null)\n- Update `updated-at` to current time\n\n**Validation:**\n- Error if task is not currently closed (not in `.closed/` directory)\n- Error if target path already exists (collision)\n\n**Index Update:**\n- Update document path in index\n- Update link entries to reflect restored paths\n\n## Reference\n- @rules_engine/docs/lattice/appendix_cli_structure.md#lat-reopen-id-id\n- @rules_engine/docs/lattice/appendix_linking_system.md#reopening-tasks\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:10:30.405476-08:00","created_by":"dthurn","updated_at":"2026-01-18T08:45:03.925478-08:00","closed_at":"2026-01-18T08:45:03.925478-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.13.4","depends_on_id":"dr-epv.13","type":"parent-child","created_at":"2026-01-17T23:10:30.406688-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.13.4","depends_on_id":"dr-epv.13.3","type":"blocks","created_at":"2026-01-17T23:10:30.475978-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.13.5","title":"Implement Prune Command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement `lat prune` command to permanently delete closed tasks.\n\n## File\n- `rules_engine/src/lattice/src/cli/commands/prune_command.rs`\n\n## Key Requirements\n\n**Argument Parsing:**\n- `lat prune \u003cpath\u003e` - prune closed tasks under path\n- `lat prune --all` - prune all closed tasks in repository\n- Options: `--force`, `--dry-run`\n- Require either path argument or `--all` flag\n\n**Deletion Logic:**\n- Delete task files from `.closed/` directories\n- Handle batch deletion\n\n**YAML Frontmatter Reference Cleanup:**\n- Remove pruned IDs from `blocking` fields in all documents\n- Remove pruned IDs from `blocked-by` fields in all documents\n- Remove pruned IDs from `discovered-from` fields in all documents\n- These removals happen automatically\n\n**Inline Markdown Link Handling:**\n- Detect all inline links pointing to pruned documents\n- Default behavior: error if any inline links exist\n- With `--force`: convert inline links to plain text\n  - `[old task](path.md#LXXXXX)` → `old task`\n- Report affected documents and line numbers\n\n**Dry Run Mode:**\n- Show what would be deleted\n- Show which references would be removed/converted\n- Do not modify any files\n\n**Index Update:**\n- Remove document entries for deleted tasks\n- Remove all link entries referencing deleted tasks\n\n## Edge Cases\n- Task has both YAML refs and inline links (clean YAML, error on inline)\n- Pruning a task that blocks other open tasks (should still work)\n\n## Reference\n- @rules_engine/docs/lattice/appendix_cli_structure.md#lat-prune-path-options\n- @rules_engine/docs/lattice/appendix_linking_system.md#pruning-tasks\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:10:44.338276-08:00","created_by":"dthurn","updated_at":"2026-01-18T09:29:27.881735-08:00","closed_at":"2026-01-18T09:29:27.881735-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.13.5","depends_on_id":"dr-epv.13","type":"parent-child","created_at":"2026-01-17T23:10:44.33921-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.13.5","depends_on_id":"dr-epv.13.4","type":"blocks","created_at":"2026-01-17T23:10:44.405117-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.13.6","title":"Post-Implementation Review: Core Task Commands","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nPerform a post-implementation structural review of the Core Task Commands feature.\n\n## Feature Context\nThe Core Task Commands feature implements create, update, close, reopen, and prune commands for managing task and document lifecycle in the Lattice system.\n\n## Review Questions\n\n**1. Scope Completeness:**\n- Was the scope in `@rules_engine/docs/lattice/lattice_implementation_plan.md` complete?\n- Are there items which should have been included but are missing?\n- Are there items required for later features that should be documented now?\n\n**2. Specification Satisfaction:**\n- Does the implementation fully satisfy the specification?\n- Are all edge cases handled appropriately?\n- Specific areas to verify:\n  - Auto-placement logic for create command\n  - Filename collision handling (numeric suffix)\n  - Link rewriting correctness for close/reopen\n  - Inline link detection and --force behavior for prune\n  - Batch operation atomicity\n  - Claim release integration in close command\n\n**3. Documentation Updates:**\n- Is `@rules_engine/docs/lattice/appendix_file_layout.md` current?\n- Are test files properly documented?\n- Are integration points with other features documented?\n\n## Actions If Issues Found\n1. Update documentation to reflect actual implementation\n2. Add future implementation plan milestone for missing scope (do NOT modify current milestone)\n3. Fix critical issues immediately if blocking other work\n\n## Reference\n- @rules_engine/docs/lattice/lattice_implementation_plan.md (Feature: Core Task Commands section)\n- @rules_engine/docs/lattice/appendix_cli_structure.md#task-commands\n- @rules_engine/docs/lattice/appendix_task_tracking.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:10:58.156803-08:00","created_by":"dthurn","updated_at":"2026-01-18T13:51:27.935893-08:00","closed_at":"2026-01-18T13:51:27.935893-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.13.6","depends_on_id":"dr-epv.13","type":"parent-child","created_at":"2026-01-17T23:10:58.157562-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.13.6","depends_on_id":"dr-epv.13.5","type":"blocks","created_at":"2026-01-17T23:10:58.225101-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.14","title":"Query Commands","description":"Implement query commands for searching and filtering Lattice documents.\n\n**Feature Overview:**\n- List command for flexible document filtering with rich output\n- Ready command showing work available to start\n- Search command for full-text search via FTS5\n- Stale/blocked/changes/stats commands for specialized queries\n\n**Depends on:** Index Core [DONE], Task System [DONE]\n\n**Reference:** @rules_engine/docs/lattice/appendix_cli_structure.md#query-commands\n\n**Completion Criteria:**\n- All seven query commands fully implemented\n- Integration with existing index and task modules\n- Text, JSON, and pretty output formats where applicable","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-17T23:14:26.889527-08:00","created_by":"dthurn","updated_at":"2026-01-17T23:14:31.692109-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.14","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-17T23:14:26.893755-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.14.1","title":"List Command - Filter Builder","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the filter_builder module for `lat list` command query construction.\n\n**Files:**\n- `@rules_engine/src/lattice/src/cli/commands/list_command/filter_builder.rs`\n\n**Implementation:**\n- Parse all filter options from CLI arguments\n- Build SQL WHERE clauses from filter criteria:\n  - `--state`: Filter by open/blocked/closed\n  - `--include-closed`: Include tasks in `.closed/` directories\n  - `--closed-only`: Show only closed tasks\n  - `--priority`, `--priority-min`, `--priority-max`: Priority filters\n  - `--type`: Filter by task type\n  - `--label`, `--label-any`: Label filters (AND/OR logic)\n  - `--name-contains`: Substring match on document names\n  - `--path`: Path prefix filter\n  - `--created-after/before`, `--updated-after/before`: Timestamp filters\n  - `--discovered-from`: Tasks discovered from parent\n  - `--roots-only`: List only root documents\n- Integrate with `DocumentFilter` from `@rules_engine/src/lattice/src/index/document_filter.rs`\n- Handle sort options: priority/created/updated/name with `--reverse`\n\n**Reference:** @rules_engine/docs/lattice/appendix_cli_structure.md#lat-list-options\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:14:43.76271-08:00","created_by":"dthurn","updated_at":"2026-01-18T06:18:55.469188-08:00","closed_at":"2026-01-18T06:18:55.469188-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.14.1","depends_on_id":"dr-epv.14","type":"parent-child","created_at":"2026-01-17T23:14:43.763445-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.14.2","title":"List Command - Executor and Output","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the list_executor and list_output modules for `lat list` command.\n\n**Files:**\n- `@rules_engine/src/lattice/src/cli/commands/list_command/list_executor.rs`\n- `@rules_engine/src/lattice/src/cli/commands/list_command/list_output.rs`\n\n**list_executor.rs:**\n- Orchestrate filter application from filter_builder\n- Execute index queries via document_queries\n- Apply `--limit` constraint\n- Handle result ordering\n\n**list_output.rs:**\n- Implement three output formats: rich, compact, oneline\n- Rich (default): `LXXXXX [bug/P1] name - description`\n- Compact: `LXXXXX  name`\n- Closed task indicator: `[task/P2/closed]`\n- JSON output via `--json` flag\n- Support `--format` flag selection\n\n**Reference:**\n- @rules_engine/docs/lattice/appendix_cli_structure.md#lat-list-options\n- Uses document reference format from @rules_engine/docs/lattice/appendix_workflow.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:14:53.770488-08:00","created_by":"dthurn","updated_at":"2026-01-18T07:09:18.729268-08:00","closed_at":"2026-01-18T07:09:18.729268-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.14.2","depends_on_id":"dr-epv.14","type":"parent-child","created_at":"2026-01-17T23:14:53.771272-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.14.2","depends_on_id":"dr-epv.14.1","type":"blocks","created_at":"2026-01-17T23:14:58.527057-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.14.3","title":"Ready Command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the `lat ready` command for showing available work.\n\n**Files:**\n- `@rules_engine/src/lattice/src/cli/commands/ready_command/ready_executor.rs`\n- `@rules_engine/src/lattice/src/cli/commands/ready_command/ready_filter.rs`\n- `@rules_engine/src/lattice/src/cli/commands/ready_command/ready_output.rs`\n\n**ready_filter.rs:**\n- Implement ready criteria: not closed, not blocked, not P4, not claimed\n- Integrate with ready_calculator from Task System\n- Support filter options: `--parent`, `--priority`, `--type`, `--label`\n- Handle `--include-backlog` for P4 tasks\n- Handle `--include-claimed` for claimed tasks\n\n**ready_executor.rs:**\n- Orchestrate filtering and claim checking\n- Apply sort policies: hybrid (default), priority, oldest\n- Handle `--limit` constraint\n\n**ready_output.rs:**\n- Default numbered list output with priority/type\n- `--pretty` visual tree with state symbols\n- JSON output compatible with `bd ready --json`\n- Legend line showing symbol meanings\n\n**Integration Points:**\n- Filter out claimed tasks (from Claim System)\n- Use ready_calculator from `@rules_engine/src/lattice/src/task/ready_calculator.rs`\n\n**Reference:** @rules_engine/docs/lattice/appendix_workflow.md#lat-ready\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:15:09.615451-08:00","created_by":"dthurn","updated_at":"2026-01-18T06:16:55.781422-08:00","closed_at":"2026-01-18T06:16:55.781422-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.14.3","depends_on_id":"dr-epv.14","type":"parent-child","created_at":"2026-01-17T23:15:09.616345-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.14.4","title":"Search Command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the `lat search` command for full-text search via FTS5.\n\n**Files:**\n- `@rules_engine/src/lattice/src/cli/commands/search_command.rs`\n\n**Implementation:**\n- Parse FTS5 query syntax from user input\n- Execute search via `@rules_engine/src/lattice/src/index/fulltext_search.rs`\n- Extract and format result snippets with match highlighting\n- Apply filters: `--path`, `--type`\n- Apply `--limit` constraint\n- Display results with match context\n\n**Output Format:**\n- Document ID and name\n- Matching snippet with highlighted terms\n- File path for reference\n- JSON output with full match details\n\n**Edge Cases:**\n- Invalid FTS5 query syntax (report clear error)\n- Empty result sets\n- Very long matching content (truncate snippet)\n\n**Reference:** @rules_engine/docs/lattice/appendix_cli_structure.md#lat-search-query-options\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:15:18.669946-08:00","created_by":"dthurn","updated_at":"2026-01-18T07:13:35.111922-08:00","closed_at":"2026-01-18T07:13:35.111922-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.14.4","depends_on_id":"dr-epv.14","type":"parent-child","created_at":"2026-01-17T23:15:18.670672-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.14.5","title":"Stale Command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the `lat stale` command for finding tasks not updated recently.\n\n**Files:**\n- `@rules_engine/src/lattice/src/cli/commands/stale_command.rs`\n\n**Implementation:**\n- Calculate staleness threshold from `--days` flag (default 30)\n- Reuse filter infrastructure from list_command/filter_builder.rs\n- Query tasks where `updated_at` is older than threshold\n- Apply additional list filters (path, type, labels, etc.)\n- Exclude closed tasks by default\n\n**Output:**\n- Reuse list_output formatting (rich/compact/oneline)\n- Include days-since-update in output\n- JSON output with last_updated timestamp\n- Sort by staleness (oldest first) by default\n\n**Reference:** @rules_engine/docs/lattice/appendix_cli_structure.md#lat-stale-options\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:15:27.825045-08:00","created_by":"dthurn","updated_at":"2026-01-18T08:07:13.254554-08:00","closed_at":"2026-01-18T08:07:13.254554-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.14.5","depends_on_id":"dr-epv.14","type":"parent-child","created_at":"2026-01-17T23:15:27.825789-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.14.5","depends_on_id":"dr-epv.14.2","type":"blocks","created_at":"2026-01-17T23:15:31.988526-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.14.6","title":"Blocked Command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the `lat blocked` command for showing tasks with unresolved blockers.\n\n**Files:**\n- `@rules_engine/src/lattice/src/cli/commands/blocked_command.rs`\n\n**Implementation:**\n- Query tasks where at least one `blocked_by` entry is not closed\n- Integrate with dependency_graph from `@rules_engine/src/lattice/src/task/dependency_graph.rs`\n- Apply filters: `--path`, `--limit`\n- Optional `--show-blockers` to display blocking tasks for each result\n\n**Output Format:**\n- Default: list of blocked tasks\n- With `--show-blockers`: nested output showing what blocks each task\n- JSON output including blockers array for each task\n\n**Example Output:**\n```\nBlocked tasks (3):\n  L1234X: task-name - description [P1]\n    Blocked by: L5678X (open), L9ABCX (open)\n```\n\n**Reference:** @rules_engine/docs/lattice/appendix_cli_structure.md#lat-blocked-options\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:15:40.935721-08:00","created_by":"dthurn","updated_at":"2026-01-18T07:38:55.489009-08:00","closed_at":"2026-01-18T07:38:55.489009-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.14.6","depends_on_id":"dr-epv.14","type":"parent-child","created_at":"2026-01-17T23:15:40.936645-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.14.6","depends_on_id":"dr-epv.14.2","type":"blocks","created_at":"2026-01-17T23:15:44.821977-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.14.7","title":"Changes Command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the `lat changes` command for showing recently changed documents.\n\n**Files:**\n- `@rules_engine/src/lattice/src/cli/commands/changes_command.rs`\n\n**Implementation:**\n- Parse `--since` argument as either date/time or git commit hash\n- Use git layer (`modified_files.rs`) to detect changed `.md` files\n- For date-based: find commits since date, extract changed files\n- For commit-based: use `git diff --name-only \u003ccommit\u003e..HEAD`\n- Filter to Lattice documents (files with valid frontmatter)\n- Display changed documents with change type (added/modified/deleted)\n\n**Output Format:**\n- List of changed documents with change indicator\n- Include document metadata (type, priority if task)\n- JSON output with change details\n\n**Edge Cases:**\n- Invalid date format (report clear error)\n- Unknown commit hash\n- No changes found\n\n**Reference:**\n- @rules_engine/docs/lattice/appendix_cli_structure.md#lat-changes-options\n- Uses git layer from @rules_engine/src/lattice/src/git/modified_files.rs\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:15:54.287208-08:00","created_by":"dthurn","updated_at":"2026-01-18T07:10:47.204013-08:00","closed_at":"2026-01-18T07:10:47.204013-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.14.7","depends_on_id":"dr-epv.14","type":"parent-child","created_at":"2026-01-17T23:15:54.288075-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.14.8","title":"Stats Command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the `lat stats` command for project statistics and health metrics.\n\n**Files:**\n- `@rules_engine/src/lattice/src/cli/commands/stats_command.rs`\n\n**Implementation:**\n- Query document counts by state (open/blocked/closed)\n- Compute priority breakdown (P0-P4)\n- Compute type breakdown (bug/feature/task/chore/doc)\n- Calculate recent activity for configurable period (`--period`, default 7 days)\n- Apply path filter (`--path`) for scoped statistics\n- Follow `bd stats` output format for compatibility\n\n**Output Sections:**\n- Summary: total documents, open tasks, blocked tasks, closed tasks\n- Priority distribution chart/table\n- Type distribution chart/table\n- Recent activity: created, closed, updated counts\n- Health metrics: stale count, orphan count\n\n**JSON Output:**\n- Structured object with all metrics\n- Compatible with `bd stats --json` where applicable\n\n**Reference:**\n- @rules_engine/docs/lattice/appendix_cli_structure.md#lat-stats-options\n- Follows bd stats format conventions\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:16:03.552201-08:00","created_by":"dthurn","updated_at":"2026-01-18T07:46:26.787195-08:00","closed_at":"2026-01-18T07:46:26.787195-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.14.8","depends_on_id":"dr-epv.14","type":"parent-child","created_at":"2026-01-17T23:16:03.55316-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.14.8","depends_on_id":"dr-epv.14.2","type":"blocks","created_at":"2026-01-17T23:16:07.935551-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.14.9","title":"Query Commands Post-Implementation Review","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nPerform structural review of Query Commands feature implementation.\n\n**Feature Reference:** @rules_engine/docs/lattice/lattice_implementation_plan.md#feature-query-commands\n\n**Review Questions:**\n\n1. **Scope Completeness:**\n   - Was the scope in `lattice_implementation_plan.md` complete?\n   - Are there items which should have been included but were not implemented?\n   - Are there items required for later work that are missing?\n\n2. **Specification Compliance:**\n   - Does the implementation fully satisfy the specification?\n   - Are all edge cases from the design documents handled?\n   - Are all filter options working correctly?\n   - Are all output formats (text/JSON/pretty) implemented?\n\n**Deliverables:**\n- Update documentation if gaps found\n- Add new implementation plan milestones if needed (do NOT modify current milestone)\n- Fix immediate issues found during review\n- Update `lattice_implementation_plan.md` notes if design assumptions changed\n\n**Files to Verify:**\n- `@rules_engine/src/lattice/src/cli/commands/list_command/`\n- `@rules_engine/src/lattice/src/cli/commands/ready_command/`\n- `@rules_engine/src/lattice/src/cli/commands/search_command.rs`\n- `@rules_engine/src/lattice/src/cli/commands/stale_command.rs`\n- `@rules_engine/src/lattice/src/cli/commands/blocked_command.rs`\n- `@rules_engine/src/lattice/src/cli/commands/changes_command.rs`\n- `@rules_engine/src/lattice/src/cli/commands/stats_command.rs`\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:16:19.700847-08:00","created_by":"dthurn","updated_at":"2026-01-18T08:36:56.836144-08:00","closed_at":"2026-01-18T08:36:56.836144-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.14.9","depends_on_id":"dr-epv.14","type":"parent-child","created_at":"2026-01-17T23:16:19.70157-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.14.9","depends_on_id":"dr-epv.14.3","type":"blocks","created_at":"2026-01-17T23:16:25.512023-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.14.9","depends_on_id":"dr-epv.14.4","type":"blocks","created_at":"2026-01-17T23:16:25.581975-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.14.9","depends_on_id":"dr-epv.14.5","type":"blocks","created_at":"2026-01-17T23:16:25.654818-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.14.9","depends_on_id":"dr-epv.14.6","type":"blocks","created_at":"2026-01-17T23:16:25.727068-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.14.9","depends_on_id":"dr-epv.14.7","type":"blocks","created_at":"2026-01-17T23:16:25.797087-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.14.9","depends_on_id":"dr-epv.14.8","type":"blocks","created_at":"2026-01-17T23:16:25.868341-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.15","title":"Hierarchy Commands Feature","description":"Implement commands for navigating the document tree structure in Lattice.\n\n**Scope:**\n- `lat tree` - Display directory structure with documents\n- `lat roots` - List all root documents with child counts\n- `lat children` - List documents under a root's directory\n\n**Dependencies:** Index Core, Task System (both completed)\n\n**Reference Documentation:**\n- @rules_engine/docs/lattice/lattice_design.md#hierarchy-commands\n- @rules_engine/docs/lattice/appendix_cli_structure.md#hierarchy-commands\n- @rules_engine/docs/lattice/lattice_implementation_plan.md (Feature: Hierarchy Commands)","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-17T23:18:30.74814-08:00","created_by":"dthurn","updated_at":"2026-01-17T23:18:35.015847-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.15","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-17T23:18:30.751134-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.15.1","title":"Implement lat tree command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the `lat tree` command that displays directory structure with documents.\n\n**File:** `rules_engine/src/lattice/src/cli/commands/tree_command.rs`\n\n**Command Signature:**\n```\nlat tree [path] [options]\n```\n\n**Options to implement:**\n- `--depth {n}`: Maximum depth to display\n- `--counts`: Show document counts per directory\n- `--tasks-only`: Only show task directories (containing tasks/)\n- `--docs-only`: Only show documentation directories (containing docs/)\n\n**Implementation Requirements:**\n- Walk directory structure starting from path (or repo root if omitted)\n- Display Lattice documents with their status (open/blocked/closed)\n- Use visual tree formatting (similar to Unix `tree` command)\n- Apply color theme from `cli/color_theme.rs`\n- Support `--json` output format\n- Query index for document metadata rather than re-parsing files\n\n**Reference:**\n- @rules_engine/docs/lattice/appendix_cli_structure.md#lat-tree-path-options\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:18:45.360118-08:00","created_by":"dthurn","updated_at":"2026-01-18T08:43:44.814794-08:00","closed_at":"2026-01-18T08:43:44.814794-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.15.1","depends_on_id":"dr-epv.15","type":"parent-child","created_at":"2026-01-17T23:18:45.360934-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.15.2","title":"Implement lat roots command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the `lat roots` command that lists all root documents with child counts.\n\n**File:** `rules_engine/src/lattice/src/cli/commands/roots_command.rs`\n\n**Command Signature:**\n```\nlat roots\n```\n\n**Implementation Requirements:**\n- Query the `directory_roots` table from Index Core (I11)\n- A root document is one whose filename matches its containing directory (e.g., `api/api.md`)\n- Display each root with its child count (tasks + docs under that directory)\n- Sort by path for consistent output\n- Support `--json` output format\n- Use consistent list formatting with other query commands\n\n**Output Format:**\n- Show Lattice ID, name, description, and child count\n- Use color theme for visual distinction\n\n**Index Query:**\n- Use `directory_roots.list_all()` to get all root documents\n- Count children via `directory_roots.get_children()` or separate query\n\n**Reference:**\n- @rules_engine/docs/lattice/appendix_cli_structure.md#lat-roots\n- @rules_engine/docs/lattice/lattice_design.md#root-documents-and-hierarchy\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:18:55.215056-08:00","created_by":"dthurn","updated_at":"2026-01-18T09:24:47.775242-08:00","closed_at":"2026-01-18T09:24:47.775242-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.15.2","depends_on_id":"dr-epv.15","type":"parent-child","created_at":"2026-01-17T23:18:55.215814-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.15.2","depends_on_id":"dr-epv.15.1","type":"blocks","created_at":"2026-01-17T23:18:59.204145-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.15.3","title":"Implement lat children command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the `lat children` command that lists documents under a root's directory.\n\n**File:** `rules_engine/src/lattice/src/cli/commands/children_command.rs`\n\n**Command Signature:**\n```\nlat children {root-id} [options]\n```\n\n**Arguments:**\n- `{root-id}`: Lattice ID of a root document\n\n**Options to implement:**\n- `--recursive`: Include documents from nested directories\n- `--tasks`: Only show tasks (documents in tasks/ directories)\n- `--docs`: Only show knowledge base documents (documents in docs/ directories)\n\n**Implementation Requirements:**\n- Look up the root document by ID\n- Validate it is actually a root document (filename matches directory)\n- List all documents under that root's directory\n- Apply task/docs filtering based on directory path patterns\n- Support `--json` output format\n- Handle case where ID is not a root document (error message)\n\n**Output Format:**\n- Similar to `lat list` output with ID, type, name, description\n- When `--recursive`, may use tree-like indentation to show structure\n\n**Reference:**\n- @rules_engine/docs/lattice/appendix_cli_structure.md#lat-children-root-id-options\n- @rules_engine/docs/lattice/lattice_design.md#root-documents-and-hierarchy\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:19:09.233789-08:00","created_by":"dthurn","updated_at":"2026-01-18T13:34:59.586149-08:00","closed_at":"2026-01-18T13:34:59.586149-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.15.3","depends_on_id":"dr-epv.15","type":"parent-child","created_at":"2026-01-17T23:19:09.234764-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.15.3","depends_on_id":"dr-epv.15.2","type":"blocks","created_at":"2026-01-17T23:19:13.468448-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.15.4","title":"Post-implementation review for Hierarchy Commands","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nPerform a post-implementation structural review of the Hierarchy Commands feature.\n\n**Feature Scope:**\n- `lat tree` - Directory structure display\n- `lat roots` - List root documents\n- `lat children` - List documents under a root\n\n**Review Questions:**\n\n**1) Scope Completeness:**\n- Was the scope in `@rules_engine/docs/lattice/lattice_implementation_plan.md` complete?\n- Are there items which should have been included but were not implemented?\n- Are there items now required for later work that are missing?\n\n**2) Specification Satisfaction:**\n- Does the implementation fully satisfy the specification in:\n  - @rules_engine/docs/lattice/appendix_cli_structure.md#hierarchy-commands\n  - @rules_engine/docs/lattice/lattice_design.md#root-documents-and-hierarchy\n- Are all edge cases handled?\n  - Empty directories\n  - Deeply nested structures\n  - Mixed task/doc directories\n  - Non-existent root IDs for `lat children`\n\n**Resolution Actions:**\nIf issues are found, resolve by:\n1. Updating documentation to clarify behavior\n2. Adding a *future* implementation plan milestone (do not modify current)\n3. Making immediate fixes if critical\n\n**Reference:**\n- @rules_engine/docs/lattice/lattice_implementation_plan.md (Feature: Hierarchy Commands)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T23:19:24.361164-08:00","created_by":"dthurn","updated_at":"2026-01-18T14:07:08.231225-08:00","closed_at":"2026-01-18T14:07:08.231225-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.15.4","depends_on_id":"dr-epv.15","type":"parent-child","created_at":"2026-01-17T23:19:24.366242-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.15.4","depends_on_id":"dr-epv.15.3","type":"blocks","created_at":"2026-01-17T23:19:27.753075-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.16","title":"Relationship Commands Feature","description":"Implement commands for exploring links between documents.\n\n**Goal:** Enable users to explore document relationships through link queries.\n\n**Depends on:** Link System, Index Core (both complete)\n\n**Commands to implement:**\n- `lat links-from {id}` - Show documents this document links to\n- `lat links-to {id}` - Show documents that link to this document\n- `lat path {id1} {id2}` - Find shortest path between documents\n- `lat orphans [options]` - Find documents with no incoming links\n- `lat impact {id}` - Analyze what would be affected by changes\n\n**Reference Documentation:**\n- @rules_engine/docs/lattice/appendix_cli_structure.md (Relationship Commands section)\n- @rules_engine/docs/lattice/appendix_linking_system.md (Bidirectional Queries section)\n- @rules_engine/docs/lattice/lattice_implementation_plan.md (Feature: Relationship Commands)\n\n**Files to create/implement:**\n- `rules_engine/src/lattice/src/cli/commands/links_from.rs`\n- `rules_engine/src/lattice/src/cli/commands/links_to.rs`\n- `rules_engine/src/lattice/src/cli/commands/path_command.rs`\n- `rules_engine/src/lattice/src/cli/commands/orphans_command.rs`\n- `rules_engine/src/lattice/src/cli/commands/impact_command.rs`\n\n**Existing infrastructure available:**\n- `link_queries.rs` has outgoing/incoming link queries\n- `reference_tracker.rs` has bidirectional reference support\n- Global options (--json, --verbose, --quiet) already defined","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-18T16:38:04.027375-08:00","created_by":"dthurn","updated_at":"2026-01-18T16:38:16.421475-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.16","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-18T16:38:04.028722-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.16.1","title":"Implement lat links-from command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement `lat links-from {id}` command to show documents a given document links to.\n\n**Command specification (from appendix_cli_structure.md):**\n- `lat links-from {id}` - Show documents this document links to\n- Supports global options: --json, --verbose, --quiet\n\n**Implementation requirements:**\n- Query outgoing links from the index using `link_queries.rs`\n- Display linked documents in consistent format (ID, name, description)\n- Support --json output for programmatic access\n- Handle case where document has no outgoing links gracefully\n- Validate that the provided ID exists\n\n**File to implement:**\n- `rules_engine/src/lattice/src/cli/commands/links_from.rs`\n\n**Files to update:**\n- `rules_engine/src/lattice/src/cli/commands/mod.rs` (add command to dispatch)\n- `rules_engine/src/lattice/src/cli/argument_parser.rs` (add command args)\n\n**Use existing infrastructure:**\n- `link_queries::get_outgoing_links()` or similar from index module\n- `output_format.rs` for consistent document display\n- Command dispatch pattern from existing commands like `show_command`\n\n**Reference:**\n- @rules_engine/docs/lattice/appendix_cli_structure.md (Relationship Commands)\n- @rules_engine/docs/lattice/appendix_linking_system.md (Bidirectional Queries)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-18T16:39:02.403278-08:00","created_by":"dthurn","updated_at":"2026-01-18T16:40:45.273887-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.16.1","depends_on_id":"dr-epv.16","type":"parent-child","created_at":"2026-01-18T16:39:02.404972-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.16.2","title":"Implement lat links-to command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement `lat links-to {id}` command to show documents that link to a given document.\n\n**Command specification (from appendix_cli_structure.md):**\n- `lat links-to {id}` - Show documents that link to this document (backlinks)\n- Supports global options: --json, --verbose, --quiet\n\n**Implementation requirements:**\n- Query incoming links (backlinks) from the index using `link_queries.rs`\n- Display linking documents in consistent format (ID, name, description)\n- Support --json output for programmatic access\n- Handle case where document has no incoming links gracefully\n- Validate that the provided ID exists\n\n**File to implement:**\n- `rules_engine/src/lattice/src/cli/commands/links_to.rs`\n\n**Files to update:**\n- `rules_engine/src/lattice/src/cli/commands/mod.rs` (add command to dispatch)\n- `rules_engine/src/lattice/src/cli/argument_parser.rs` (add command args)\n\n**Use existing infrastructure:**\n- `link_queries::get_incoming_links()` or similar from index module\n- `output_format.rs` for consistent document display\n- Pattern established by links_from.rs implementation\n\n**Reference:**\n- @rules_engine/docs/lattice/appendix_cli_structure.md (Relationship Commands)\n- @rules_engine/docs/lattice/appendix_linking_system.md (Bidirectional Queries)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-18T16:39:04.520574-08:00","created_by":"dthurn","updated_at":"2026-01-18T16:40:45.490649-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.16.2","depends_on_id":"dr-epv.16","type":"parent-child","created_at":"2026-01-18T16:39:04.521354-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.16.2","depends_on_id":"dr-epv.16.1","type":"blocks","created_at":"2026-01-18T16:39:26.574352-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.16.3","title":"Implement lat path command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement `lat path {id1} {id2}` command to find shortest path between documents.\n\n**Command specification (from appendix_cli_structure.md):**\n- `lat path {id1} {id2}` - Find shortest path between documents\n- Supports global options: --json, --verbose, --quiet\n\n**Implementation requirements:**\n- Use BFS (Breadth-First Search) on the link graph to find shortest path\n- Report if no path exists between the two documents\n- Display the path as a sequence of document IDs/names\n- Validate that both provided IDs exist\n- Handle edge cases:\n  - Same document for both IDs (path length 0)\n  - Documents with no links\n  - Very long paths (consider adding depth limit option)\n\n**File to implement:**\n- `rules_engine/src/lattice/src/cli/commands/path_command.rs`\n\n**Files to update:**\n- `rules_engine/src/lattice/src/cli/commands/mod.rs` (add command to dispatch)\n- `rules_engine/src/lattice/src/cli/argument_parser.rs` (add command args)\n\n**Algorithm notes:**\n- Build adjacency list from links table\n- Run BFS from source document\n- Track parent pointers to reconstruct path\n- Consider bidirectional BFS for large graphs (optional optimization)\n\n**Reference:**\n- @rules_engine/docs/lattice/appendix_cli_structure.md (Relationship Commands)\n- @rules_engine/docs/lattice/appendix_linking_system.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-18T16:39:05.233334-08:00","created_by":"dthurn","updated_at":"2026-01-18T16:40:45.678702-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.16.3","depends_on_id":"dr-epv.16","type":"parent-child","created_at":"2026-01-18T16:39:05.23445-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.16.3","depends_on_id":"dr-epv.16.2","type":"blocks","created_at":"2026-01-18T16:39:27.471558-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.16.4","title":"Implement lat orphans command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement `lat orphans` command to find documents with no incoming links.\n\n**Command specification (from appendix_cli_structure.md):**\n- `lat orphans [options]` - Find documents with no incoming links\n- Options:\n  - `--exclude-roots` - Don't report root documents (they naturally have few incoming links)\n  - `--path {prefix}` - Check only under path\n- Supports global options: --json, --verbose, --quiet\n\n**Implementation requirements:**\n- Query documents where backlink_count = 0 (or no entries in links table as target)\n- Filter results based on --exclude-roots and --path options\n- Display orphaned documents in consistent format\n- Handle case where no orphans exist\n- Consider whether closed tasks should be included (default: probably exclude)\n\n**File to implement:**\n- `rules_engine/src/lattice/src/cli/commands/orphans_command.rs`\n\n**Files to update:**\n- `rules_engine/src/lattice/src/cli/commands/mod.rs` (add command to dispatch)\n- `rules_engine/src/lattice/src/cli/argument_parser.rs` (add command args)\n\n**Use existing infrastructure:**\n- `link_queries.rs` for backlink counting\n- `root_detection.rs` for --exclude-roots filtering\n- `document_filter.rs` for path prefix filtering\n\n**Reference:**\n- @rules_engine/docs/lattice/appendix_cli_structure.md (Relationship Commands)\n- @rules_engine/docs/lattice/appendix_linking_system.md (Orphan Detection section)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-18T16:39:06.561267-08:00","created_by":"dthurn","updated_at":"2026-01-18T16:40:45.868391-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.16.4","depends_on_id":"dr-epv.16","type":"parent-child","created_at":"2026-01-18T16:39:06.562171-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.16.4","depends_on_id":"dr-epv.16.3","type":"blocks","created_at":"2026-01-18T16:39:28.188774-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.16.5","title":"Implement lat impact command","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement `lat impact {id}` command for change impact analysis.\n\n**Command specification (from appendix_cli_structure.md):**\n- `lat impact {id}` - Analyze what would be affected by changes to document\n- Supports global options: --json, --verbose, --quiet\n\n**Implementation requirements:**\n- Recursive backlink traversal starting from the specified document\n- Show dependency chain (what documents would be affected by changes)\n- Display affected documents grouped by distance/depth from source\n- Handle circular references without infinite loops\n- Validate that the provided ID exists\n\n**File to implement:**\n- `rules_engine/src/lattice/src/cli/commands/impact_command.rs`\n\n**Files to update:**\n- `rules_engine/src/lattice/src/cli/commands/mod.rs` (add command to dispatch)\n- `rules_engine/src/lattice/src/cli/argument_parser.rs` (add command args)\n\n**Algorithm notes:**\n- Use BFS or DFS with visited set to traverse backlinks\n- Track depth/distance from source document\n- Consider maximum depth limit for very large dependency graphs\n- May want to distinguish between direct and transitive impact\n\n**Use existing infrastructure:**\n- `reference_tracker.rs` for bidirectional reference queries\n- `dependency_graph.rs` patterns for traversal\n\n**Reference:**\n- @rules_engine/docs/lattice/appendix_cli_structure.md (Relationship Commands)\n- @rules_engine/docs/lattice/appendix_linking_system.md (Bidirectional Queries)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-18T16:39:07.651399-08:00","created_by":"dthurn","updated_at":"2026-01-18T16:40:46.075936-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.16.5","depends_on_id":"dr-epv.16","type":"parent-child","created_at":"2026-01-18T16:39:07.652186-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.16.5","depends_on_id":"dr-epv.16.4","type":"blocks","created_at":"2026-01-18T16:39:29.075091-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.16.6","title":"Relationship Commands post-implementation review","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nPerform a post-implementation structural review of the Relationship Commands feature.\n\n**Feature summary:**\nThis feature implements commands for exploring links between documents:\n- `lat links-from {id}` - Show outgoing links\n- `lat links-to {id}` - Show incoming links (backlinks)\n- `lat path {id1} {id2}` - Find shortest path between documents\n- `lat orphans [options]` - Find documents with no incoming links\n- `lat impact {id}` - Analyze change impact via backlink traversal\n\n**Reference documentation:**\n- @rules_engine/docs/lattice/lattice_implementation_plan.md (Feature: Relationship Commands)\n- @rules_engine/docs/lattice/appendix_cli_structure.md (Relationship Commands section)\n- @rules_engine/docs/lattice/appendix_linking_system.md\n\n**Review questions to answer:**\n\n**1) Scope completeness:**\n- Was the scope in `lattice_implementation_plan.md` complete?\n- Are there items that should have been included but weren't implemented?\n- Are there items required for later work that need to be added to a future milestone?\n\n**2) Specification conformance:**\n- Does the implementation fully satisfy the specification?\n- Are edge cases properly handled?\n- Do all commands support the global options (--json, --verbose, --quiet)?\n- Is error handling consistent with other commands?\n\n**Actions to take if issues found:**\n1. Update documentation if specs were unclear\n2. Add items to a *future* implementation plan milestone (do NOT modify current milestone)\n3. Fix minor issues immediately if trivial\n\n**Additional checks:**\n- Verify test coverage for all commands\n- Check that file layout matches @rules_engine/docs/lattice/appendix_file_layout.md\n- Verify argument parser integration is complete\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-18T16:39:52.830626-08:00","created_by":"dthurn","updated_at":"2026-01-18T16:40:46.260365-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.16.6","depends_on_id":"dr-epv.16","type":"parent-child","created_at":"2026-01-18T16:39:52.831556-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.16.6","depends_on_id":"dr-epv.16.5","type":"blocks","created_at":"2026-01-18T16:39:58.076066-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.2","title":"Git Layer: Git integration abstraction for document discovery and change detection","description":"Abstract git operations behind a trait for testing. Implement document discovery and change detection.\n\n## Depends On\n- Foundation feature (for error types, logging)\n\n## Exports\n- `GitOps` trait for dependency injection\n- `RealGit` production implementation\n- `ModifiedFiles` detection for reconciliation\n- Repository edge case detection and handling\n\n## Design References\n- @rules_engine/docs/lattice/appendix_git_integration.md\n- @rules_engine/docs/lattice/appendix_git_edge_cases.md\n- @rules_engine/docs/lattice/appendix_file_layout.md (git/ section)\n\n## Files\nAll implementation in `rules_engine/src/lattice/src/git/`:\n- `mod.rs` - Module declarations only\n- `git_ops.rs` - GitOps trait definition\n- `real_git.rs` - Production implementation (shells out to git)\n- `modified_files.rs` - Change detection via git diff/status\n- `repo_detection.rs` - Detect repo configuration (shallow, sparse, etc.)\n- `edge_cases.rs` - Handling for worktrees, submodules, bare repos\n- `conflict_detection.rs` - Detect merge conflicts, in-progress operations\n","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2026-01-16T12:52:42.229577-08:00","created_by":"dthurn","updated_at":"2026-01-16T14:06:05.277892-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.2","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-16T12:52:42.231066-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.2.1","title":"GitOps Trait Definition","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nDefine the `GitOps` trait that abstracts all git operations for dependency injection.\n\n## Implementation\n**File:** `rules_engine/src/lattice/src/git/git_ops.rs`\n\n## Trait Methods\nDefine trait with methods:\n- `ls_files(pattern: \u0026str)` - List tracked files matching pattern\n- `diff(from_commit: \u0026str, to_commit: \u0026str, pattern: \u0026str)` - Files changed between commits\n- `status(pattern: \u0026str)` - Uncommitted changes (staged and unstaged)\n- `rev_parse(ref: \u0026str)` - Resolve ref to commit hash (e.g., HEAD)\n- `log(path: Option\u003c\u0026str\u003e, format: \u0026str, limit: usize)` - Commit history\n- `config_get(key: \u0026str)` - Read git config value\n\n## Requirements\n- All methods return `Result\u003cT, LatticeError\u003e`\n- Trait must be object-safe for dependency injection\n- Error handling via `LatticeError::GitError` variant (from Foundation)\n- Methods should accept pathspec patterns (e.g., `*.md`)\n\n## Design References\n- @rules_engine/docs/lattice/appendix_git_integration.md (Required Git Operations section)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:53:11.371391-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:42.155328-08:00","closed_at":"2026-01-16T13:06:53.059212-08:00","close_reason":"Implemented GitOps trait with ls_files, diff, status, rev_parse, log, and config_get methods. Added FileStatus struct with helper methods. Tests added for FileStatus behavior.","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.2.1","depends_on_id":"dr-epv.2","type":"parent-child","created_at":"2026-01-16T12:53:11.372175-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.2.2","title":"RealGit Implementation","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the `GitOps` trait by shelling out to the git CLI.\n\n## Implementation\n**File:** `rules_engine/src/lattice/src/git/real_git.rs`\n\n## Functionality\n- Implement all `GitOps` trait methods\n- Shell out to git CLI for each operation\n- Parse git command output into structured data\n- Handle git errors and convert to `LatticeError::GitError`\n\n## Git Commands to Wrap\n- `git ls-files '\u003cpattern\u003e'` - Document discovery\n- `git diff --name-only \u003ccommit\u003e..HEAD -- '\u003cpattern\u003e'` - Change detection\n- `git status --porcelain -- '\u003cpattern\u003e'` - Uncommitted changes\n- `git rev-parse \u003cref\u003e` - Resolve references\n- `git log -\u003cn\u003e --format='\u003cformat\u003e' -- \u003cpath\u003e` - Commit history\n- `git config --get \u003ckey\u003e` - Configuration values\n\n## Error Handling\n- Parse git stderr for meaningful error messages\n- Distinguish between \"command failed\" vs \"git error\"\n- Log all git commands and their results via tracing\n\n## Design References\n- @rules_engine/docs/lattice/appendix_git_integration.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:53:12.581312-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:42.234925-08:00","closed_at":"2026-01-16T13:46:31.89809-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.2.2","depends_on_id":"dr-epv.2","type":"parent-child","created_at":"2026-01-16T12:53:12.582001-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.2.2","depends_on_id":"dr-epv.2.1","type":"blocks","created_at":"2026-01-16T12:53:22.929641-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.2.3","title":"Document Discovery via Git","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement document discovery and change detection functions using GitOps trait.\n\n## Implementation\n**File:** `rules_engine/src/lattice/src/git/modified_files.rs`\n\n## Core Functions\n\n### Full Document Enumeration\n- `list_all_documents(git: \u0026dyn GitOps) -\u003e Result\u003cVec\u003cPathBuf\u003e\u003e`\n- Uses `git ls-files '*.md'`\n- Returns all tracked markdown files\n- Excludes gitignored files automatically\n\n### Change Detection (Committed)\n- `list_changed_documents(git: \u0026dyn GitOps, since_commit: \u0026str) -\u003e Result\u003cVec\u003cPathBuf\u003e\u003e`\n- Uses `git diff --name-only \u003ccommit\u003e..HEAD -- '*.md'`\n- Returns files modified since a specific commit\n- Used for incremental reconciliation\n\n### Change Detection (Uncommitted)\n- `list_uncommitted_changes(git: \u0026dyn GitOps) -\u003e Result\u003cVec\u003cPathBuf\u003e\u003e`\n- Uses `git status --porcelain -- '*.md'`\n- Returns staged and unstaged modifications\n- Parse porcelain output to extract paths\n\n## Requirements\n- Return `Vec\u003cPathBuf\u003e` for all operations\n- Handle pathspec filtering consistently\n- Log document counts at debug level\n\n## Design References\n- @rules_engine/docs/lattice/appendix_git_integration.md (Document Discovery section)\n- @rules_engine/docs/lattice/appendix_indexing.md (Reconciliation section)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:53:14.797303-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:45:23.814843-08:00","closed_at":"2026-01-16T15:45:23.814845-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.2.3","depends_on_id":"dr-epv.2","type":"parent-child","created_at":"2026-01-16T12:53:14.797978-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.2.3","depends_on_id":"dr-epv.2.2","type":"blocks","created_at":"2026-01-16T12:53:23.713987-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.2.4","title":"Repository Edge Case Detection","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nDetect and handle non-standard git repository configurations.\n\n## Implementation Files\n- `rules_engine/src/lattice/src/git/repo_detection.rs` - Configuration detection\n- `rules_engine/src/lattice/src/git/edge_cases.rs` - Edge case handling logic\n- `rules_engine/src/lattice/src/git/conflict_detection.rs` - In-progress git operations\n\n## Detection Functions (repo_detection.rs)\n\n### Repository Configuration Struct\nDefine `RepoConfig` with detected state:\n- `is_shallow: bool` - Shallow clone\n- `is_partial: bool` - Partial clone (blobless/treeless)\n- `partial_filter: Option\u003cString\u003e` - Filter specification\n- `is_sparse: bool` - Sparse checkout enabled\n- `is_worktree: bool` - Is a worktree (not main repo)\n- `main_git_dir: PathBuf` - Path to main .git directory\n- `has_submodules: bool` - Submodules present\n- `is_bare: bool` - Bare repository (not supported)\n- `in_progress_op: Option\u003cGitOp\u003e` - Rebase/merge/cherry-pick in progress\n\n### Detection Methods\n- Check `.git/shallow` for shallow clones\n- Check `git config --get remote.origin.promisor` for partial clones\n- Check `git config --get core.sparseCheckout` for sparse checkout\n- Check if `.git` is file vs directory for worktrees\n- Check `.gitmodules` for submodules\n- Check `.git/MERGE_HEAD`, `.git/rebase-merge`, etc. for in-progress ops\n\n## Cache Management\n- Cache detection results in `.lattice/repo_config.json`\n- Invalidate when `.git` directory mtime changes\n- Re-detect on cache miss or invalidation\n\n## Conflict Detection (conflict_detection.rs)\n- `has_conflict_markers(content: \u0026str) -\u003e bool`\n- Detect `\u003c\u003c\u003c\u003c\u003c\u003c\u003c`, `=======`, `\u003e\u003e\u003e\u003e\u003e\u003e\u003e` in file content\n- Used during document parsing to skip conflicted files\n\n## Design References\n- @rules_engine/docs/lattice/appendix_git_edge_cases.md (comprehensive)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:53:16.010009-08:00","created_by":"dthurn","updated_at":"2026-01-16T19:48:14.836498-08:00","closed_at":"2026-01-16T19:48:14.836498-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.2.4","depends_on_id":"dr-epv.2","type":"parent-child","created_at":"2026-01-16T12:53:16.01071-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.2.4","depends_on_id":"dr-epv.2.3","type":"blocks","created_at":"2026-01-16T12:53:24.596331-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.3","title":"Document Model: Parse and serialize Lattice documents with frontmatter validation","description":"## Goal\n\nParse and serialize Lattice documents, validate frontmatter fields, and provide document I/O utilities.\n\n## Depends On\n\n- Foundation (dr-epv.1) - for LatticeId types, LatticeError types\n\n## Exports\n\n- `Document` struct with frontmatter and body\n- `Frontmatter` struct with all fields\n- Parse/serialize functions\n- Field validation\n\n## Files\n\nAll files in `rules_engine/src/lattice/src/document/`:\n- `mod.rs` - Module declarations only\n- `frontmatter_schema.rs` - Field definitions, allowed keys\n- `frontmatter_parser.rs` - YAML extraction and parsing\n- `field_validation.rs` - Type checking, value validation\n- `document_reader.rs` - Load and parse complete documents\n- `document_writer.rs` - Serialize documents back to files\n- `markdown_body.rs` - Body content handling\n\n## Design Reference\n\n- Main design: @rules_engine/docs/lattice/lattice_design.md#document-structure\n- Task tracking: @rules_engine/docs/lattice/appendix_task_tracking.md\n- File layout: @rules_engine/docs/lattice/appendix_file_layout.md\n","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2026-01-16T12:57:54.738438-08:00","created_by":"dthurn","updated_at":"2026-01-16T14:06:05.368101-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.3","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-16T12:57:54.739206-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.3.1","title":"Frontmatter Schema Definition","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n## Goal\n\nDefine all frontmatter fields as a typed Rust struct for Lattice documents.\n\n## File\n\n`rules_engine/src/lattice/src/document/frontmatter_schema.rs`\n\n## Implementation\n\nDefine `Frontmatter` struct with all fields:\n\n**Required fields (all documents):**\n- `lattice-id`: LatticeId - unique document identifier\n- `name`: String - lowercase-hyphen format, derived from filename, max 64 chars\n- `description`: String - human-readable summary, max 1024 chars\n\n**Optional identity fields:**\n- `parent-id`: Option\u003cLatticeId\u003e - ID of parent document, auto-populated from directory root\n\n**Task tracking fields (tasks only):**\n- `task-type`: Option\u003cTaskType\u003e - bug/feature/task/chore\n- `priority`: Option\u003cu8\u003e - 0-4 (0 highest)\n- `labels`: Vec\u003cString\u003e - arbitrary string labels\n- `blocking`: Vec\u003cLatticeId\u003e - tasks with hard dependencies on this task\n- `blocked-by`: Vec\u003cLatticeId\u003e - tasks this task depends on\n- `discovered-from`: Vec\u003cLatticeId\u003e - parent tasks from which this was discovered\n\n**Timestamp fields:**\n- `created-at`: Option\u003cDateTime\u003e - ISO 8601\n- `updated-at`: Option\u003cDateTime\u003e - ISO 8601\n- `closed-at`: Option\u003cDateTime\u003e - ISO 8601\n\n**Skill integration:**\n- `skill`: bool - enables Claude Skill generation\n\n## Design Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#yaml-frontmatter\n- @rules_engine/docs/lattice/appendix_task_tracking.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:58:24.428469-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:42.475921-08:00","closed_at":"2026-01-16T13:08:28.266736-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.3.1","depends_on_id":"dr-epv.3","type":"parent-child","created_at":"2026-01-16T12:58:24.429251-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.3.2","title":"Frontmatter Parser","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n## Goal\n\nExtract and parse YAML frontmatter from markdown documents into the Frontmatter struct.\n\n## File\n\n`rules_engine/src/lattice/src/document/frontmatter_parser.rs`\n\n## Implementation\n\n- Extract YAML content between `---` markers at document start\n- Use `serde_yaml` crate for deserialization into Frontmatter struct\n- Return `LatticeError::InvalidFrontmatter` on parse failure with clear error message\n- Handle and reject unknown/invalid keys (linter rule E003)\n- Preserve original YAML for round-tripping when possible\n\n## Edge Cases\n\n- Missing opening/closing `---` markers\n- Empty frontmatter\n- Malformed YAML syntax\n- Unknown keys that don't map to Frontmatter fields\n- Missing required fields (lattice-id, name, description)\n\n## Design Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#yaml-frontmatter\n- @rules_engine/docs/lattice/appendix_error_handling.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:58:25.245589-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:42.552719-08:00","closed_at":"2026-01-16T14:00:21.428941-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.3.2","depends_on_id":"dr-epv.3","type":"parent-child","created_at":"2026-01-16T12:58:25.246286-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.3.2","depends_on_id":"dr-epv.3.1","type":"blocks","created_at":"2026-01-16T12:58:35.59448-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.3.3","title":"Field Validation","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n## Goal\n\nValidate frontmatter field values for type correctness and semantic constraints.\n\n## File\n\n`rules_engine/src/lattice/src/document/field_validation.rs`\n\n## Validation Rules\n\n**name field:**\n- Format: lowercase letters, hyphens only (derived from filename)\n- Max length: 64 characters\n- Must match filename (underscores→hyphens, no .md extension)\n- Linter rule E008 for mismatches\n\n**description field:**\n- Non-empty string required\n- Max length: 1024 characters\n\n**priority field:**\n- Integer 0-4 only (0=critical, 4=backlog)\n- Required for tasks (documents with task-type)\n\n**task-type field:**\n- Enum: bug, feature, task, chore\n- Case-insensitive parsing\n\n**ID references (blocking, blocked-by, discovered-from):**\n- Each entry must be valid LatticeId format\n- Cross-reference validation deferred to linter (needs index)\n\n**Timestamps:**\n- ISO 8601 format validation\n\n## Error Handling\n\n- Return specific validation errors with field name and reason\n- Support batch validation (collect all errors, not just first)\n\n## Design Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#yaml-frontmatter\n- @rules_engine/docs/lattice/appendix_linter.md (rules E003-E010)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:58:27.034061-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:45:39.35586-08:00","closed_at":"2026-01-16T15:45:39.355863-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.3.3","depends_on_id":"dr-epv.3","type":"parent-child","created_at":"2026-01-16T12:58:27.034771-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.3.3","depends_on_id":"dr-epv.3.2","type":"blocks","created_at":"2026-01-16T12:58:36.295544-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.3.4","title":"Document Reader and Writer","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n## Goal\n\nProvide document I/O operations for reading and writing Lattice documents.\n\n## Files\n\n- `rules_engine/src/lattice/src/document/document_reader.rs` - loading documents\n- `rules_engine/src/lattice/src/document/document_writer.rs` - serializing documents\n- `rules_engine/src/lattice/src/document/markdown_body.rs` - body content utilities\n\n## Document Reader\n\n- Read complete document from filesystem path\n- Split content into frontmatter (YAML) and body (markdown)\n- Parse frontmatter using frontmatter_parser module\n- Return `Document` struct with both components\n- Handle encoding (UTF-8 with BOM detection)\n\n## Document Writer\n\n- Serialize `Document` struct back to file\n- Format: frontmatter YAML + `---` separator + body content\n- **Atomic write**: write to temp file, then rename (prevents corruption)\n- Preserve body content exactly (no reformatting unless explicitly requested)\n- Update `updated-at` timestamp on write\n\n## Markdown Body Utilities\n\n- Extract body content (everything after frontmatter)\n- Utilities for appending content to body\n- Line counting for 500-line soft limit checks\n- Content manipulation helpers for `lat split` command\n\n## Design Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#document-structure\n- @rules_engine/docs/lattice/appendix_file_layout.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:58:27.846951-08:00","created_by":"dthurn","updated_at":"2026-01-16T19:43:56.105151-08:00","closed_at":"2026-01-16T19:43:56.105151-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.3.4","depends_on_id":"dr-epv.3","type":"parent-child","created_at":"2026-01-16T12:58:27.847627-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.3.4","depends_on_id":"dr-epv.3.3","type":"blocks","created_at":"2026-01-16T12:58:37.182523-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4","title":"Index Core: SQLite schema, connection management, and core queries","description":"SQLite schema, connection management, and core queries for the Lattice index.\nThe index serves as a performance cache for document metadata - git remains\nthe source of truth, and any index state can be safely deleted and rebuilt.\n\n## Scope\n\n- Schema definition for all tables (documents, links, labels, views, etc.)\n- Connection pool with WAL mode and optimized PRAGMA settings\n- Document CRUD operations and filter queries\n- Link queries (outgoing, incoming, bidirectional)\n- Label queries and management\n- Full-text search via FTS5\n- View tracking for `lat overview` ranking\n- Content cache (L2) for frequently accessed documents\n\n## Key Design Principles\n\n- Index is ephemeral - can always be rebuilt from git\n- WAL mode for concurrent readers/writers\n- Trigger-maintained denormalized counts for query performance\n- FTS5 with external content mode (no duplicate storage)\n\n## References\n\n- Schema: @rules_engine/docs/lattice/appendix_indexing.md\n- File layout: @rules_engine/docs/lattice/appendix_file_layout.md\n- Implementation plan: @rules_engine/docs/lattice/lattice_implementation_plan.md","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2026-01-16T21:01:36.053704-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:01:48.593077-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-16T21:01:36.05484-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4.1","title":"Schema Definition: SQLite table definitions and triggers","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nDefine SQLite schema for the Lattice index in `schema_definition.rs`.\n\n## Tables to Define\n\n- `documents`: Core document metadata (id, path, name, description, task_type,\n  priority, timestamps, computed flags like is_closed, is_root, in_tasks_dir)\n- `links`: Source-to-target relationships with type (body/frontmatter)\n- `labels`: Document-to-label associations\n- `index_metadata`: Single-row table for schema_version, last_commit, last_indexed\n- `client_counters`: Per-client document counter (client_id PK, next_counter)\n- `directory_roots`: Precomputed hierarchy for template composition\n- `content_cache`: L2 body content cache with mtime validation\n- `views`: View counts and last-viewed timestamps\n\n## Triggers\n\n- Maintain denormalized `link_count` and `backlink_count` on documents table\n- Maintain `view_count` denormalization from views to documents table\n- Keep FTS5 index in sync via insert/update/delete triggers\n\n## FTS5 Configuration\n\n- External content mode (no duplicate storage)\n- Configure `automerge=4` for automatic segment merging\n\n## Indices\n\n- documents: path (unique), name\n- links: source_id, target_id\n- labels: document_id, label\n\n## References\n\n- Schema details: @rules_engine/docs/lattice/appendix_indexing.md#schema\n- File: @rules_engine/src/lattice/src/index/schema_definition.rs\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T21:02:53.11199-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:51:58.156416-08:00","closed_at":"2026-01-16T21:51:58.156416-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4.1","depends_on_id":"dr-epv.4","type":"parent-child","created_at":"2026-01-16T21:02:53.112754-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4.2","title":"Connection Pool: SQLite connection handling with WAL mode","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement SQLite connection management in `connection_pool.rs`.\n\n## Connection Setup\n\nOn every connection open, execute:\n- `PRAGMA journal_mode = WAL`\n- `PRAGMA synchronous = NORMAL`\n- `PRAGMA temp_store = MEMORY`\n- `PRAGMA mmap_size = 268435456` (256MB)\n- `PRAGMA busy_timeout = 5000`\n\n## Connection Lifecycle\n\n- Run `PRAGMA optimize` before closing connections\n- After bulk operations: `PRAGMA wal_checkpoint(TRUNCATE)`\n- Index location: `.lattice/index.sqlite` (gitignored)\n\n## Performance Notes\n\n- WAL mode: concurrent readers/writers, 30-60% faster commits\n- Synchronous NORMAL: safe with WAL, acceptable for rebuildable cache\n- Memory-mapped I/O: set mmap_size to expected index size\n- Disable mmap on network filesystems (set to 0)\n\n## Target Performance\n\n- Connection open + configure: \u003c5ms\n- Document lookup by ID: \u003c1ms\n\n## References\n\n- SQLite config: @rules_engine/docs/lattice/appendix_indexing.md#sqlite-configuration\n- File: @rules_engine/src/lattice/src/index/connection_pool.rs\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T21:02:54.325587-08:00","created_by":"dthurn","updated_at":"2026-01-16T22:13:21.041398-08:00","closed_at":"2026-01-16T22:13:21.041398-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4.2","depends_on_id":"dr-epv.4","type":"parent-child","created_at":"2026-01-16T21:02:54.326312-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.4.2","depends_on_id":"dr-epv.4.1","type":"blocks","created_at":"2026-01-16T21:03:21.561797-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4.3","title":"Document Queries: CRUD operations and filter queries","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement document CRUD operations in `document_queries.rs`.\n\n## Core Operations\n\n- Insert document (from parsed Document struct)\n- Update document metadata\n- Delete document by ID\n- Lookup by ID, path, or name\n\n## Filter Queries\n\nBuild SQL queries supporting filters for:\n- State: open, blocked, closed (via is_closed flag)\n- Priority: 0-4\n- Task type: bug, feature, task, chore\n- Labels (AND/OR semantics)\n- Path prefix (for directory-scoped queries)\n- Timestamp ranges (created_at, updated_at, closed_at)\n- Root documents only (is_root = 1)\n- Directory type (in_tasks_dir, in_docs_dir)\n\n## Batch Operations\n\n- Insert multiple documents in single transaction\n- Update multiple documents atomically\n- Delete documents by ID list or path prefix\n\n## Query Building\n\n- Support `--include-closed` flag (default excludes closed)\n- Support sorting by various columns\n- Support limit and offset for pagination\n\n## References\n\n- Schema: @rules_engine/docs/lattice/appendix_indexing.md#documents\n- File: @rules_engine/src/lattice/src/index/document_queries.rs\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T21:02:55.510273-08:00","created_by":"dthurn","updated_at":"2026-01-17T05:36:40.889458-08:00","closed_at":"2026-01-17T05:36:40.889458-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4.3","depends_on_id":"dr-epv.4","type":"parent-child","created_at":"2026-01-16T21:02:55.510968-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.4.3","depends_on_id":"dr-epv.4.2","type":"blocks","created_at":"2026-01-16T21:03:22.644129-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4.4","title":"Link Queries: Bidirectional link tracking","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement link table queries in `link_queries.rs`.\n\n## Core Operations\n\n- Insert links for a document (batch operation for efficiency)\n- Delete all links from a document (for re-indexing)\n- Delete specific link by source + target\n\n## Query Operations\n\n- **Outgoing links** (links-from): Query links where source_id = document\n- **Incoming links** (links-to/backlinks): Query links where target_id = document\n- Filter by link_type ('body' or 'frontmatter')\n- Include position for ordering (links appear in document order)\n\n## Link Metadata\n\nEach link record contains:\n- source_id: Lattice ID of linking document\n- target_id: Lattice ID of linked document\n- link_type: 'body' or 'frontmatter'\n- position: Order of appearance in source document\n\n## Usage by Commands\n\n- `lat links-from \u003cid\u003e`: Show outgoing links\n- `lat links-to \u003cid\u003e`: Show incoming links (backlinks)\n- `lat impact \u003cid\u003e`: Recursive backlink traversal\n- `lat orphans`: Documents with zero incoming links\n\n## References\n\n- Schema: @rules_engine/docs/lattice/appendix_indexing.md#links\n- Linking system: @rules_engine/docs/lattice/appendix_linking_system.md\n- File: @rules_engine/src/lattice/src/index/link_queries.rs\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T21:02:57.098044-08:00","created_by":"dthurn","updated_at":"2026-01-17T07:01:14.703203-08:00","closed_at":"2026-01-17T07:01:14.703203-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4.4","depends_on_id":"dr-epv.4","type":"parent-child","created_at":"2026-01-16T21:02:57.098781-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.4.4","depends_on_id":"dr-epv.4.3","type":"blocks","created_at":"2026-01-16T21:03:23.647472-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4.5","title":"Label Queries: Label management and queries","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement label queries in `label_queries.rs`.\n\n## Core Operations\n\n- Add label to document\n- Remove label from document\n- Check if document has label\n- Get all labels for a document\n\n## Query Operations\n\n- Find documents by label (single label)\n- Find documents by labels (AND semantics: all labels required)\n- Find documents by labels (OR semantics: any label matches)\n- List all unique labels in repository with counts\n\n## Batch Operations\n\n- Add label to multiple documents\n- Remove label from multiple documents\n- Sync all labels for a document (replace existing with new set)\n\n## Index Support\n\n- Index on (document_id, label) for fast document lookup\n- Index on (label, document_id) for fast label searches\n\n## Usage by Commands\n\n- `lat label add \u003cid\u003e \u003clabel\u003e`: Add label to document\n- `lat label remove \u003cid\u003e \u003clabel\u003e`: Remove label from document\n- `lat label list \u003cid\u003e`: Show labels on document\n- `lat label list-all`: Show all labels with counts\n- `lat list --label=X`: Filter by label\n\n## References\n\n- Schema: @rules_engine/docs/lattice/appendix_indexing.md#labels\n- File: @rules_engine/src/lattice/src/index/label_queries.rs\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T21:02:58.297841-08:00","created_by":"dthurn","updated_at":"2026-01-17T07:22:00.168512-08:00","closed_at":"2026-01-17T07:22:00.168512-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4.5","depends_on_id":"dr-epv.4","type":"parent-child","created_at":"2026-01-16T21:02:58.298995-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.4.5","depends_on_id":"dr-epv.4.4","type":"blocks","created_at":"2026-01-16T21:03:24.742209-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4.6","title":"Full-Text Search: FTS5 configuration and search","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement full-text search via FTS5 in `fulltext_search.rs`.\n\n## FTS5 Configuration\n\n- External content mode (no duplicate storage)\n- Virtual table: `fts_content` with document_id and body columns\n- content='documents', content_rowid='rowid'\n- automerge=4 for automatic segment merging\n\n## Sync Mechanisms\n\n- Triggers keep FTS in sync with document changes\n- After full rebuild: `INSERT INTO fts_content(fts_content) VALUES('optimize')`\n\n## Search Operations\n\n- Execute FTS5 queries with standard syntax\n- Support query types: word, phrase, AND, OR, NOT, prefix, NEAR\n- Return results with relevance ranking (BM25)\n- Extract snippets around matching terms\n\n## Query Syntax Support\n\n| Syntax | Example | Matches |\n|--------|---------|---------|\n| Word | `error` | Documents containing \"error\" |\n| Phrase | `\"login bug\"` | Exact phrase |\n| AND | `error AND login` | Both terms |\n| OR | `error OR warning` | Either term |\n| NOT | `error NOT test` | First without second |\n| Prefix | `auth*` | Words starting with \"auth\" |\n| NEAR | `NEAR(error login, 5)` | Terms within 5 words |\n\n## Performance Targets\n\n- Simple FTS search: \u003c20ms\n- Complex FTS search: \u003c50ms\n\n## References\n\n- FTS5 details: @rules_engine/docs/lattice/appendix_indexing.md#full-text-search\n- File: @rules_engine/src/lattice/src/index/fulltext_search.rs\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T21:02:59.506311-08:00","created_by":"dthurn","updated_at":"2026-01-17T08:22:10.138219-08:00","closed_at":"2026-01-17T08:22:10.138219-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4.6","depends_on_id":"dr-epv.4","type":"parent-child","created_at":"2026-01-16T21:02:59.507017-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.4.6","depends_on_id":"dr-epv.4.5","type":"blocks","created_at":"2026-01-16T21:03:25.778185-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4.7","title":"View Tracking: Document view counts for overview ranking","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement view tracking in `view_tracking.rs`.\n\n## Views Table\n\n| Column | Type | Description |\n|--------|------|-------------|\n| document_id | TEXT PK | Lattice ID |\n| view_count | INTEGER | Total views |\n| last_viewed | TEXT | ISO 8601 timestamp |\n\n## Core Operations\n\n- Record view on `lat show` command\n- Query view count for document\n- Query last-viewed timestamp\n- Reset view counts (via `lat overview --reset-views`)\n\n## Denormalization\n\n- `documents.view_count` is denormalized copy of `views.view_count`\n- Maintained by trigger for query performance\n- Allows `lat overview` ranking without table joins\n- `views` table is source of truth\n\n## Concurrency\n\n- SQLite WAL mode handles concurrent reads/writes\n- View recording is transactional\n- Multiple `lat show` commands can run simultaneously\n\n## Usage by Commands\n\n- `lat show \u003cid\u003e`: Records view, increments count\n- `lat overview`: Ranks documents by view frequency + recency\n- `lat overview --reset-views`: Clears all view data\n\n## References\n\n- Views schema: @rules_engine/docs/lattice/appendix_indexing.md#views\n- Overview ranking: @rules_engine/docs/lattice/appendix_overview_command.md\n- File: @rules_engine/src/lattice/src/index/view_tracking.rs\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T21:03:01.723575-08:00","created_by":"dthurn","updated_at":"2026-01-17T08:59:10.816553-08:00","closed_at":"2026-01-17T08:59:10.816553-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4.7","depends_on_id":"dr-epv.4","type":"parent-child","created_at":"2026-01-16T21:03:01.724255-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.4.7","depends_on_id":"dr-epv.4.6","type":"blocks","created_at":"2026-01-16T21:03:26.678646-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4.8","title":"Content Cache: L2 cache for document body content","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement L2 content cache in `content_cache.rs`.\n\n## Purpose\n\nL2 cache for document body content, reducing filesystem reads for frequently\naccessed documents. L1 cache is the OS filesystem cache; this provides an\nadditional layer within SQLite.\n\n## Content Cache Table\n\n| Column | Type | Description |\n|--------|------|-------------|\n| document_id | TEXT PK | Lattice ID |\n| content | TEXT | Full document body |\n| content_hash | TEXT | SHA-256 for invalidation |\n| accessed_at | TEXT | Last access timestamp |\n| file_mtime | INTEGER | File mtime at cache time |\n\n## Cache Policy\n\n- Validate entries by comparing `file_mtime` against current filesystem mtime\n- Stale entries are refreshed on access (read-through cache)\n- Evict least-recently-accessed entries when cache exceeds 100 documents\n- Cache hit avoids syscall overhead for hot documents\n\n## Core Operations\n\n- Get cached content (with mtime validation)\n- Put content in cache\n- Invalidate specific document\n- Eviction sweep (remove oldest entries over limit)\n- Clear entire cache\n\n## Usage by Commands\n\n- `lat show`: Avoids repeated file reads for multiple documents\n- `lat search`: Result snippets without reading entire files\n- Template composition: Caches ancestor document content\n\n## References\n\n- Content cache schema: @rules_engine/docs/lattice/appendix_indexing.md#content_cache\n- File: @rules_engine/src/lattice/src/index/content_cache.rs\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T21:03:02.934354-08:00","created_by":"dthurn","updated_at":"2026-01-17T11:47:08.004206-08:00","closed_at":"2026-01-17T11:47:08.004206-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4.8","depends_on_id":"dr-epv.4","type":"parent-child","created_at":"2026-01-16T21:03:02.935131-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.4.8","depends_on_id":"dr-epv.4.7","type":"blocks","created_at":"2026-01-16T21:03:27.369844-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.5","title":"CLI Framework: Argument parsing, command dispatch, output formatting","description":"Implement the CLI framework layer for Lattice: argument parsing, command dispatch, output formatting, and color theme.\n\n## Scope\n\n- **Argument Parser**: Clap-based command definitions for all `lat` subcommands\n- **Command Dispatch**: Route parsed arguments to command implementations with startup operations hook\n- **Output Formatting**: Text/JSON/pretty output helpers with consistent document reference format\n- **Color Theme**: Ayu color palette with terminal detection and semantic coloring\n\n## Status\n\n- C5 (Global Options) is already implemented in `@rules_engine/src/lattice/src/cli/global_options.rs`\n- Files exist as stubs for C1-C4; implementation needed\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/lattice_design.md#command-overview\n- @rules_engine/docs/lattice/appendix_cli_structure.md\n- @rules_engine/docs/lattice/appendix_file_layout.md (cli/ section)\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/argument_parser.rs`\n- `@rules_engine/src/lattice/src/cli/command_dispatch.rs`\n- `@rules_engine/src/lattice/src/cli/output_format.rs`\n- `@rules_engine/src/lattice/src/cli/color_theme.rs`","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-16T21:12:08.469508-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:12:59.086382-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.5","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-16T21:12:08.470348-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.5.1","title":"Color Theme: Ayu palette with terminal detection","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the Ayu color theme for Lattice CLI output.\n\n## Scope\n\n- Define Ayu color palette constants:\n  - Green for success states\n  - Yellow for warnings\n  - Red for errors\n  - Blue for accent/highlighting\n  - Gray for muted/secondary text\n- Implement terminal detection for color support\n- Support `LATTICE_NO_COLOR` environment variable\n- Create semantic coloring functions for common output patterns\n\n## Implementation Notes\n\n- Use a crate like `termcolor` or `owo-colors` for cross-platform terminal colors\n- Detect TTY vs piped output to disable colors when not interactive\n- Provide fallback for terminals without color support\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/lattice_design.md#ui-design\n- @rules_engine/docs/lattice/appendix_cli_structure.md#environment-variables\n\n## File\n\n- `@rules_engine/src/lattice/src/cli/color_theme.rs`\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:12:19.434267-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:52:02.526051-08:00","closed_at":"2026-01-16T21:52:02.526051-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.5.1","depends_on_id":"dr-epv.5","type":"parent-child","created_at":"2026-01-16T21:12:19.43501-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.5.2","title":"Output Formatting: Text, JSON, and pretty formatters","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement text, JSON, and pretty output formatters for Lattice CLI.\n\n## Scope\n\n- **Text Formatter**: Human-readable plain text output\n- **JSON Formatter**: Structured serde serialization for `--json` mode\n- **Pretty Formatter**: Visual trees and colored output using color theme\n- Consistent document reference format: `\u003cid\u003e: \u003cname\u003e - \u003cdescription\u003e [\u003ctype\u003e]`\n\n## Implementation Notes\n\n- Create an `OutputFormat` enum or trait to abstract formatting\n- JSON output should use serde_json with consistent field naming\n- Pretty formatter should use Unicode box-drawing characters for trees\n- Handle long descriptions with truncation and ellipsis\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/appendix_cli_structure.md (output format examples)\n- @rules_engine/docs/lattice/appendix_workflow.md (lat show output format)\n\n## Dependencies\n\n- Uses color theme from `@rules_engine/src/lattice/src/cli/color_theme.rs`\n\n## File\n\n- `@rules_engine/src/lattice/src/cli/output_format.rs`\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:12:29.097259-08:00","created_by":"dthurn","updated_at":"2026-01-16T22:11:15.803529-08:00","closed_at":"2026-01-16T22:11:15.803529-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.5.2","depends_on_id":"dr-epv.5","type":"parent-child","created_at":"2026-01-16T21:12:29.097934-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.5.2","depends_on_id":"dr-epv.5.1","type":"blocks","created_at":"2026-01-16T21:12:29.099097-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.5.3","title":"Argument Parser: Clap definitions for all lat subcommands","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement Clap-based argument parsing for all `lat` subcommands.\n\n## Scope\n\n- Define main `Lat` CLI struct with Clap derive macros\n- Define all subcommands with their arguments per CLI spec\n- Set up global options: `--json`, `--verbose`, `--quiet`, `--help`, `--version`\n- Configure environment variable bindings (`LATTICE_LOG_LEVEL`, etc.)\n\n## Subcommands to Define\n\nshow, create, update, close, reopen, prune, list, ready, search, stale, blocked, changes, stats, tree, roots, children, dep, label, links-from, links-to, path, orphans, impact, claim, overview, prime, track, generate-ids, split, mv, edit, fmt, check, doctor, setup, completion, chaosmonkey\n\n## Implementation Notes\n\n- Use Clap's derive API (`Parser`, `Subcommand`, `Args`)\n- Flatten `GlobalOptions` into each command\n- Group related arguments (e.g., filter options as a shared Args struct)\n- Add help text and examples for each command\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/appendix_cli_structure.md (complete command list)\n- @rules_engine/docs/lattice/lattice_design.md#command-overview\n\n## File\n\n- `@rules_engine/src/lattice/src/cli/argument_parser.rs`\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:12:40.473035-08:00","created_by":"dthurn","updated_at":"2026-01-16T23:19:45.049477-08:00","closed_at":"2026-01-16T23:19:45.049477-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.5.3","depends_on_id":"dr-epv.5","type":"parent-child","created_at":"2026-01-16T21:12:40.473786-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.5.3","depends_on_id":"dr-epv.5.2","type":"blocks","created_at":"2026-01-16T21:12:40.475036-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.5.4","title":"Command Dispatch: Route commands with startup operations hook","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement command dispatch to route parsed arguments to handler functions.\n\n## Scope\n\n- Match parsed commands to handler functions\n- Thread context (GitOps, Index) through handlers\n- Implement startup operations hook (runs before each command)\n- Map results to exit codes per error handling spec\n- Implement hidden `--no-startup` flag for debugging\n\n## Startup Operations Hook\n\nPer @rules_engine/docs/lattice/appendix_startup_operations.md:\n- Index reconciliation\n- Skill symlink sync\n- Claim cleanup\n- Log rotation\n- Performance budget: \u003c100ms total; emit debug log if exceeded\n\n## Implementation Notes\n\n- Create a `CommandContext` struct holding shared state (GitOps, Index, Config)\n- Each command handler receives context and returns `LatticeResult\u003c()\u003e`\n- Convert `LatticeError` to appropriate exit codes\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/appendix_startup_operations.md\n- @rules_engine/docs/lattice/appendix_error_handling.md (exit codes)\n- @rules_engine/docs/lattice/appendix_cli_structure.md#exit-codes\n\n## File\n\n- `@rules_engine/src/lattice/src/cli/command_dispatch.rs`\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:12:49.510818-08:00","created_by":"dthurn","updated_at":"2026-01-17T07:29:39.852424-08:00","closed_at":"2026-01-17T07:29:39.852424-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.5.4","depends_on_id":"dr-epv.5","type":"parent-child","created_at":"2026-01-16T21:12:49.511586-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.5.4","depends_on_id":"dr-epv.5.3","type":"blocks","created_at":"2026-01-16T21:12:49.512869-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.6","title":"Index Core Additions","description":"Implement additional Index Core functionality discovered during post-implementation\nreview that supports Reconciliation and other features.\n\n## Scope\n\n- Index metadata query functions for reconciliation fast-path\n- Client counter management for ID generation\n- Directory roots hierarchy queries for template composition\n- Documentation for document types and filter modules\n- Update file layout appendix to include missing files\n\n## Dependencies\n\n- Requires completed Index Core feature (schema, connection, base queries)\n- Downstream features depend on these exports:\n  - Reconciliation uses index metadata queries (R4)\n  - ID generation uses client counters (F2)\n  - Template composition uses directory roots (TM1, TM3)\n\n## Reference Documentation\n\n- Design: @rules_engine/docs/lattice/lattice_design.md#index-architecture\n- Implementation: @rules_engine/docs/lattice/lattice_implementation_plan.md\n- Schema: @rules_engine/docs/lattice/appendix_indexing.md","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-17T12:04:38.414084-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:04:43.220153-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.6","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-17T12:04:38.417206-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.6.1","title":"Index Metadata Query Functions","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement query functions for the `index_metadata` table to support reconciliation\nfast-path checks and last-indexed tracking.\n\n## Implementation File\n\n`@rules_engine/src/lattice/src/index/index_metadata.rs`\n\n## Required Functions\n\n- `get_metadata()` - retrieve full IndexMetadata struct\n- `get_last_commit()` - get last indexed git commit hash\n- `get_last_indexed()` - get last indexed timestamp\n- `set_last_commit()` - update commit hash and touch timestamp\n- `touch_last_indexed()` - update timestamp only\n\n## Usage Context\n\n- Reconciliation coordinator uses these to detect if index is current\n- Fast-path check: compare HEAD vs last_commit\n- After successful reconciliation: update last_commit\n\n## Schema Reference\n\nSingle-row table per @rules_engine/docs/lattice/appendix_indexing.md:\n- schema_version, last_commit (git hash), last_indexed\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T12:05:16.317252-08:00","created_by":"dthurn","updated_at":"2026-01-17T13:32:24.588428-08:00","closed_at":"2026-01-17T13:32:24.588428-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.6.1","depends_on_id":"dr-epv.6","type":"parent-child","created_at":"2026-01-17T12:05:16.317972-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.6.2","title":"Client Counters Query Functions","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement query functions for the `client_counters` table to support ID generation\nwith per-client document counters.\n\n## Implementation File\n\n`@rules_engine/src/lattice/src/index/client_counters.rs`\n\n## Required Functions\n\n- `get_and_increment()` - atomic get-and-increment for ID generation\n- `get_counter()` - read current counter without incrementing\n- `set_counter()` - set counter value (for recovery)\n- `set_counter_if_higher()` - conditional set for counter recovery\n- `list_all()` - list all client counters\n- `delete()` - remove a client's counter\n\n## Usage Context\n\n- ID generator (F2) uses get_and_increment for new IDs\n- Counter recovery scans documents to find highest counter per client\n- Used when repo is re-cloned and counters need restoration\n\n## Schema Reference\n\nPer @rules_engine/docs/lattice/appendix_indexing.md:\n- client_id (PK), next_counter\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T12:05:17.780197-08:00","created_by":"dthurn","updated_at":"2026-01-17T13:59:14.950818-08:00","closed_at":"2026-01-17T13:59:14.950818-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.6.2","depends_on_id":"dr-epv.6","type":"parent-child","created_at":"2026-01-17T12:05:17.780909-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.6.2","depends_on_id":"dr-epv.6.1","type":"blocks","created_at":"2026-01-17T12:05:29.307389-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.6.3","title":"Directory Roots Hierarchy Queries","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement query functions for the `directory_roots` table to support template\ncomposition and hierarchy queries.\n\n## Implementation File\n\n`@rules_engine/src/lattice/src/index/directory_roots.rs`\n\n## Required Functions\n\n- `upsert()` - insert or update directory root entry\n- `get()` - get full DirectoryRoot entry\n- `get_root_id()` - get just the root document ID for a directory\n- `get_ancestors()` - get all ancestors ordered root-to-parent\n- `get_children()` - get immediate child directories\n- `list_at_depth()` - list all roots at a specific depth\n- `list_all()` - list all roots ordered by depth then path\n- `delete()` - remove a directory root entry\n- `clear_all()` - clear all entries (for full rebuild)\n\n## Usage Context\n\n- Template composer (TM1) walks ancestor chain for context inheritance\n- TM3 populates this table during reconciliation\n- Efficient hierarchy queries without filesystem traversal\n\n## Schema Reference\n\nPer @rules_engine/docs/lattice/appendix_indexing.md:\n- directory_path (PK), root_id, parent_path, depth\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T12:05:18.485266-08:00","created_by":"dthurn","updated_at":"2026-01-17T14:40:15.125417-08:00","closed_at":"2026-01-17T14:40:15.125417-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.6.3","depends_on_id":"dr-epv.6","type":"parent-child","created_at":"2026-01-17T12:05:18.486001-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.6.3","depends_on_id":"dr-epv.6.2","type":"blocks","created_at":"2026-01-17T12:05:30.810291-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.6.4","title":"Document Types Documentation","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nAdd module documentation explaining the distinction between IndexedDocument and\nthe parsed Document type.\n\n## Implementation File\n\n`@rules_engine/src/lattice/src/index/document_types.rs`\n\n## Documentation Requirements\n\n- Module-level doc comment explaining purpose of file\n- Explain `IndexedDocument` as the cached metadata representation\n- Explain distinction from `Document` (parsed from filesystem)\n- Document when to use each type:\n  - IndexedDocument for queries that need metadata only\n  - Document for operations requiring body content or modification\n\n## File Layout Update\n\nAlso update @rules_engine/docs/lattice/appendix_file_layout.md to add\n`document_types.rs` to the index/ section with description:\n\"Index-specific document types distinct from parsed documents\"\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T12:05:19.690606-08:00","created_by":"dthurn","updated_at":"2026-01-17T15:02:52.341388-08:00","closed_at":"2026-01-17T15:02:52.341388-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.6.4","depends_on_id":"dr-epv.6","type":"parent-child","created_at":"2026-01-17T12:05:19.69128-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.6.4","depends_on_id":"dr-epv.6.3","type":"blocks","created_at":"2026-01-17T12:05:31.495405-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.6.5","title":"Document Filter Documentation","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nAdd module documentation for the DocumentFilter builder pattern and available\nfilter criteria.\n\n## Implementation File\n\n`@rules_engine/src/lattice/src/index/document_filter.rs`\n\n## Documentation Requirements\n\n- Module-level doc comment explaining the builder pattern\n- Document `name_contains` filter for substring matching on document names\n- Document all available filter criteria:\n  - State filters (open, blocked, closed)\n  - Priority filters\n  - Type filters (task types)\n  - Label filters (AND/OR semantics)\n  - Path prefix filters\n  - Timestamp filters (created, updated)\n- Document sort options and ordering\n\n## File Layout Update\n\nAlso update @rules_engine/docs/lattice/appendix_file_layout.md to add\n`document_filter.rs` to the index/ section with description:\n\"Query builder for document filtering and sorting\"\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T12:05:20.869072-08:00","created_by":"dthurn","updated_at":"2026-01-17T16:05:45.176945-08:00","closed_at":"2026-01-17T16:05:45.176945-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.6.5","depends_on_id":"dr-epv.6","type":"parent-child","created_at":"2026-01-17T12:05:20.869748-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.6.5","depends_on_id":"dr-epv.6.4","type":"blocks","created_at":"2026-01-17T12:05:32.207215-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.6.6","title":"Index Core Additions Post-Implementation Review","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nPerform structural review of the Index Core Additions feature implementation\nfor completeness and specification compliance.\n\n## Review Reference\n\n- Implementation plan: @rules_engine/docs/lattice/lattice_implementation_plan.md\n- Feature section: \"Index Core (Continued)\"\n- Work items: I9, I10, I11, I12, I13\n\n## Review Questions\n\n1. **Scope Completeness**: Was the scope in the implementation plan complete?\n   - Are there items that should have been included but were missed?\n   - Are there items required for downstream features that are now missing?\n\n2. **Specification Compliance**: Does the implementation fully satisfy the spec?\n   - All query functions implemented with correct signatures?\n   - Error handling follows LatticeError patterns?\n   - Edge cases handled (empty tables, missing entries, concurrent access)?\n   - Documentation complete and accurate?\n\n## Actions Required\n\nAfter review, address any gaps by:\n1. Updating documentation if spec was unclear\n2. Adding work items to a *future* implementation plan milestone (not current)\n3. Fixing immediately if critical for downstream features\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T12:05:21.040519-08:00","created_by":"dthurn","updated_at":"2026-01-17T16:31:55.508136-08:00","closed_at":"2026-01-17T16:31:55.508136-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.6.6","depends_on_id":"dr-epv.6","type":"parent-child","created_at":"2026-01-17T12:05:21.041271-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.6.6","depends_on_id":"dr-epv.6.5","type":"blocks","created_at":"2026-01-17T12:05:33.237685-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.7","title":"First Working Command (lat show)","description":"End-to-end working `lat show` command that validates the entire Lattice pipeline.\n\n## Goal\n\nAfter this feature is complete, `lat show \u003cid\u003e` works against real repositories.\nThis is the first milestone where all core systems (Foundation, Git Layer, Document\nModel, Index Core, CLI Framework) integrate into a working command.\n\n## Reference Documentation\n\n- Design: @rules_engine/docs/lattice/lattice_design.md\n- Implementation plan: @rules_engine/docs/lattice/lattice_implementation_plan.md\n- Workflow commands: @rules_engine/docs/lattice/appendix_workflow.md (lat show section)\n- CLI structure: @rules_engine/docs/lattice/appendix_cli_structure.md\n- Startup operations: @rules_engine/docs/lattice/appendix_startup_operations.md\n\n## Scope\n\n- S1: Show Command Implementation (show_executor.rs, document_formatter.rs, output_formats.rs)\n- S2: Startup Operations (startup.rs or command_dispatch.rs integration)\n","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2026-01-17T12:10:20.685038-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:12:18.005413-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.7","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-17T12:10:20.689646-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.7.1","title":"Show command document lookup and task formatting","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the core `lat show` functionality for looking up documents and formatting\ntask output.\n\n## Scope\n\n- Implement show_executor.rs entry point and orchestration logic\n- Query index to lookup document by Lattice ID\n- Handle not-found case with appropriate error message\n- Implement task document formatting in document_formatter.rs:\n  - Header line: `\u003cid\u003e: \u003cname\u003e - \u003cdescription\u003e`\n  - Metadata block: state, priority, type, timestamps\n  - Body content display\n  - Parent reference (directory root document)\n  - Dependencies section (blocked-by tasks)\n  - Blocking section (tasks this blocks)\n  - Related documents section (linked from body, excluding deps/blocking/parent)\n- Compute task state from filesystem path (closed if in .closed/, blocked if blockers open)\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/commands/show_command/show_executor.rs`\n- `@rules_engine/src/lattice/src/cli/commands/show_command/document_formatter.rs`\n\n## Reference\n\n- Output format: @rules_engine/docs/lattice/appendix_workflow.md (Task Display Format section)\n\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T12:10:33.635085-08:00","created_by":"dthurn","updated_at":"2026-01-17T14:29:07.019398-08:00","closed_at":"2026-01-17T14:29:07.019398-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.7.1","depends_on_id":"dr-epv.7","type":"parent-child","created_at":"2026-01-17T12:10:33.635923-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.7.1","depends_on_id":"dr-epv.7.6","type":"blocks","created_at":"2026-01-17T12:12:05.22771-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.7.2","title":"Show command knowledge base formatting and related documents","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement knowledge base document display and related documents logic for `lat show`.\n\n## Scope\n\n- Add knowledge base document formatting to document_formatter.rs:\n  - Header: `\u003cid\u003e: \u003cname\u003e - \u003cdescription\u003e` (same as tasks)\n  - Full markdown body content between separators\n  - Related documents section\n- Implement related document selection algorithm:\n  - Extract documents linked from body text (markdown links with Lattice IDs)\n  - Exclude documents already shown in dependencies, blocking, or parent sections\n  - Order by first appearance in body text\n  - Limit to 10 documents in text output\n  - Highlight root documents preferentially\n- Use consistent document reference format throughout:\n  - Tasks: `\u003cid\u003e: \u003cname\u003e - \u003cdescription\u003e [P\u003cN\u003e]` or `[P\u003cN\u003e/closed]`\n  - Knowledge base: `\u003cid\u003e: \u003cname\u003e - \u003cdescription\u003e [doc]`\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/commands/show_command/document_formatter.rs`\n\n## Reference\n\n- KB format: @rules_engine/docs/lattice/appendix_workflow.md (Knowledge Base Display Format)\n- Document reference format: @rules_engine/docs/lattice/appendix_workflow.md (Document Reference Format)\n\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T12:10:42.883892-08:00","created_by":"dthurn","updated_at":"2026-01-17T15:07:51.390324-08:00","closed_at":"2026-01-17T15:07:51.390324-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.7.2","depends_on_id":"dr-epv.7","type":"parent-child","created_at":"2026-01-17T12:10:42.884673-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.7.2","depends_on_id":"dr-epv.7.1","type":"blocks","created_at":"2026-01-17T12:12:05.989313-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.7.3","title":"Show command output modes","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement all output mode variations for `lat show`.\n\n## Scope\n\nCreate output_formats.rs and implement each output mode:\n\n- **--short**: Single-line output\n  - Tasks: `\u003cid\u003e [\u003cstate\u003e] \u003cpriority\u003e \u003ctype\u003e: \u003cname\u003e - \u003cdescription\u003e`\n  - KB: `\u003cid\u003e [doc]: \u003cname\u003e - \u003cdescription\u003e`\n\n- **--peek**: Condensed preview\n  - `\u003cid\u003e: \u003cname\u003e - \u003cdescription\u003e [P\u003cN\u003e/\u003cstate\u003e/\u003ctype\u003e]`\n  - `Parent: \u003cid\u003e | Blocks: \u003cN\u003e | Depends: \u003cN\u003e`\n\n- **--refs**: References to this document\n  - List tasks blocked by this document\n  - List documents that link to this document (backlinks)\n  - Include line numbers for inline references\n\n- **--raw**: Skip template composition, show only document's own content\n  - Omit Context and Acceptance Criteria sections from ancestors\n  - (Template composition itself is implemented in a later feature)\n\n- **--json**: Structured JSON output\n  - Full JSON schema per appendix_workflow.md specification\n  - Include all fields: id, name, description, body, state, priority, task_type,\n    timestamps, path, labels, dependencies, dependents, related, parent, claimed\n  - Return as array even for single document (consistency)\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/commands/show_command/mod.rs` (add output_formats module)\n- `@rules_engine/src/lattice/src/cli/commands/show_command/output_formats.rs` (new file)\n- `@rules_engine/src/lattice/src/cli/commands/show_command/show_executor.rs` (integrate modes)\n\n## Reference\n\n- All formats: @rules_engine/docs/lattice/appendix_workflow.md (lat show section)\n\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T12:10:54.06408-08:00","created_by":"dthurn","updated_at":"2026-01-17T16:04:24.783708-08:00","closed_at":"2026-01-17T16:04:24.783708-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.7.3","depends_on_id":"dr-epv.7","type":"parent-child","created_at":"2026-01-17T12:10:54.064834-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.7.3","depends_on_id":"dr-epv.7.2","type":"blocks","created_at":"2026-01-17T12:12:06.844768-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.7.4","title":"Show command view tracking and multiple documents","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement view tracking and multiple document display for `lat show`.\n\n## Scope\n\n**View Tracking:**\n- Record view when document is shown via `lat show`\n- Call view tracking functions from index module (I7: view_tracking.rs)\n- Increment view count and update last-viewed timestamp\n- Views are tracked in SQLite, not in the document files\n- Views influence `lat overview` ranking\n\n**Multiple Document Support:**\n- Handle `lat show \u003cid1\u003e \u003cid2\u003e ...` with multiple IDs\n- Display each document in sequence\n- Separate documents with blank lines in text output\n- Return as JSON array for --json output\n- Record view for each document shown\n\n**Error Handling:**\n- If any ID not found, report error but continue showing found documents\n- Exit code reflects whether all documents were found\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/commands/show_command/show_executor.rs`\n\n## Reference\n\n- View tracking: @rules_engine/docs/lattice/appendix_indexing.md (views table)\n- Multiple docs: @rules_engine/docs/lattice/appendix_workflow.md (Multiple Documents section)\n\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T12:11:02.776179-08:00","created_by":"dthurn","updated_at":"2026-01-17T16:30:31.329247-08:00","closed_at":"2026-01-17T16:30:31.329247-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.7.4","depends_on_id":"dr-epv.7","type":"parent-child","created_at":"2026-01-17T12:11:02.776897-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.7.4","depends_on_id":"dr-epv.7.3","type":"blocks","created_at":"2026-01-17T12:12:07.685313-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.7.5","title":"Startup operations framework and log rotation","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nCreate the startup operations framework that runs before every `lat` command.\n\n## Scope\n\n**Framework:**\n- Create startup.rs module or integrate startup logic into command_dispatch.rs\n- Define trait/interface for startup operations\n- Execute all startup operations before command dispatch\n- Operations must be idempotent, atomic, and tolerant of concurrent execution\n\n**Log Rotation:**\n- Check `.lattice/logs.jsonl` file size at startup\n- If size \u003e 10MB, rotate to `logs.jsonl.1` (overwrite existing backup)\n- Create fresh log file after rotation\n- Use atomic rename operation for rotation\n- Handle case where .1 file already exists\n\n**--no-startup Flag:**\n- Add hidden `--no-startup` flag to global options\n- When set, skip all startup operations (for debugging only)\n- Document that this may cause stale data issues\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/startup.rs` (new file)\n  OR integrate into `@rules_engine/src/lattice/src/cli/command_dispatch.rs`\n- `@rules_engine/src/lattice/src/cli/global_options.rs` (add --no-startup flag)\n- `@rules_engine/src/lattice/src/cli/mod.rs` (add module declaration if new file)\n\n## Reference\n\n- Design: @rules_engine/docs/lattice/appendix_startup_operations.md\n- Concurrency requirements: Operations must handle multiple concurrent `lat` processes\n\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T12:11:13.10413-08:00","created_by":"dthurn","updated_at":"2026-01-17T13:30:02.413657-08:00","closed_at":"2026-01-17T13:30:02.413657-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.7.5","depends_on_id":"dr-epv.7","type":"parent-child","created_at":"2026-01-17T12:11:13.10489-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.7.6","title":"Startup reconciliation integration and performance monitoring","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nIntegrate index reconciliation into startup operations and add performance monitoring.\n\n## Scope\n\n**Reconciliation Integration:**\n- Call reconciliation coordinator at startup\n- Use fast-path check: if HEAD unchanged and no uncommitted .md changes, skip\n- For the \"First Working Command\" milestone, ensure at minimum full rebuild works\n- Full rebuild is triggered by: missing index, schema mismatch, or corruption\n- Incremental reconciliation may be partially implemented or stubbed\n\n**Additional Startup Hooks (Stubs):**\n- Add hook point for skill symlink sync (implemented in Skill Integration feature)\n- Add hook point for claim cleanup (implemented in Claim System feature)\n- These can be no-ops initially if those features aren't complete\n\n**Performance Monitoring:**\n- Track total startup operation time\n- If startup exceeds 100ms, emit debug log entry for investigation\n- Target performance budget:\n  - Fast path: \u003c20ms total\n  - Incremental: \u003c500ms typical\n  - Full rebuild: seconds (acceptable for initial or corrupted index)\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/startup.rs` or command_dispatch.rs\n- Uses: `@rules_engine/src/lattice/src/index/reconciliation/reconciliation_coordinator.rs`\n\n## Reference\n\n- Performance targets: @rules_engine/docs/lattice/appendix_startup_operations.md\n- Reconciliation: @rules_engine/docs/lattice/appendix_indexing.md (Reconciliation section)\n\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T12:11:24.759542-08:00","created_by":"dthurn","updated_at":"2026-01-17T13:57:38.0223-08:00","closed_at":"2026-01-17T13:57:38.0223-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.7.6","depends_on_id":"dr-epv.7","type":"parent-child","created_at":"2026-01-17T12:11:24.760223-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.7.6","depends_on_id":"dr-epv.7.5","type":"blocks","created_at":"2026-01-17T12:12:04.496978-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.7.7","title":"First Working Command post-implementation review","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nPost-implementation structural review of the First Working Command (lat show) feature.\n\n## Purpose\n\nEnsure the First Working Command feature is complete and properly integrated before\nmoving on to subsequent features.\n\n## Review Questions\n\n**1. Scope Completeness**\n- Was the scope in @rules_engine/docs/lattice/lattice_implementation_plan.md complete?\n- Are there items which should have been included but weren't implemented?\n- Are there gaps that will block later features?\n\n**2. Specification Compliance**\n- Does the implementation fully satisfy the specification?\n- Are all output formats (text, --short, --peek, --refs, --raw, --json) working?\n- Are edge cases handled:\n  - Non-existent IDs\n  - Multiple documents\n  - Documents in .closed/ directories\n  - Documents with/without dependencies\n  - Tasks vs knowledge base documents\n\n**3. Integration Points**\n- Does startup reconciliation correctly populate the index?\n- Does view tracking record views correctly?\n- Are related documents correctly identified and excluded from deps/blocking?\n\n## Actions if Issues Found\n\n1. Update documentation in @rules_engine/docs/lattice/ if specs were unclear\n2. Add a *future* implementation plan milestone for missing scope (do not modify\n   current milestone features that are marked [DONE])\n3. Fix critical issues immediately if they block the milestone goal\n   (\"lat show \u003cid\u003e works against real repositories\")\n\n## Reference\n\n- Implementation plan: @rules_engine/docs/lattice/lattice_implementation_plan.md\n- Show command spec: @rules_engine/docs/lattice/appendix_workflow.md\n- Startup spec: @rules_engine/docs/lattice/appendix_startup_operations.md\n\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"in_progress","priority":1,"issue_type":"task","created_at":"2026-01-17T12:11:36.645218-08:00","created_by":"dthurn","updated_at":"2026-01-17T16:32:15.402526-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.7.7","depends_on_id":"dr-epv.7","type":"parent-child","created_at":"2026-01-17T12:11:36.646032-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.7.7","depends_on_id":"dr-epv.7.4","type":"blocks","created_at":"2026-01-17T12:12:08.717119-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.8","title":"Index Reconciliation","description":"Feature: Keep SQLite index in sync with git repository state.\n\n## Overview\n\nThe reconciliation system ensures the SQLite index remains consistent with the git repository. It runs at the start of every `lat` command as part of startup operations.\n\n## Key Requirements\n\n- **Fast path** (~1ms): Skip if HEAD unchanged and no uncommitted `.md` changes\n- **Incremental path** (~50-500ms): Re-parse only changed files since last index update\n- **Full rebuild** (seconds): Triggered by missing index, schema mismatch, or corruption\n- **Concurrent safety**: Multiple `lat` processes may run simultaneously\n- **Performance target**: \u003c100ms total startup for fast path\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/appendix_indexing.md#reconciliation\n- @rules_engine/docs/lattice/appendix_startup_operations.md\n- @rules_engine/docs/lattice/lattice_implementation_plan.md (Feature: Index Reconciliation)\n\n## Dependencies\n\n- Depends on: Index Core (I1-I9), Git Layer, Document Model","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-17T12:14:51.923945-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:14:55.820868-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.8","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-17T12:14:51.926316-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.8.1","title":"Reconciliation Coordinator","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the reconciliation coordinator as the entry point for index synchronization.\n\n## File Location\n\n- `rules_engine/src/lattice/src/index/reconciliation/reconciliation_coordinator.rs`\n- `rules_engine/src/lattice/src/index/reconciliation/mod.rs` (module declarations only)\n\n## Implementation Requirements\n\n- Entry point function called from CLI startup operations\n- Accept GitOps trait object and Index connection\n- Determine which reconciliation strategy to use based on repository state\n- Delegate to appropriate strategy (fast path, incremental, or full rebuild)\n- Return result indicating what action was taken (skipped, incremental, rebuilt)\n- Log reconciliation decisions and timing via tracing\n\n## Strategy Selection Logic\n\n1. Check if index exists → if not, trigger full rebuild\n2. Check schema version → if mismatch, trigger full rebuild\n3. Call change detection to determine if fast path applies\n4. Otherwise, call incremental or full rebuild as appropriate\n\n## Error Handling\n\n- Any error during reconciliation should trigger full rebuild attempt\n- If rebuild also fails, propagate error to caller\n- Use `LatticeError` for recoverable issues, panic for corruption\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_indexing.md#reconciliation\n- @rules_engine/docs/lattice/appendix_file_layout.md (index/ section)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T12:15:07.331379-08:00","created_by":"dthurn","updated_at":"2026-01-17T13:34:31.554253-08:00","closed_at":"2026-01-17T13:34:31.554253-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.8.1","depends_on_id":"dr-epv.8","type":"parent-child","created_at":"2026-01-17T12:15:07.332112-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.8.2","title":"Change Detection","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement change detection to determine if the index needs updating.\n\n## File Location\n\n- `rules_engine/src/lattice/src/index/reconciliation/change_detection.rs`\n\n## Implementation Requirements\n\n- Compare current HEAD commit against `index_metadata.last_commit`\n- Check for uncommitted `.md` changes via `git status --porcelain -- '*.md'`\n- Determine if fast path applies (HEAD unchanged AND no uncommitted changes)\n- Return enum indicating: NoChanges, CommittedChanges, UncommittedChanges, Both\n\n## Functions to Implement\n\n- `detect_changes(git: \u0026dyn GitOps, index: \u0026Index) -\u003e Result\u003cChangeStatus\u003e`\n- `get_changed_files(git: \u0026dyn GitOps, from_commit: \u0026str) -\u003e Result\u003cVec\u003cPathBuf\u003e\u003e`\n- `get_uncommitted_changes(git: \u0026dyn GitOps) -\u003e Result\u003cVec\u003cPathBuf\u003e\u003e`\n\n## Git Integration\n\n- Use `git rev-parse HEAD` to get current commit\n- Use `git diff --name-only \u003clast_commit\u003e..HEAD -- '*.md'` for committed changes\n- Use `git status --porcelain -- '*.md'` for uncommitted changes\n- Handle case where last_commit is None (first run after index creation)\n\n## Performance Requirements\n\n- Fast path check must complete in \u003c5ms\n- Avoid unnecessary git calls when possible\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_indexing.md#reconciliation\n- @rules_engine/docs/lattice/appendix_startup_operations.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T12:15:17.642394-08:00","created_by":"dthurn","updated_at":"2026-01-17T14:00:27.188224-08:00","closed_at":"2026-01-17T14:00:27.188224-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.8.2","depends_on_id":"dr-epv.8","type":"parent-child","created_at":"2026-01-17T12:15:17.643136-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.8.2","depends_on_id":"dr-epv.8.1","type":"blocks","created_at":"2026-01-17T12:15:22.259625-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.8.3","title":"Sync Strategies","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the three reconciliation strategies: fast path, incremental sync, and full rebuild.\n\n## File Location\n\n- `rules_engine/src/lattice/src/index/reconciliation/sync_strategies.rs`\n\n## Fast Path Strategy\n\n- When HEAD unchanged and no uncommitted changes\n- Simply return success without modifying index\n- Log that fast path was taken\n\n## Incremental Sync Strategy\n\n- Parse changed files from git diff result\n- For each modified file: re-parse document, update index entry\n- For each deleted file: remove from index\n- Update links, labels tables for affected documents\n- Update FTS index for affected documents\n- Update last_commit in index_metadata\n\n## Full Rebuild Strategy\n\n- Delete existing index (drop all tables or delete file)\n- Create schema from scratch via schema_definition module\n- Enumerate all `.md` files via `git ls-files '*.md'`\n- Parse each document and insert into index\n- Populate links, labels, directory_roots tables\n- Build FTS index\n- Run `PRAGMA optimize` and `INSERT INTO fts_content(fts_content) VALUES('optimize')`\n\n## Conflict Handling\n\n- Skip files with conflict markers (`\u003c\u003c\u003c\u003c\u003c\u003c\u003c`, `=======`, `\u003e\u003e\u003e\u003e\u003e\u003e\u003e`)\n- Log warning for each skipped conflicted file\n- Continue processing other files\n\n## Schema Migration\n\n- Check schema version in index_metadata against current code version\n- If mismatch, trigger full rebuild\n\n## Performance Requirements\n\n- Incremental sync: \u003c500ms for typical daily changes\n- Full rebuild: \u003c30s for 10,000 documents\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_indexing.md#reconciliation\n- @rules_engine/docs/lattice/appendix_indexing.md#full-text-search\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T12:15:34.810909-08:00","created_by":"dthurn","updated_at":"2026-01-17T14:41:19.816838-08:00","closed_at":"2026-01-17T14:41:19.816838-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.8.3","depends_on_id":"dr-epv.8","type":"parent-child","created_at":"2026-01-17T12:15:34.8116-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.8.3","depends_on_id":"dr-epv.8.2","type":"blocks","created_at":"2026-01-17T12:15:38.22958-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.8.4","title":"Index Metadata Integration","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nIntegrate index metadata query functions into the reconciliation workflow.\n\n## Context\n\nIndex Core (I9) implements the index_metadata query functions. This task integrates those functions into reconciliation.\n\n## File Location\n\n- Updates to `rules_engine/src/lattice/src/index/reconciliation/reconciliation_coordinator.rs`\n- Updates to `rules_engine/src/lattice/src/index/reconciliation/sync_strategies.rs`\n\n## Integration Points\n\n- Use `get_last_commit()` in change detection to check if HEAD changed\n- Use `get_metadata()` to retrieve schema version for migration check\n- Call `set_last_commit()` after successful reconciliation to record new HEAD\n- Call `touch_last_indexed()` to update timestamp\n\n## Workflow Integration\n\n1. At start of reconciliation: call `get_last_commit()` for fast path check\n2. After incremental sync: call `set_last_commit(current_head)`\n3. After full rebuild: call `set_last_commit(current_head)`\n4. On any successful path: update `last_indexed` timestamp\n\n## Error Handling\n\n- If metadata retrieval fails, trigger full rebuild\n- If metadata update fails after reconciliation, log warning but don't fail command\n\n## Reference\n\n- @rules_engine/docs/lattice/lattice_implementation_plan.md (I9: Index Metadata Query Functions)\n- @rules_engine/docs/lattice/appendix_indexing.md#index_metadata\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T12:15:48.345405-08:00","created_by":"dthurn","updated_at":"2026-01-17T15:13:01.150199-08:00","closed_at":"2026-01-17T15:13:01.150199-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.8.4","depends_on_id":"dr-epv.8","type":"parent-child","created_at":"2026-01-17T12:15:48.346143-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.8.4","depends_on_id":"dr-epv.8.3","type":"blocks","created_at":"2026-01-17T12:15:52.24672-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.8.5","title":"Index Reconciliation Post-Implementation Review","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nPerform post-implementation structural review of the Index Reconciliation feature.\n\n## Review Questions\n\n### Scope Completeness\n1. Was the scope in `lattice_implementation_plan.md` complete?\n2. Are there items which should have been included but are now missing?\n3. Are any items required for later work that were not addressed?\n\n### Specification Compliance\n1. Does the implementation fully satisfy the specification?\n2. Are all edge cases from the design documents handled?\n3. Are performance targets being met (\u003c5ms fast path, \u003c500ms incremental)?\n\n## Checklist\n\n- [ ] All files from `appendix_file_layout.md` index/reconciliation/ created\n- [ ] Reconciliation runs automatically at CLI startup\n- [ ] Fast path correctly skips when HEAD unchanged\n- [ ] Incremental sync correctly handles git diff output\n- [ ] Full rebuild triggered on schema mismatch\n- [ ] Conflict marker files are skipped with warnings\n- [ ] Concurrent `lat` processes handled safely (SQLite busy_timeout)\n- [ ] Logging via tracing captures reconciliation decisions\n- [ ] Tests exist in `tests/lattice/index/reconciliation_tests.rs`\n\n## Resolution Actions\n\nIf issues are found:\n1. Update documentation if specification was incomplete\n2. Add future implementation plan milestone for missing features (do NOT modify current milestone)\n3. Fix immediately if critical and small\n\n## Reference\n\n- @rules_engine/docs/lattice/lattice_implementation_plan.md (Feature: Index Reconciliation)\n- @rules_engine/docs/lattice/appendix_indexing.md\n- @rules_engine/docs/lattice/appendix_startup_operations.md\n- @rules_engine/docs/lattice/appendix_file_layout.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T12:16:03.746218-08:00","created_by":"dthurn","updated_at":"2026-01-17T16:02:45.036803-08:00","closed_at":"2026-01-17T16:02:45.036803-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.8.5","depends_on_id":"dr-epv.8","type":"parent-child","created_at":"2026-01-17T12:16:03.746964-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.8.5","depends_on_id":"dr-epv.8.4","type":"blocks","created_at":"2026-01-17T12:16:07.59625-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.9","title":"Link System: Extract, normalize, and track links between documents","description":"Implement the Link System feature for extracting, resolving, normalizing, and tracking links between Lattice documents.\n\n## Overview\n\nThe Link System provides the infrastructure for Lattice's cross-referencing capabilities:\n- Extract links from markdown body content and YAML frontmatter\n- Resolve Lattice IDs to current file paths\n- Normalize links (add missing fragments, update stale paths)\n- Track bidirectional references for impact analysis\n\n## Design References\n\n- Main design: @rules_engine/docs/lattice/lattice_design.md#linking-system\n- Linking System appendix: @rules_engine/docs/lattice/appendix_linking_system.md\n- Implementation plan: @rules_engine/docs/lattice/lattice_implementation_plan.md (Link System feature)\n- File layout: @rules_engine/docs/lattice/appendix_file_layout.md (link/ section)\n\n## Dependencies\n\n- Document Model (for parsing documents)\n- Index Core (for link_queries.rs infrastructure)\n\n## Exports\n\n- Link extraction from markdown body and frontmatter\n- Link normalization (path + fragment)\n- Bidirectional reference tracking\n- Integration with `lat fmt` for link maintenance","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-17T16:44:57.447658-08:00","created_by":"dthurn","updated_at":"2026-01-17T16:46:51.123419-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.9","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-17T16:44:57.448434-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.9.1","title":"Link Extractor: Parse markdown to find and extract links","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement markdown link extraction for Lattice documents.\n\n## Scope\n\n- Parse markdown body content to find all links\n- Extract link text, file path, and optional URL fragment\n- Handle shorthand ID-only links (e.g., `[text](LJCQ2X)`)\n- Return structured link data for downstream processing\n\n## Files to Create\n\n- `rules_engine/src/lattice/src/link/mod.rs` - Module declarations only\n- `rules_engine/src/lattice/src/link/link_extractor.rs` - Main implementation\n\n## Implementation Details\n\n- Use a markdown parser to find link nodes (consider pulldown-cmark or similar)\n- Define a `ExtractedLink` struct with fields: text, path, fragment, position\n- Handle both standard `[text](path#fragment)` and shorthand `[text](ID)` formats\n- Distinguish between internal Lattice links and external URLs\n- Extract position info (line number) for error reporting\n\n## Design References\n\n- @rules_engine/docs/lattice/appendix_linking_system.md#link-syntax\n- @rules_engine/docs/lattice/appendix_file_layout.md (link/ section)\n\n## Testing\n\n- Standard markdown links with path and fragment\n- Shorthand ID-only links\n- Links with missing fragments (path only)\n- Links in various markdown contexts (paragraphs, lists, headings)\n- Edge cases: escaped brackets, code blocks (should not extract)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:45:16.159305-08:00","created_by":"dthurn","updated_at":"2026-01-17T19:04:14.628093-08:00","closed_at":"2026-01-17T19:04:14.628093-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.9.1","depends_on_id":"dr-epv.9","type":"parent-child","created_at":"2026-01-17T16:45:16.160497-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.9.2","title":"Frontmatter Links: Extract IDs from frontmatter dependency fields","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement frontmatter link extraction for Lattice documents.\n\n## Scope\n\n- Extract Lattice IDs from `blocking`, `blocked-by`, and `discovered-from` fields\n- Handle custom `*-id` and `*-ids` suffix fields\n- Mark extracted links with appropriate link type for index storage\n- Validate that extracted values are valid Lattice ID format\n\n## Files to Create\n\n- `rules_engine/src/lattice/src/link/frontmatter_links.rs`\n\n## Implementation Details\n\n- Accept parsed `Frontmatter` struct from Document Model\n- Iterate known link fields (`blocking`, `blocked-by`, `discovered-from`)\n- Handle both single ID values and arrays of IDs\n- Detect custom fields matching `*-id` or `*-ids` pattern\n- Return list of `FrontmatterLink` structs with source field name and target ID\n- Link types map to index storage: `blocking` → LinkType::Blocking, etc.\n\n## Design References\n\n- @rules_engine/docs/lattice/appendix_linking_system.md#frontmatter-links\n- @rules_engine/docs/lattice/appendix_indexing.md#links (link types)\n\n## Testing\n\n- Single ID in `blocking` field\n- Multiple IDs in `blocked-by` array\n- Custom `*-id` and `*-ids` fields\n- Empty fields and missing fields\n- Invalid ID format detection\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:45:28.189896-08:00","created_by":"dthurn","updated_at":"2026-01-17T19:54:55.840666-08:00","closed_at":"2026-01-17T19:54:55.840666-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.9.2","depends_on_id":"dr-epv.9","type":"parent-child","created_at":"2026-01-17T16:45:28.190652-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.9.2","depends_on_id":"dr-epv.9.1","type":"blocks","created_at":"2026-01-17T16:46:40.484088-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.9.3","title":"Link Resolver: Resolve Lattice IDs to current file paths","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement link resolution from Lattice IDs to file paths.\n\n## Scope\n\n- Look up document by Lattice ID in the index\n- Compute relative path from source document to target\n- Handle missing targets gracefully (return error info, not panic)\n- Support path resolution for normalization workflow\n\n## Files to Create\n\n- `rules_engine/src/lattice/src/link/link_resolver.rs`\n\n## Implementation Details\n\n- Use Index Core's document_queries to find document by ID\n- Compute relative path using std::path utilities (`.` and `..` normalization)\n- Return `ResolvedLink` with target path, or `UnresolvedLink` with error details\n- Consider source document's directory as the base for relative path computation\n- Handle edge cases: document moved, document deleted, ID not found\n\n## Path Resolution Example\n\n```\nSource:  docs/features/auth.md\nTarget:  docs/design/system.md (ID: LJCQ2X)\nResult:  ../design/system.md#LJCQ2X\n```\n\n## Design References\n\n- @rules_engine/docs/lattice/appendix_linking_system.md#path-resolution\n- @rules_engine/docs/lattice/appendix_linking_system.md#normalization-algorithm\n\n## Testing\n\n- Same directory resolution\n- Parent directory resolution (../)\n- Nested subdirectory resolution\n- Missing target ID handling\n- Documents at various nesting depths\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:45:42.323793-08:00","created_by":"dthurn","updated_at":"2026-01-17T20:33:47.545421-08:00","closed_at":"2026-01-17T20:33:47.545421-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.9.3","depends_on_id":"dr-epv.9","type":"parent-child","created_at":"2026-01-17T16:45:42.324522-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.9.3","depends_on_id":"dr-epv.9.2","type":"blocks","created_at":"2026-01-17T16:46:40.541447-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.9.4","title":"Reference Tracker: Bidirectional link queries for impact analysis","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement bidirectional reference tracking for Lattice documents.\n\n## Scope\n\n- Maintain bidirectional link index (builds on Index Core's link_queries)\n- Query forward links: \"What does document X link to?\"\n- Query reverse links: \"What links to document X?\" (backlinks)\n- Support filtering by link type (body vs frontmatter links)\n\n## Files to Create\n\n- `rules_engine/src/lattice/src/link/reference_tracker.rs`\n\n## Implementation Details\n\n- Wrap Index Core's link_queries with higher-level API\n- Forward links: query `links` table by source_id\n- Reverse links: query `links` table by target_id\n- Include link type in results for filtering (blocking, blocked_by, body, etc.)\n- Return structured results with document metadata (not just IDs)\n\n## Used By Commands\n\n- `lat links-from` - Show documents this document links to\n- `lat links-to` - Show documents that link to this document\n- `lat impact` - Analyze what would be affected by changes\n- `lat orphans` - Find documents with no incoming links\n\n## Design References\n\n- @rules_engine/docs/lattice/appendix_linking_system.md#bidirectional-queries\n- @rules_engine/docs/lattice/appendix_indexing.md#links\n\n## Testing\n\n- Forward link queries\n- Reverse link queries (backlinks)\n- Link type filtering\n- Documents with no links\n- Documents with many links\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:45:53.554383-08:00","created_by":"dthurn","updated_at":"2026-01-17T21:11:37.325876-08:00","closed_at":"2026-01-17T21:11:37.325876-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.9.4","depends_on_id":"dr-epv.9","type":"parent-child","created_at":"2026-01-17T16:45:53.55516-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.9.4","depends_on_id":"dr-epv.9.3","type":"blocks","created_at":"2026-01-17T16:46:40.598046-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.9.5","title":"Link Normalization: Add missing fragments, update stale paths","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement link normalization for `lat fmt` command.\n\n## Scope\n\n- Add missing Lattice ID fragments to path-only links\n- Expand ID-only shorthand links to full path+fragment format\n- Update stale paths when documents have been moved/renamed\n- Validate links and flag issues (missing fragments, stale paths)\n\n## Files to Create\n\n- `rules_engine/src/lattice/src/link/link_normalization/mod.rs`\n- `rules_engine/src/lattice/src/link/link_normalization/normalization_executor.rs`\n- `rules_engine/src/lattice/src/link/link_normalization/link_analysis.rs`\n- `rules_engine/src/lattice/src/link/link_normalization/link_transforms.rs`\n\n## Implementation Details\n\n**normalization_executor.rs** - Entry point and orchestration:\n- Accept document and its extracted links\n- Coordinate analysis and transformation steps\n- Return normalized document content or list of issues\n\n**link_analysis.rs** - Fragment validation and path resolution:\n- Validate that fragments are valid Lattice IDs\n- Check if link path matches current document location\n- Detect path mismatches and missing fragments\n\n**link_transforms.rs** - Rewrite operations:\n- Add fragment to path-only links: `[text](path.md)` → `[text](path.md#ID)`\n- Expand shorthand: `[text](ID)` → `[text](path.md#ID)`\n- Update stale paths: `[text](old/path.md#ID)` → `[text](new/path.md#ID)`\n\n## Design References\n\n- @rules_engine/docs/lattice/appendix_linking_system.md#link-normalization\n- @rules_engine/docs/lattice/appendix_linking_system.md#normalization-algorithm\n\n## Testing\n\n- Path-only link → add fragment\n- ID-only shorthand → expand to full link\n- Stale path → update to current location\n- Multiple links in single document\n- Links in various markdown contexts\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:46:09.2019-08:00","created_by":"dthurn","updated_at":"2026-01-17T21:49:32.258902-08:00","closed_at":"2026-01-17T21:49:32.258902-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.9.5","depends_on_id":"dr-epv.9","type":"parent-child","created_at":"2026-01-17T16:46:09.20259-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.9.5","depends_on_id":"dr-epv.9.4","type":"blocks","created_at":"2026-01-17T16:46:40.656282-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.9.6","title":"Link System post-implementation review","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nPost-implementation structural review of the Link System feature.\n\n## Review Scope\n\nThis task requires a comprehensive review of the Link System implementation against the specification.\n\n## Design References\n\n- Implementation plan: @rules_engine/docs/lattice/lattice_implementation_plan.md (Link System feature)\n- Linking system spec: @rules_engine/docs/lattice/appendix_linking_system.md\n- File layout: @rules_engine/docs/lattice/appendix_file_layout.md (link/ section)\n\n## Review Questions\n\n### Question 1: Scope Completeness\n\nWas the scope in `lattice_implementation_plan.md` complete? Are there items which should have been included here, which now are not going to get implemented or are required for later work?\n\nConsider:\n- All work items (L1-L5) implemented\n- All files from file_layout.md created\n- Integration points with other features identified\n- Edge cases from appendix_linking_system.md handled\n\n### Question 2: Specification Satisfaction\n\nDoes the implementation fully satisfy the specification, including handling edge cases?\n\nConsider:\n- Link syntax variations (canonical, shorthand, path-only)\n- Closed task link handling (lat close rewrites links)\n- Reopening task link handling\n- Pruning task link handling (frontmatter removal, inline conversion)\n- Self-reference detection\n- Circular reference handling\n- External URL exclusion\n\n## Resolution Actions\n\nFor any identified gaps:\n1. Update documentation if spec needs clarification\n2. Add future implementation plan milestone if work is needed but not blocking\n3. Fix immediately now if critical for current functionality\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:46:23.65051-08:00","created_by":"dthurn","updated_at":"2026-01-17T22:10:00.839947-08:00","closed_at":"2026-01-17T22:10:00.839947-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.9.6","depends_on_id":"dr-epv.9","type":"parent-child","created_at":"2026-01-17T16:46:23.651253-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.9.6","depends_on_id":"dr-epv.9.5","type":"blocks","created_at":"2026-01-17T16:46:40.714013-08:00","created_by":"dthurn"}]}
{"id":"dr-in8","title":"Implement Output Formatting","description":"Implement text, JSON, and pretty output formatters for Lattice CLI.\n\n## Scope\n\n- **Text Formatter**: Human-readable plain text output\n- **JSON Formatter**: Structured serde serialization for `--json` mode\n- **Pretty Formatter**: Visual trees and colored output using color theme\n- Consistent document reference format: `\u003cid\u003e: \u003cname\u003e - \u003cdescription\u003e [\u003ctype\u003e]`\n\n## Implementation Notes\n\n- Create an `OutputFormat` enum or trait to abstract formatting\n- JSON output should use serde_json with consistent field naming\n- Pretty formatter should use Unicode box-drawing characters for trees\n- Handle long descriptions with truncation and ellipsis\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/appendix_cli_structure.md (output format examples)\n- @rules_engine/docs/lattice/appendix_workflow.md (lat show output format)\n\n## Dependencies\n\n- Uses color theme from `@rules_engine/src/lattice/src/cli/color_theme.rs`\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/output_format.rs`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:10:30.161019-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:11:57.134679-08:00","closed_at":"2026-01-16T21:11:57.134679-08:00","close_reason":"Recreating as hierarchical children of dr-epv","labels":["lattice"],"dependencies":[{"issue_id":"dr-in8","depends_on_id":"dr-beu","type":"blocks","created_at":"2026-01-16T21:10:35.58991-08:00","created_by":"dthurn"}]}
