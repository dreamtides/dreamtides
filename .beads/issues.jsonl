{"id":"dr-epv","title":"Lattice Document System Implementation","description":"Lattice is a unified knowledge base and task tracking system built on markdown files stored in git repositories, with SQLite providing an ephemeral index for query performance.\n\n## Core Innovation\n\nLattice treats markdown documents as first-class database entities while maintaining full git compatibility and human readability. Documents can exist anywhere in a project hierarchy, colocated with relevant code, and are identified by their `lattice-id` YAML annotation rather than filesystem location.\n\n## Design Philosophy\n\n- **Document Atomicity**: 500-line soft limit encourages focused documentation\n- **Git as Source of Truth**: SQLite serves exclusively as a performance cache\n- **Bulletproof Self-Healing**: Graceful error recovery with clear human-readable messages\n- **No Background Daemons**: Maintenance operations run opportunistically before commands\n\n## Key Features\n\n- YAML frontmatter for metadata (lattice-id, name, description, task tracking)\n- ID-based linking with automatic path resolution via `lat fmt`\n- Task tracking (bug/feature/task/chore) with blocking/blocked-by dependencies\n- Filesystem-based state: open tasks vs `.closed/` directory\n- Claude Skill integration (documents with `skill: true` become Skills)\n- Full-text search via FTS5\n- Comprehensive linting and validation\n\n## Design Documents\n\nMain design: @rules_engine/docs/lattice/lattice_design.md\n\n### Core Systems\n- ID System: @rules_engine/docs/lattice/appendix_id_system.md\n- Indexing: @rules_engine/docs/lattice/appendix_indexing.md\n- Linking System: @rules_engine/docs/lattice/appendix_linking_system.md\n- Error Handling: @rules_engine/docs/lattice/appendix_error_handling.md\n\n### Task \u0026 Workflow\n- Task Tracking: @rules_engine/docs/lattice/appendix_task_tracking.md\n- Task Templates: @rules_engine/docs/lattice/appendix_task_templates.md\n- Workflow Commands: @rules_engine/docs/lattice/appendix_workflow.md\n- Overview Command: @rules_engine/docs/lattice/appendix_overview_command.md\n\n### CLI \u0026 Validation\n- CLI Structure: @rules_engine/docs/lattice/appendix_cli_structure.md\n- Linter Rules: @rules_engine/docs/lattice/appendix_linter.md\n- Doctor Command: @rules_engine/docs/lattice/appendix_doctor.md\n\n### Integration\n- Git Integration: @rules_engine/docs/lattice/appendix_git_integration.md\n- Git Edge Cases: @rules_engine/docs/lattice/appendix_git_edge_cases.md\n- AI Integration: @rules_engine/docs/lattice/appendix_ai_integration.md\n- Configuration: @rules_engine/docs/lattice/appendix_configuration.md\n\n### Operations\n- Startup Operations: @rules_engine/docs/lattice/appendix_startup_operations.md\n- File Layout: @rules_engine/docs/lattice/appendix_file_layout.md\n\n### Testing \u0026 Quality\n- Testing Strategy: @rules_engine/docs/lattice/appendix_testing_strategy.md\n- Benchmarking: @rules_engine/docs/lattice/appendix_benchmarking.md\n- Chaos Monkey: @rules_engine/docs/lattice/appendix_chaos_monkey.md\n- Code Review: @rules_engine/docs/lattice/appendix_code_review.md\n\n## Implementation Location\n\nSource code: @rules_engine/src/lattice/\n\nThis epic serves as the parent for all Lattice implementation work. Child tasks should be created with `--parent` referencing this epic.\n","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2026-01-15T16:13:50.275342-08:00","created_by":"dthurn","updated_at":"2026-01-15T16:21:16.166011-08:00","labels":["test2"]}
{"id":"dr-epv.1","title":"Foundation: Core types, error handling, logging, configuration","description":"Core infrastructure that all other Lattice modules depend on. This feature must be completed before any other work can begin.\n\n## Scope\n\n- Error types and handling patterns (`LatticeError` enum)\n- Lattice ID system (generation, validation, encoding)\n- JSONL logging infrastructure\n- Configuration loading (layered: defaults → user → repo → env → CLI)\n\n## Design References\n\n- Error handling: @rules_engine/docs/lattice/appendix_error_handling.md\n- ID system: @rules_engine/docs/lattice/appendix_id_system.md\n- Configuration: @rules_engine/docs/lattice/appendix_configuration.md\n- Main design: @rules_engine/docs/lattice/lattice_design.md\n\n## Exports\n\n- `LatticeId` type with parsing/validation\n- `LatticeError` enum with all variants\n- `LatticeResult\u003cT\u003e` type alias\n- Logging macros and JSONL writer\n- `Config` struct with layered loading\n","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-15T16:15:55.629387-08:00","created_by":"dthurn","updated_at":"2026-01-16T12:54:00.426565-08:00","closed_at":"2026-01-16T12:54:00.426565-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-15T16:15:55.630127-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1.1","title":"Error Types: LatticeError enum and error handling infrastructure","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nDefine the error handling infrastructure for Lattice, distinguishing between user errors (recoverable) and system errors (panics).\n\n## Files to Create\n\n- `error/error_types.rs` - `LatticeError` enum with all variants\n- `error/error_formatting.rs` - `Display` and `Error` trait implementations\n- `error/exit_codes.rs` - Exit code constants (0=success, 1=system, 2=validation, 3=user, 4=not found)\n- `error/structured_output.rs` - JSON error serialization for `--json` mode\n\n## Implementation Notes\n\n- Use `thiserror` crate for derive macros\n- Integrate `human-panic` crate for panic formatting\n- Follow the expected/unexpected error distinction from design doc\n- Provide clear guidance messages for user errors\n- Log extensively for system errors\n\n## Design Reference\n\n- @rules_engine/docs/lattice/appendix_error_handling.md (complete error taxonomy)\n- @rules_engine/docs/lattice/lattice_design.md#error-handling\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T16:16:12.921579-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:41.841755-08:00","closed_at":"2026-01-16T06:47:42.954929-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1.1","depends_on_id":"dr-epv.1","type":"parent-child","created_at":"2026-01-15T16:16:12.922222-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1.2","title":"ID System: LatticeId type with generation and validation","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the Lattice ID system: compact, human-typeable identifiers using Base32 encoding.\n\n## Files to Create\n\n- `id/lattice_id.rs` - `LatticeId` newtype with validation\n- `id/base32_encoding.rs` - RFC 4648 Base32 encoding/decoding (alphabet: A-Z, 2-7)\n- `id/id_generator.rs` - Document counter and ID generation\n- `id/client_selection.rs` - Client ID generation with length scaling\n\n## ID Format\n\n- Structure: `L` prefix + Base32 document counter + Base32 client ID\n- Example: `LK3DTX` (document 675, client DTX)\n- Minimum 6 characters total\n- Counter starts at 50 to ensure 6+ char IDs\n\n## Implementation Notes\n\n- Validate: minimum 6 chars, valid Base32, `L` prefix\n- Client ID length scales with known client count (3-6 chars)\n- Counter recovery: scan existing documents on repo re-clone to find highest counter per client\n- Use `LatticeError` for validation failures\n\n## Design Reference\n\n- @rules_engine/docs/lattice/appendix_id_system.md (generation algorithm, collision handling)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T16:16:22.976198-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:41.921119-08:00","closed_at":"2026-01-16T10:45:29.574672-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1.2","depends_on_id":"dr-epv.1","type":"parent-child","created_at":"2026-01-15T16:16:22.976848-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.1.2","depends_on_id":"dr-epv.1.1","type":"blocks","created_at":"2026-01-15T16:16:44.767351-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1.3","title":"Logging: JSONL logging infrastructure with tracing","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement JSONL-based logging infrastructure using the tracing crate.\n\n## Files to Create\n\n- `log/jsonl_writer.rs` - JSONL file writer with rotation\n- `log/log_entry.rs` - Log entry struct (timestamp, level, operation, duration, details)\n- `log/log_reader.rs` - Log file reading utilities for debugging\n\n## Logging Behavior\n\n- Write to `.lattice/logs.jsonl`\n- Log rotation: rename to `.1` when \u003e10MB\n- Support `--verbose` flag for debug output to stderr\n- All git/SQLite/file operations must be logged\n\n## Implementation Notes\n\n- Configure `tracing` crate with custom JSONL subscriber\n- Structured logging for git operations, SQLite queries, file I/O\n- Include operation duration for performance tracking\n- Silent failure is a critical design flaw - log everything\n\n## Design Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#logging\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T16:16:31.260375-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:41.998323-08:00","closed_at":"2026-01-16T12:01:59.386101-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1.3","depends_on_id":"dr-epv.1","type":"parent-child","created_at":"2026-01-15T16:16:31.261082-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.1.3","depends_on_id":"dr-epv.1.2","type":"blocks","created_at":"2026-01-15T16:16:44.804667-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1.4","title":"Configuration: Layered config loading from multiple sources","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement layered configuration loading with precedence: defaults → user → repo → env vars → CLI flags.\n\n## Files to Create\n\n- `config/config_loader.rs` - Layered configuration loading logic\n- `config/config_schema.rs` - `Config` struct with all configuration fields\n- `git/client_config.rs` - Client ID storage and retrieval\n\n## Configuration Sources (in precedence order)\n\n1. Built-in defaults\n2. `~/.lattice.toml` - User config (client IDs, personal defaults)\n3. `.lattice/config.toml` - Repo config (overview weights, format settings)\n4. Environment variables (`LATTICE_*`)\n5. CLI flags (highest precedence)\n\n## Implementation Notes\n\n- Use TOML format for config files\n- All fields should have sensible defaults\n- Log config loading with sources for debugging\n- Handle missing config files gracefully\n- Validate config values are in acceptable ranges\n\n## Design Reference\n\n- @rules_engine/docs/lattice/appendix_configuration.md (complete field list and defaults)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T16:16:38.741186-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:42.075871-08:00","closed_at":"2026-01-16T12:14:23.480445-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1.4","depends_on_id":"dr-epv.1","type":"parent-child","created_at":"2026-01-15T16:16:38.74182-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.1.4","depends_on_id":"dr-epv.1.3","type":"blocks","created_at":"2026-01-15T16:16:44.841773-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.2","title":"Git Layer: Git integration abstraction for document discovery and change detection","description":"Abstract git operations behind a trait for testing. Implement document discovery and change detection.\n\n## Depends On\n- Foundation feature (for error types, logging)\n\n## Exports\n- `GitOps` trait for dependency injection\n- `RealGit` production implementation\n- `ModifiedFiles` detection for reconciliation\n- Repository edge case detection and handling\n\n## Design References\n- @rules_engine/docs/lattice/appendix_git_integration.md\n- @rules_engine/docs/lattice/appendix_git_edge_cases.md\n- @rules_engine/docs/lattice/appendix_file_layout.md (git/ section)\n\n## Files\nAll implementation in `rules_engine/src/lattice/src/git/`:\n- `mod.rs` - Module declarations only\n- `git_ops.rs` - GitOps trait definition\n- `real_git.rs` - Production implementation (shells out to git)\n- `modified_files.rs` - Change detection via git diff/status\n- `repo_detection.rs` - Detect repo configuration (shallow, sparse, etc.)\n- `edge_cases.rs` - Handling for worktrees, submodules, bare repos\n- `conflict_detection.rs` - Detect merge conflicts, in-progress operations\n","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2026-01-16T12:52:42.229577-08:00","created_by":"dthurn","updated_at":"2026-01-16T14:06:05.277892-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.2","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-16T12:52:42.231066-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.2.1","title":"GitOps Trait Definition","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nDefine the `GitOps` trait that abstracts all git operations for dependency injection.\n\n## Implementation\n**File:** `rules_engine/src/lattice/src/git/git_ops.rs`\n\n## Trait Methods\nDefine trait with methods:\n- `ls_files(pattern: \u0026str)` - List tracked files matching pattern\n- `diff(from_commit: \u0026str, to_commit: \u0026str, pattern: \u0026str)` - Files changed between commits\n- `status(pattern: \u0026str)` - Uncommitted changes (staged and unstaged)\n- `rev_parse(ref: \u0026str)` - Resolve ref to commit hash (e.g., HEAD)\n- `log(path: Option\u003c\u0026str\u003e, format: \u0026str, limit: usize)` - Commit history\n- `config_get(key: \u0026str)` - Read git config value\n\n## Requirements\n- All methods return `Result\u003cT, LatticeError\u003e`\n- Trait must be object-safe for dependency injection\n- Error handling via `LatticeError::GitError` variant (from Foundation)\n- Methods should accept pathspec patterns (e.g., `*.md`)\n\n## Design References\n- @rules_engine/docs/lattice/appendix_git_integration.md (Required Git Operations section)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:53:11.371391-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:42.155328-08:00","closed_at":"2026-01-16T13:06:53.059212-08:00","close_reason":"Implemented GitOps trait with ls_files, diff, status, rev_parse, log, and config_get methods. Added FileStatus struct with helper methods. Tests added for FileStatus behavior.","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.2.1","depends_on_id":"dr-epv.2","type":"parent-child","created_at":"2026-01-16T12:53:11.372175-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.2.2","title":"RealGit Implementation","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the `GitOps` trait by shelling out to the git CLI.\n\n## Implementation\n**File:** `rules_engine/src/lattice/src/git/real_git.rs`\n\n## Functionality\n- Implement all `GitOps` trait methods\n- Shell out to git CLI for each operation\n- Parse git command output into structured data\n- Handle git errors and convert to `LatticeError::GitError`\n\n## Git Commands to Wrap\n- `git ls-files '\u003cpattern\u003e'` - Document discovery\n- `git diff --name-only \u003ccommit\u003e..HEAD -- '\u003cpattern\u003e'` - Change detection\n- `git status --porcelain -- '\u003cpattern\u003e'` - Uncommitted changes\n- `git rev-parse \u003cref\u003e` - Resolve references\n- `git log -\u003cn\u003e --format='\u003cformat\u003e' -- \u003cpath\u003e` - Commit history\n- `git config --get \u003ckey\u003e` - Configuration values\n\n## Error Handling\n- Parse git stderr for meaningful error messages\n- Distinguish between \"command failed\" vs \"git error\"\n- Log all git commands and their results via tracing\n\n## Design References\n- @rules_engine/docs/lattice/appendix_git_integration.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:53:12.581312-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:42.234925-08:00","closed_at":"2026-01-16T13:46:31.89809-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.2.2","depends_on_id":"dr-epv.2","type":"parent-child","created_at":"2026-01-16T12:53:12.582001-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.2.2","depends_on_id":"dr-epv.2.1","type":"blocks","created_at":"2026-01-16T12:53:22.929641-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.2.3","title":"Document Discovery via Git","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement document discovery and change detection functions using GitOps trait.\n\n## Implementation\n**File:** `rules_engine/src/lattice/src/git/modified_files.rs`\n\n## Core Functions\n\n### Full Document Enumeration\n- `list_all_documents(git: \u0026dyn GitOps) -\u003e Result\u003cVec\u003cPathBuf\u003e\u003e`\n- Uses `git ls-files '*.md'`\n- Returns all tracked markdown files\n- Excludes gitignored files automatically\n\n### Change Detection (Committed)\n- `list_changed_documents(git: \u0026dyn GitOps, since_commit: \u0026str) -\u003e Result\u003cVec\u003cPathBuf\u003e\u003e`\n- Uses `git diff --name-only \u003ccommit\u003e..HEAD -- '*.md'`\n- Returns files modified since a specific commit\n- Used for incremental reconciliation\n\n### Change Detection (Uncommitted)\n- `list_uncommitted_changes(git: \u0026dyn GitOps) -\u003e Result\u003cVec\u003cPathBuf\u003e\u003e`\n- Uses `git status --porcelain -- '*.md'`\n- Returns staged and unstaged modifications\n- Parse porcelain output to extract paths\n\n## Requirements\n- Return `Vec\u003cPathBuf\u003e` for all operations\n- Handle pathspec filtering consistently\n- Log document counts at debug level\n\n## Design References\n- @rules_engine/docs/lattice/appendix_git_integration.md (Document Discovery section)\n- @rules_engine/docs/lattice/appendix_indexing.md (Reconciliation section)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:53:14.797303-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:45:23.814843-08:00","closed_at":"2026-01-16T15:45:23.814845-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.2.3","depends_on_id":"dr-epv.2","type":"parent-child","created_at":"2026-01-16T12:53:14.797978-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.2.3","depends_on_id":"dr-epv.2.2","type":"blocks","created_at":"2026-01-16T12:53:23.713987-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.2.4","title":"Repository Edge Case Detection","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nDetect and handle non-standard git repository configurations.\n\n## Implementation Files\n- `rules_engine/src/lattice/src/git/repo_detection.rs` - Configuration detection\n- `rules_engine/src/lattice/src/git/edge_cases.rs` - Edge case handling logic\n- `rules_engine/src/lattice/src/git/conflict_detection.rs` - In-progress git operations\n\n## Detection Functions (repo_detection.rs)\n\n### Repository Configuration Struct\nDefine `RepoConfig` with detected state:\n- `is_shallow: bool` - Shallow clone\n- `is_partial: bool` - Partial clone (blobless/treeless)\n- `partial_filter: Option\u003cString\u003e` - Filter specification\n- `is_sparse: bool` - Sparse checkout enabled\n- `is_worktree: bool` - Is a worktree (not main repo)\n- `main_git_dir: PathBuf` - Path to main .git directory\n- `has_submodules: bool` - Submodules present\n- `is_bare: bool` - Bare repository (not supported)\n- `in_progress_op: Option\u003cGitOp\u003e` - Rebase/merge/cherry-pick in progress\n\n### Detection Methods\n- Check `.git/shallow` for shallow clones\n- Check `git config --get remote.origin.promisor` for partial clones\n- Check `git config --get core.sparseCheckout` for sparse checkout\n- Check if `.git` is file vs directory for worktrees\n- Check `.gitmodules` for submodules\n- Check `.git/MERGE_HEAD`, `.git/rebase-merge`, etc. for in-progress ops\n\n## Cache Management\n- Cache detection results in `.lattice/repo_config.json`\n- Invalidate when `.git` directory mtime changes\n- Re-detect on cache miss or invalidation\n\n## Conflict Detection (conflict_detection.rs)\n- `has_conflict_markers(content: \u0026str) -\u003e bool`\n- Detect `\u003c\u003c\u003c\u003c\u003c\u003c\u003c`, `=======`, `\u003e\u003e\u003e\u003e\u003e\u003e\u003e` in file content\n- Used during document parsing to skip conflicted files\n\n## Design References\n- @rules_engine/docs/lattice/appendix_git_edge_cases.md (comprehensive)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-16T12:53:16.010009-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:42.399046-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.2.4","depends_on_id":"dr-epv.2","type":"parent-child","created_at":"2026-01-16T12:53:16.01071-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.2.4","depends_on_id":"dr-epv.2.3","type":"blocks","created_at":"2026-01-16T12:53:24.596331-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.3","title":"Document Model: Parse and serialize Lattice documents with frontmatter validation","description":"## Goal\n\nParse and serialize Lattice documents, validate frontmatter fields, and provide document I/O utilities.\n\n## Depends On\n\n- Foundation (dr-epv.1) - for LatticeId types, LatticeError types\n\n## Exports\n\n- `Document` struct with frontmatter and body\n- `Frontmatter` struct with all fields\n- Parse/serialize functions\n- Field validation\n\n## Files\n\nAll files in `rules_engine/src/lattice/src/document/`:\n- `mod.rs` - Module declarations only\n- `frontmatter_schema.rs` - Field definitions, allowed keys\n- `frontmatter_parser.rs` - YAML extraction and parsing\n- `field_validation.rs` - Type checking, value validation\n- `document_reader.rs` - Load and parse complete documents\n- `document_writer.rs` - Serialize documents back to files\n- `markdown_body.rs` - Body content handling\n\n## Design Reference\n\n- Main design: @rules_engine/docs/lattice/lattice_design.md#document-structure\n- Task tracking: @rules_engine/docs/lattice/appendix_task_tracking.md\n- File layout: @rules_engine/docs/lattice/appendix_file_layout.md\n","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2026-01-16T12:57:54.738438-08:00","created_by":"dthurn","updated_at":"2026-01-16T14:06:05.368101-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.3","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-16T12:57:54.739206-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.3.1","title":"Frontmatter Schema Definition","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n## Goal\n\nDefine all frontmatter fields as a typed Rust struct for Lattice documents.\n\n## File\n\n`rules_engine/src/lattice/src/document/frontmatter_schema.rs`\n\n## Implementation\n\nDefine `Frontmatter` struct with all fields:\n\n**Required fields (all documents):**\n- `lattice-id`: LatticeId - unique document identifier\n- `name`: String - lowercase-hyphen format, derived from filename, max 64 chars\n- `description`: String - human-readable summary, max 1024 chars\n\n**Optional identity fields:**\n- `parent-id`: Option\u003cLatticeId\u003e - ID of parent document, auto-populated from directory root\n\n**Task tracking fields (tasks only):**\n- `task-type`: Option\u003cTaskType\u003e - bug/feature/task/chore\n- `priority`: Option\u003cu8\u003e - 0-4 (0 highest)\n- `labels`: Vec\u003cString\u003e - arbitrary string labels\n- `blocking`: Vec\u003cLatticeId\u003e - tasks with hard dependencies on this task\n- `blocked-by`: Vec\u003cLatticeId\u003e - tasks this task depends on\n- `discovered-from`: Vec\u003cLatticeId\u003e - parent tasks from which this was discovered\n\n**Timestamp fields:**\n- `created-at`: Option\u003cDateTime\u003e - ISO 8601\n- `updated-at`: Option\u003cDateTime\u003e - ISO 8601\n- `closed-at`: Option\u003cDateTime\u003e - ISO 8601\n\n**Skill integration:**\n- `skill`: bool - enables Claude Skill generation\n\n## Design Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#yaml-frontmatter\n- @rules_engine/docs/lattice/appendix_task_tracking.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:58:24.428469-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:42.475921-08:00","closed_at":"2026-01-16T13:08:28.266736-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.3.1","depends_on_id":"dr-epv.3","type":"parent-child","created_at":"2026-01-16T12:58:24.429251-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.3.2","title":"Frontmatter Parser","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n## Goal\n\nExtract and parse YAML frontmatter from markdown documents into the Frontmatter struct.\n\n## File\n\n`rules_engine/src/lattice/src/document/frontmatter_parser.rs`\n\n## Implementation\n\n- Extract YAML content between `---` markers at document start\n- Use `serde_yaml` crate for deserialization into Frontmatter struct\n- Return `LatticeError::InvalidFrontmatter` on parse failure with clear error message\n- Handle and reject unknown/invalid keys (linter rule E003)\n- Preserve original YAML for round-tripping when possible\n\n## Edge Cases\n\n- Missing opening/closing `---` markers\n- Empty frontmatter\n- Malformed YAML syntax\n- Unknown keys that don't map to Frontmatter fields\n- Missing required fields (lattice-id, name, description)\n\n## Design Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#yaml-frontmatter\n- @rules_engine/docs/lattice/appendix_error_handling.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:58:25.245589-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:42.552719-08:00","closed_at":"2026-01-16T14:00:21.428941-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.3.2","depends_on_id":"dr-epv.3","type":"parent-child","created_at":"2026-01-16T12:58:25.246286-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.3.2","depends_on_id":"dr-epv.3.1","type":"blocks","created_at":"2026-01-16T12:58:35.59448-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.3.3","title":"Field Validation","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n## Goal\n\nValidate frontmatter field values for type correctness and semantic constraints.\n\n## File\n\n`rules_engine/src/lattice/src/document/field_validation.rs`\n\n## Validation Rules\n\n**name field:**\n- Format: lowercase letters, hyphens only (derived from filename)\n- Max length: 64 characters\n- Must match filename (underscores→hyphens, no .md extension)\n- Linter rule E008 for mismatches\n\n**description field:**\n- Non-empty string required\n- Max length: 1024 characters\n\n**priority field:**\n- Integer 0-4 only (0=critical, 4=backlog)\n- Required for tasks (documents with task-type)\n\n**task-type field:**\n- Enum: bug, feature, task, chore\n- Case-insensitive parsing\n\n**ID references (blocking, blocked-by, discovered-from):**\n- Each entry must be valid LatticeId format\n- Cross-reference validation deferred to linter (needs index)\n\n**Timestamps:**\n- ISO 8601 format validation\n\n## Error Handling\n\n- Return specific validation errors with field name and reason\n- Support batch validation (collect all errors, not just first)\n\n## Design Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#yaml-frontmatter\n- @rules_engine/docs/lattice/appendix_linter.md (rules E003-E010)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:58:27.034061-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:45:39.35586-08:00","closed_at":"2026-01-16T15:45:39.355863-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.3.3","depends_on_id":"dr-epv.3","type":"parent-child","created_at":"2026-01-16T12:58:27.034771-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.3.3","depends_on_id":"dr-epv.3.2","type":"blocks","created_at":"2026-01-16T12:58:36.295544-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.3.4","title":"Document Reader and Writer","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n## Goal\n\nProvide document I/O operations for reading and writing Lattice documents.\n\n## Files\n\n- `rules_engine/src/lattice/src/document/document_reader.rs` - loading documents\n- `rules_engine/src/lattice/src/document/document_writer.rs` - serializing documents\n- `rules_engine/src/lattice/src/document/markdown_body.rs` - body content utilities\n\n## Document Reader\n\n- Read complete document from filesystem path\n- Split content into frontmatter (YAML) and body (markdown)\n- Parse frontmatter using frontmatter_parser module\n- Return `Document` struct with both components\n- Handle encoding (UTF-8 with BOM detection)\n\n## Document Writer\n\n- Serialize `Document` struct back to file\n- Format: frontmatter YAML + `---` separator + body content\n- **Atomic write**: write to temp file, then rename (prevents corruption)\n- Preserve body content exactly (no reformatting unless explicitly requested)\n- Update `updated-at` timestamp on write\n\n## Markdown Body Utilities\n\n- Extract body content (everything after frontmatter)\n- Utilities for appending content to body\n- Line counting for 500-line soft limit checks\n- Content manipulation helpers for `lat split` command\n\n## Design Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#document-structure\n- @rules_engine/docs/lattice/appendix_file_layout.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-16T12:58:27.846951-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:42.719583-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.3.4","depends_on_id":"dr-epv.3","type":"parent-child","created_at":"2026-01-16T12:58:27.847627-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.3.4","depends_on_id":"dr-epv.3.3","type":"blocks","created_at":"2026-01-16T12:58:37.182523-08:00","created_by":"dthurn"}]}
