{"id":"dr-2jd","title":"CLI Framework","description":"Implement the CLI framework layer for Lattice: argument parsing, command dispatch, output formatting, and color theme.\n\n## Scope\n\n- **Argument Parser**: Clap-based command definitions for all `lat` subcommands\n- **Command Dispatch**: Route parsed arguments to command implementations with startup operations hook\n- **Output Formatting**: Text/JSON/pretty output helpers with consistent document reference format\n- **Color Theme**: Ayu color palette with terminal detection and semantic coloring\n\n## Status\n\n- C5 (Global Options) is already implemented in `@rules_engine/src/lattice/src/cli/global_options.rs`\n- Files exist as stubs for C1-C4; implementation needed\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/lattice_design.md#command-overview\n- @rules_engine/docs/lattice/appendix_cli_structure.md\n- @rules_engine/docs/lattice/appendix_file_layout.md (cli/ section)\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/argument_parser.rs`\n- `@rules_engine/src/lattice/src/cli/command_dispatch.rs`\n- `@rules_engine/src/lattice/src/cli/output_format.rs`\n- `@rules_engine/src/lattice/src/cli/color_theme.rs`","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-16T21:09:29.278535-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:11:57.100003-08:00","closed_at":"2026-01-16T21:11:57.100003-08:00","close_reason":"Recreating as hierarchical children of dr-epv","labels":["lattice"],"dependencies":[{"issue_id":"dr-2jd","depends_on_id":"dr-beu","type":"blocks","created_at":"2026-01-16T21:10:21.141438-08:00","created_by":"dthurn"},{"issue_id":"dr-2jd","depends_on_id":"dr-in8","type":"blocks","created_at":"2026-01-16T21:10:35.652093-08:00","created_by":"dthurn"},{"issue_id":"dr-2jd","depends_on_id":"dr-5hf","type":"blocks","created_at":"2026-01-16T21:10:50.959154-08:00","created_by":"dthurn"},{"issue_id":"dr-2jd","depends_on_id":"dr-did","type":"blocks","created_at":"2026-01-16T21:11:04.493782-08:00","created_by":"dthurn"}]}
{"id":"dr-5hf","title":"Implement Argument Parser","description":"Implement Clap-based argument parsing for all `lat` subcommands.\n\n## Scope\n\n- Define main `Lat` CLI struct with Clap derive macros\n- Define all subcommands with their arguments per CLI spec\n- Set up global options: `--json`, `--verbose`, `--quiet`, `--help`, `--version`\n- Configure environment variable bindings (`LATTICE_LOG_LEVEL`, etc.)\n- Include subcommands: show, create, update, close, reopen, prune, list, ready, search, stale, blocked, changes, stats, tree, roots, children, dep, label, links-from, links-to, path, orphans, impact, claim, overview, prime, track, generate-ids, split, mv, edit, fmt, check, doctor, setup, completion, chaosmonkey\n\n## Implementation Notes\n\n- Use Clap's derive API (`Parser`, `Subcommand`, `Args`)\n- Flatten `GlobalOptions` into each command\n- Group related arguments (e.g., filter options as a shared Args struct)\n- Add help text and examples for each command\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/appendix_cli_structure.md (complete command list)\n- @rules_engine/docs/lattice/lattice_design.md#command-overview\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/argument_parser.rs`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:10:46.946145-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:11:57.151118-08:00","closed_at":"2026-01-16T21:11:57.151118-08:00","close_reason":"Recreating as hierarchical children of dr-epv","labels":["lattice"],"dependencies":[{"issue_id":"dr-5hf","depends_on_id":"dr-in8","type":"blocks","created_at":"2026-01-16T21:10:50.897078-08:00","created_by":"dthurn"}]}
{"id":"dr-beu","title":"Implement Color Theme","description":"Implement the Ayu color theme for Lattice CLI output.\n\n## Scope\n\n- Define Ayu color palette constants:\n  - Green for success states\n  - Yellow for warnings\n  - Red for errors\n  - Blue for accent/highlighting\n  - Gray for muted/secondary text\n- Implement terminal detection for color support\n- Support `LATTICE_NO_COLOR` environment variable\n- Create semantic coloring functions for common output patterns\n\n## Implementation Notes\n\n- Use a crate like `termcolor` or `owo-colors` for cross-platform terminal colors\n- Detect TTY vs piped output to disable colors when not interactive\n- Provide fallback for terminals without color support\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/lattice_design.md#ui-design\n- @rules_engine/docs/lattice/appendix_cli_structure.md#environment-variables\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/color_theme.rs`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:10:16.746851-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:11:57.118111-08:00","closed_at":"2026-01-16T21:11:57.118111-08:00","close_reason":"Recreating as hierarchical children of dr-epv","labels":["lattice"]}
{"id":"dr-did","title":"Implement Command Dispatch","description":"Implement command dispatch to route parsed arguments to handler functions.\n\n## Scope\n\n- Match parsed commands to handler functions\n- Thread context (GitOps, Index) through handlers\n- Implement startup operations hook (runs before each command)\n- Map results to exit codes per error handling spec\n- Implement hidden `--no-startup` flag for debugging\n\n## Startup Operations Hook\n\nPer @rules_engine/docs/lattice/appendix_startup_operations.md:\n- Index reconciliation\n- Skill symlink sync\n- Claim cleanup\n- Log rotation\n- Performance budget: \u003c100ms total; emit debug log if exceeded\n\n## Implementation Notes\n\n- Create a `CommandContext` struct holding shared state (GitOps, Index, Config)\n- Each command handler receives context and returns `LatticeResult\u003c()\u003e`\n- Convert `LatticeError` to appropriate exit codes\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/appendix_startup_operations.md\n- @rules_engine/docs/lattice/appendix_error_handling.md (exit codes)\n- @rules_engine/docs/lattice/appendix_cli_structure.md#exit-codes\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/command_dispatch.rs`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:10:59.832021-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:11:57.168048-08:00","closed_at":"2026-01-16T21:11:57.168048-08:00","close_reason":"Recreating as hierarchical children of dr-epv","labels":["lattice"],"dependencies":[{"issue_id":"dr-did","depends_on_id":"dr-5hf","type":"blocks","created_at":"2026-01-16T21:11:04.42939-08:00","created_by":"dthurn"}]}
{"id":"dr-epv","title":"Lattice Document System Implementation","description":"Lattice is a unified knowledge base and task tracking system built on markdown files stored in git repositories, with SQLite providing an ephemeral index for query performance.\n\n## Core Innovation\n\nLattice treats markdown documents as first-class database entities while maintaining full git compatibility and human readability. Documents can exist anywhere in a project hierarchy, colocated with relevant code, and are identified by their `lattice-id` YAML annotation rather than filesystem location.\n\n## Design Philosophy\n\n- **Document Atomicity**: 500-line soft limit encourages focused documentation\n- **Git as Source of Truth**: SQLite serves exclusively as a performance cache\n- **Bulletproof Self-Healing**: Graceful error recovery with clear human-readable messages\n- **No Background Daemons**: Maintenance operations run opportunistically before commands\n\n## Key Features\n\n- YAML frontmatter for metadata (lattice-id, name, description, task tracking)\n- ID-based linking with automatic path resolution via `lat fmt`\n- Task tracking (bug/feature/task/chore) with blocking/blocked-by dependencies\n- Filesystem-based state: open tasks vs `.closed/` directory\n- Claude Skill integration (documents with `skill: true` become Skills)\n- Full-text search via FTS5\n- Comprehensive linting and validation\n\n## Design Documents\n\nMain design: @rules_engine/docs/lattice/lattice_design.md\n\n### Core Systems\n- ID System: @rules_engine/docs/lattice/appendix_id_system.md\n- Indexing: @rules_engine/docs/lattice/appendix_indexing.md\n- Linking System: @rules_engine/docs/lattice/appendix_linking_system.md\n- Error Handling: @rules_engine/docs/lattice/appendix_error_handling.md\n\n### Task \u0026 Workflow\n- Task Tracking: @rules_engine/docs/lattice/appendix_task_tracking.md\n- Task Templates: @rules_engine/docs/lattice/appendix_task_templates.md\n- Workflow Commands: @rules_engine/docs/lattice/appendix_workflow.md\n- Overview Command: @rules_engine/docs/lattice/appendix_overview_command.md\n\n### CLI \u0026 Validation\n- CLI Structure: @rules_engine/docs/lattice/appendix_cli_structure.md\n- Linter Rules: @rules_engine/docs/lattice/appendix_linter.md\n- Doctor Command: @rules_engine/docs/lattice/appendix_doctor.md\n\n### Integration\n- Git Integration: @rules_engine/docs/lattice/appendix_git_integration.md\n- Git Edge Cases: @rules_engine/docs/lattice/appendix_git_edge_cases.md\n- AI Integration: @rules_engine/docs/lattice/appendix_ai_integration.md\n- Configuration: @rules_engine/docs/lattice/appendix_configuration.md\n\n### Operations\n- Startup Operations: @rules_engine/docs/lattice/appendix_startup_operations.md\n- File Layout: @rules_engine/docs/lattice/appendix_file_layout.md\n\n### Testing \u0026 Quality\n- Testing Strategy: @rules_engine/docs/lattice/appendix_testing_strategy.md\n- Benchmarking: @rules_engine/docs/lattice/appendix_benchmarking.md\n- Chaos Monkey: @rules_engine/docs/lattice/appendix_chaos_monkey.md\n- Code Review: @rules_engine/docs/lattice/appendix_code_review.md\n\n## Implementation Location\n\nSource code: @rules_engine/src/lattice/\n\nThis epic serves as the parent for all Lattice implementation work. Child tasks should be created with `--parent` referencing this epic.\n","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2026-01-15T16:13:50.275342-08:00","created_by":"dthurn","updated_at":"2026-01-15T16:21:16.166011-08:00","labels":["test2"],"dependencies":[{"issue_id":"dr-epv","depends_on_id":"dr-2jd","type":"blocks","created_at":"2026-01-16T21:09:48.380835-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1","title":"Foundation: Core types, error handling, logging, configuration","description":"Core infrastructure that all other Lattice modules depend on. This feature must be completed before any other work can begin.\n\n## Scope\n\n- Error types and handling patterns (`LatticeError` enum)\n- Lattice ID system (generation, validation, encoding)\n- JSONL logging infrastructure\n- Configuration loading (layered: defaults → user → repo → env → CLI)\n\n## Design References\n\n- Error handling: @rules_engine/docs/lattice/appendix_error_handling.md\n- ID system: @rules_engine/docs/lattice/appendix_id_system.md\n- Configuration: @rules_engine/docs/lattice/appendix_configuration.md\n- Main design: @rules_engine/docs/lattice/lattice_design.md\n\n## Exports\n\n- `LatticeId` type with parsing/validation\n- `LatticeError` enum with all variants\n- `LatticeResult\u003cT\u003e` type alias\n- Logging macros and JSONL writer\n- `Config` struct with layered loading\n","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-15T16:15:55.629387-08:00","created_by":"dthurn","updated_at":"2026-01-16T12:54:00.426565-08:00","closed_at":"2026-01-16T12:54:00.426565-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-15T16:15:55.630127-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1.1","title":"Error Types: LatticeError enum and error handling infrastructure","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nDefine the error handling infrastructure for Lattice, distinguishing between user errors (recoverable) and system errors (panics).\n\n## Files to Create\n\n- `error/error_types.rs` - `LatticeError` enum with all variants\n- `error/error_formatting.rs` - `Display` and `Error` trait implementations\n- `error/exit_codes.rs` - Exit code constants (0=success, 1=system, 2=validation, 3=user, 4=not found)\n- `error/structured_output.rs` - JSON error serialization for `--json` mode\n\n## Implementation Notes\n\n- Use `thiserror` crate for derive macros\n- Integrate `human-panic` crate for panic formatting\n- Follow the expected/unexpected error distinction from design doc\n- Provide clear guidance messages for user errors\n- Log extensively for system errors\n\n## Design Reference\n\n- @rules_engine/docs/lattice/appendix_error_handling.md (complete error taxonomy)\n- @rules_engine/docs/lattice/lattice_design.md#error-handling\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T16:16:12.921579-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:41.841755-08:00","closed_at":"2026-01-16T06:47:42.954929-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1.1","depends_on_id":"dr-epv.1","type":"parent-child","created_at":"2026-01-15T16:16:12.922222-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1.2","title":"ID System: LatticeId type with generation and validation","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the Lattice ID system: compact, human-typeable identifiers using Base32 encoding.\n\n## Files to Create\n\n- `id/lattice_id.rs` - `LatticeId` newtype with validation\n- `id/base32_encoding.rs` - RFC 4648 Base32 encoding/decoding (alphabet: A-Z, 2-7)\n- `id/id_generator.rs` - Document counter and ID generation\n- `id/client_selection.rs` - Client ID generation with length scaling\n\n## ID Format\n\n- Structure: `L` prefix + Base32 document counter + Base32 client ID\n- Example: `LK3DTX` (document 675, client DTX)\n- Minimum 6 characters total\n- Counter starts at 50 to ensure 6+ char IDs\n\n## Implementation Notes\n\n- Validate: minimum 6 chars, valid Base32, `L` prefix\n- Client ID length scales with known client count (3-6 chars)\n- Counter recovery: scan existing documents on repo re-clone to find highest counter per client\n- Use `LatticeError` for validation failures\n\n## Design Reference\n\n- @rules_engine/docs/lattice/appendix_id_system.md (generation algorithm, collision handling)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T16:16:22.976198-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:41.921119-08:00","closed_at":"2026-01-16T10:45:29.574672-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1.2","depends_on_id":"dr-epv.1","type":"parent-child","created_at":"2026-01-15T16:16:22.976848-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.1.2","depends_on_id":"dr-epv.1.1","type":"blocks","created_at":"2026-01-15T16:16:44.767351-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1.3","title":"Logging: JSONL logging infrastructure with tracing","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement JSONL-based logging infrastructure using the tracing crate.\n\n## Files to Create\n\n- `log/jsonl_writer.rs` - JSONL file writer with rotation\n- `log/log_entry.rs` - Log entry struct (timestamp, level, operation, duration, details)\n- `log/log_reader.rs` - Log file reading utilities for debugging\n\n## Logging Behavior\n\n- Write to `.lattice/logs.jsonl`\n- Log rotation: rename to `.1` when \u003e10MB\n- Support `--verbose` flag for debug output to stderr\n- All git/SQLite/file operations must be logged\n\n## Implementation Notes\n\n- Configure `tracing` crate with custom JSONL subscriber\n- Structured logging for git operations, SQLite queries, file I/O\n- Include operation duration for performance tracking\n- Silent failure is a critical design flaw - log everything\n\n## Design Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#logging\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T16:16:31.260375-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:41.998323-08:00","closed_at":"2026-01-16T12:01:59.386101-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1.3","depends_on_id":"dr-epv.1","type":"parent-child","created_at":"2026-01-15T16:16:31.261082-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.1.3","depends_on_id":"dr-epv.1.2","type":"blocks","created_at":"2026-01-15T16:16:44.804667-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1.4","title":"Configuration: Layered config loading from multiple sources","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement layered configuration loading with precedence: defaults → user → repo → env vars → CLI flags.\n\n## Files to Create\n\n- `config/config_loader.rs` - Layered configuration loading logic\n- `config/config_schema.rs` - `Config` struct with all configuration fields\n- `git/client_config.rs` - Client ID storage and retrieval\n\n## Configuration Sources (in precedence order)\n\n1. Built-in defaults\n2. `~/.lattice.toml` - User config (client IDs, personal defaults)\n3. `.lattice/config.toml` - Repo config (overview weights, format settings)\n4. Environment variables (`LATTICE_*`)\n5. CLI flags (highest precedence)\n\n## Implementation Notes\n\n- Use TOML format for config files\n- All fields should have sensible defaults\n- Log config loading with sources for debugging\n- Handle missing config files gracefully\n- Validate config values are in acceptable ranges\n\n## Design Reference\n\n- @rules_engine/docs/lattice/appendix_configuration.md (complete field list and defaults)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T16:16:38.741186-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:42.075871-08:00","closed_at":"2026-01-16T12:14:23.480445-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1.4","depends_on_id":"dr-epv.1","type":"parent-child","created_at":"2026-01-15T16:16:38.74182-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.1.4","depends_on_id":"dr-epv.1.3","type":"blocks","created_at":"2026-01-15T16:16:44.841773-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.2","title":"Git Layer: Git integration abstraction for document discovery and change detection","description":"Abstract git operations behind a trait for testing. Implement document discovery and change detection.\n\n## Depends On\n- Foundation feature (for error types, logging)\n\n## Exports\n- `GitOps` trait for dependency injection\n- `RealGit` production implementation\n- `ModifiedFiles` detection for reconciliation\n- Repository edge case detection and handling\n\n## Design References\n- @rules_engine/docs/lattice/appendix_git_integration.md\n- @rules_engine/docs/lattice/appendix_git_edge_cases.md\n- @rules_engine/docs/lattice/appendix_file_layout.md (git/ section)\n\n## Files\nAll implementation in `rules_engine/src/lattice/src/git/`:\n- `mod.rs` - Module declarations only\n- `git_ops.rs` - GitOps trait definition\n- `real_git.rs` - Production implementation (shells out to git)\n- `modified_files.rs` - Change detection via git diff/status\n- `repo_detection.rs` - Detect repo configuration (shallow, sparse, etc.)\n- `edge_cases.rs` - Handling for worktrees, submodules, bare repos\n- `conflict_detection.rs` - Detect merge conflicts, in-progress operations\n","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2026-01-16T12:52:42.229577-08:00","created_by":"dthurn","updated_at":"2026-01-16T14:06:05.277892-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.2","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-16T12:52:42.231066-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.2.1","title":"GitOps Trait Definition","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nDefine the `GitOps` trait that abstracts all git operations for dependency injection.\n\n## Implementation\n**File:** `rules_engine/src/lattice/src/git/git_ops.rs`\n\n## Trait Methods\nDefine trait with methods:\n- `ls_files(pattern: \u0026str)` - List tracked files matching pattern\n- `diff(from_commit: \u0026str, to_commit: \u0026str, pattern: \u0026str)` - Files changed between commits\n- `status(pattern: \u0026str)` - Uncommitted changes (staged and unstaged)\n- `rev_parse(ref: \u0026str)` - Resolve ref to commit hash (e.g., HEAD)\n- `log(path: Option\u003c\u0026str\u003e, format: \u0026str, limit: usize)` - Commit history\n- `config_get(key: \u0026str)` - Read git config value\n\n## Requirements\n- All methods return `Result\u003cT, LatticeError\u003e`\n- Trait must be object-safe for dependency injection\n- Error handling via `LatticeError::GitError` variant (from Foundation)\n- Methods should accept pathspec patterns (e.g., `*.md`)\n\n## Design References\n- @rules_engine/docs/lattice/appendix_git_integration.md (Required Git Operations section)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:53:11.371391-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:42.155328-08:00","closed_at":"2026-01-16T13:06:53.059212-08:00","close_reason":"Implemented GitOps trait with ls_files, diff, status, rev_parse, log, and config_get methods. Added FileStatus struct with helper methods. Tests added for FileStatus behavior.","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.2.1","depends_on_id":"dr-epv.2","type":"parent-child","created_at":"2026-01-16T12:53:11.372175-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.2.2","title":"RealGit Implementation","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the `GitOps` trait by shelling out to the git CLI.\n\n## Implementation\n**File:** `rules_engine/src/lattice/src/git/real_git.rs`\n\n## Functionality\n- Implement all `GitOps` trait methods\n- Shell out to git CLI for each operation\n- Parse git command output into structured data\n- Handle git errors and convert to `LatticeError::GitError`\n\n## Git Commands to Wrap\n- `git ls-files '\u003cpattern\u003e'` - Document discovery\n- `git diff --name-only \u003ccommit\u003e..HEAD -- '\u003cpattern\u003e'` - Change detection\n- `git status --porcelain -- '\u003cpattern\u003e'` - Uncommitted changes\n- `git rev-parse \u003cref\u003e` - Resolve references\n- `git log -\u003cn\u003e --format='\u003cformat\u003e' -- \u003cpath\u003e` - Commit history\n- `git config --get \u003ckey\u003e` - Configuration values\n\n## Error Handling\n- Parse git stderr for meaningful error messages\n- Distinguish between \"command failed\" vs \"git error\"\n- Log all git commands and their results via tracing\n\n## Design References\n- @rules_engine/docs/lattice/appendix_git_integration.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:53:12.581312-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:42.234925-08:00","closed_at":"2026-01-16T13:46:31.89809-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.2.2","depends_on_id":"dr-epv.2","type":"parent-child","created_at":"2026-01-16T12:53:12.582001-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.2.2","depends_on_id":"dr-epv.2.1","type":"blocks","created_at":"2026-01-16T12:53:22.929641-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.2.3","title":"Document Discovery via Git","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement document discovery and change detection functions using GitOps trait.\n\n## Implementation\n**File:** `rules_engine/src/lattice/src/git/modified_files.rs`\n\n## Core Functions\n\n### Full Document Enumeration\n- `list_all_documents(git: \u0026dyn GitOps) -\u003e Result\u003cVec\u003cPathBuf\u003e\u003e`\n- Uses `git ls-files '*.md'`\n- Returns all tracked markdown files\n- Excludes gitignored files automatically\n\n### Change Detection (Committed)\n- `list_changed_documents(git: \u0026dyn GitOps, since_commit: \u0026str) -\u003e Result\u003cVec\u003cPathBuf\u003e\u003e`\n- Uses `git diff --name-only \u003ccommit\u003e..HEAD -- '*.md'`\n- Returns files modified since a specific commit\n- Used for incremental reconciliation\n\n### Change Detection (Uncommitted)\n- `list_uncommitted_changes(git: \u0026dyn GitOps) -\u003e Result\u003cVec\u003cPathBuf\u003e\u003e`\n- Uses `git status --porcelain -- '*.md'`\n- Returns staged and unstaged modifications\n- Parse porcelain output to extract paths\n\n## Requirements\n- Return `Vec\u003cPathBuf\u003e` for all operations\n- Handle pathspec filtering consistently\n- Log document counts at debug level\n\n## Design References\n- @rules_engine/docs/lattice/appendix_git_integration.md (Document Discovery section)\n- @rules_engine/docs/lattice/appendix_indexing.md (Reconciliation section)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:53:14.797303-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:45:23.814843-08:00","closed_at":"2026-01-16T15:45:23.814845-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.2.3","depends_on_id":"dr-epv.2","type":"parent-child","created_at":"2026-01-16T12:53:14.797978-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.2.3","depends_on_id":"dr-epv.2.2","type":"blocks","created_at":"2026-01-16T12:53:23.713987-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.2.4","title":"Repository Edge Case Detection","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nDetect and handle non-standard git repository configurations.\n\n## Implementation Files\n- `rules_engine/src/lattice/src/git/repo_detection.rs` - Configuration detection\n- `rules_engine/src/lattice/src/git/edge_cases.rs` - Edge case handling logic\n- `rules_engine/src/lattice/src/git/conflict_detection.rs` - In-progress git operations\n\n## Detection Functions (repo_detection.rs)\n\n### Repository Configuration Struct\nDefine `RepoConfig` with detected state:\n- `is_shallow: bool` - Shallow clone\n- `is_partial: bool` - Partial clone (blobless/treeless)\n- `partial_filter: Option\u003cString\u003e` - Filter specification\n- `is_sparse: bool` - Sparse checkout enabled\n- `is_worktree: bool` - Is a worktree (not main repo)\n- `main_git_dir: PathBuf` - Path to main .git directory\n- `has_submodules: bool` - Submodules present\n- `is_bare: bool` - Bare repository (not supported)\n- `in_progress_op: Option\u003cGitOp\u003e` - Rebase/merge/cherry-pick in progress\n\n### Detection Methods\n- Check `.git/shallow` for shallow clones\n- Check `git config --get remote.origin.promisor` for partial clones\n- Check `git config --get core.sparseCheckout` for sparse checkout\n- Check if `.git` is file vs directory for worktrees\n- Check `.gitmodules` for submodules\n- Check `.git/MERGE_HEAD`, `.git/rebase-merge`, etc. for in-progress ops\n\n## Cache Management\n- Cache detection results in `.lattice/repo_config.json`\n- Invalidate when `.git` directory mtime changes\n- Re-detect on cache miss or invalidation\n\n## Conflict Detection (conflict_detection.rs)\n- `has_conflict_markers(content: \u0026str) -\u003e bool`\n- Detect `\u003c\u003c\u003c\u003c\u003c\u003c\u003c`, `=======`, `\u003e\u003e\u003e\u003e\u003e\u003e\u003e` in file content\n- Used during document parsing to skip conflicted files\n\n## Design References\n- @rules_engine/docs/lattice/appendix_git_edge_cases.md (comprehensive)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:53:16.010009-08:00","created_by":"dthurn","updated_at":"2026-01-16T19:48:14.836498-08:00","closed_at":"2026-01-16T19:48:14.836498-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.2.4","depends_on_id":"dr-epv.2","type":"parent-child","created_at":"2026-01-16T12:53:16.01071-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.2.4","depends_on_id":"dr-epv.2.3","type":"blocks","created_at":"2026-01-16T12:53:24.596331-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.3","title":"Document Model: Parse and serialize Lattice documents with frontmatter validation","description":"## Goal\n\nParse and serialize Lattice documents, validate frontmatter fields, and provide document I/O utilities.\n\n## Depends On\n\n- Foundation (dr-epv.1) - for LatticeId types, LatticeError types\n\n## Exports\n\n- `Document` struct with frontmatter and body\n- `Frontmatter` struct with all fields\n- Parse/serialize functions\n- Field validation\n\n## Files\n\nAll files in `rules_engine/src/lattice/src/document/`:\n- `mod.rs` - Module declarations only\n- `frontmatter_schema.rs` - Field definitions, allowed keys\n- `frontmatter_parser.rs` - YAML extraction and parsing\n- `field_validation.rs` - Type checking, value validation\n- `document_reader.rs` - Load and parse complete documents\n- `document_writer.rs` - Serialize documents back to files\n- `markdown_body.rs` - Body content handling\n\n## Design Reference\n\n- Main design: @rules_engine/docs/lattice/lattice_design.md#document-structure\n- Task tracking: @rules_engine/docs/lattice/appendix_task_tracking.md\n- File layout: @rules_engine/docs/lattice/appendix_file_layout.md\n","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2026-01-16T12:57:54.738438-08:00","created_by":"dthurn","updated_at":"2026-01-16T14:06:05.368101-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.3","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-16T12:57:54.739206-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.3.1","title":"Frontmatter Schema Definition","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n## Goal\n\nDefine all frontmatter fields as a typed Rust struct for Lattice documents.\n\n## File\n\n`rules_engine/src/lattice/src/document/frontmatter_schema.rs`\n\n## Implementation\n\nDefine `Frontmatter` struct with all fields:\n\n**Required fields (all documents):**\n- `lattice-id`: LatticeId - unique document identifier\n- `name`: String - lowercase-hyphen format, derived from filename, max 64 chars\n- `description`: String - human-readable summary, max 1024 chars\n\n**Optional identity fields:**\n- `parent-id`: Option\u003cLatticeId\u003e - ID of parent document, auto-populated from directory root\n\n**Task tracking fields (tasks only):**\n- `task-type`: Option\u003cTaskType\u003e - bug/feature/task/chore\n- `priority`: Option\u003cu8\u003e - 0-4 (0 highest)\n- `labels`: Vec\u003cString\u003e - arbitrary string labels\n- `blocking`: Vec\u003cLatticeId\u003e - tasks with hard dependencies on this task\n- `blocked-by`: Vec\u003cLatticeId\u003e - tasks this task depends on\n- `discovered-from`: Vec\u003cLatticeId\u003e - parent tasks from which this was discovered\n\n**Timestamp fields:**\n- `created-at`: Option\u003cDateTime\u003e - ISO 8601\n- `updated-at`: Option\u003cDateTime\u003e - ISO 8601\n- `closed-at`: Option\u003cDateTime\u003e - ISO 8601\n\n**Skill integration:**\n- `skill`: bool - enables Claude Skill generation\n\n## Design Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#yaml-frontmatter\n- @rules_engine/docs/lattice/appendix_task_tracking.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:58:24.428469-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:42.475921-08:00","closed_at":"2026-01-16T13:08:28.266736-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.3.1","depends_on_id":"dr-epv.3","type":"parent-child","created_at":"2026-01-16T12:58:24.429251-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.3.2","title":"Frontmatter Parser","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n## Goal\n\nExtract and parse YAML frontmatter from markdown documents into the Frontmatter struct.\n\n## File\n\n`rules_engine/src/lattice/src/document/frontmatter_parser.rs`\n\n## Implementation\n\n- Extract YAML content between `---` markers at document start\n- Use `serde_yaml` crate for deserialization into Frontmatter struct\n- Return `LatticeError::InvalidFrontmatter` on parse failure with clear error message\n- Handle and reject unknown/invalid keys (linter rule E003)\n- Preserve original YAML for round-tripping when possible\n\n## Edge Cases\n\n- Missing opening/closing `---` markers\n- Empty frontmatter\n- Malformed YAML syntax\n- Unknown keys that don't map to Frontmatter fields\n- Missing required fields (lattice-id, name, description)\n\n## Design Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#yaml-frontmatter\n- @rules_engine/docs/lattice/appendix_error_handling.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:58:25.245589-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:22:42.552719-08:00","closed_at":"2026-01-16T14:00:21.428941-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.3.2","depends_on_id":"dr-epv.3","type":"parent-child","created_at":"2026-01-16T12:58:25.246286-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.3.2","depends_on_id":"dr-epv.3.1","type":"blocks","created_at":"2026-01-16T12:58:35.59448-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.3.3","title":"Field Validation","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n## Goal\n\nValidate frontmatter field values for type correctness and semantic constraints.\n\n## File\n\n`rules_engine/src/lattice/src/document/field_validation.rs`\n\n## Validation Rules\n\n**name field:**\n- Format: lowercase letters, hyphens only (derived from filename)\n- Max length: 64 characters\n- Must match filename (underscores→hyphens, no .md extension)\n- Linter rule E008 for mismatches\n\n**description field:**\n- Non-empty string required\n- Max length: 1024 characters\n\n**priority field:**\n- Integer 0-4 only (0=critical, 4=backlog)\n- Required for tasks (documents with task-type)\n\n**task-type field:**\n- Enum: bug, feature, task, chore\n- Case-insensitive parsing\n\n**ID references (blocking, blocked-by, discovered-from):**\n- Each entry must be valid LatticeId format\n- Cross-reference validation deferred to linter (needs index)\n\n**Timestamps:**\n- ISO 8601 format validation\n\n## Error Handling\n\n- Return specific validation errors with field name and reason\n- Support batch validation (collect all errors, not just first)\n\n## Design Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#yaml-frontmatter\n- @rules_engine/docs/lattice/appendix_linter.md (rules E003-E010)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:58:27.034061-08:00","created_by":"dthurn","updated_at":"2026-01-16T15:45:39.35586-08:00","closed_at":"2026-01-16T15:45:39.355863-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.3.3","depends_on_id":"dr-epv.3","type":"parent-child","created_at":"2026-01-16T12:58:27.034771-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.3.3","depends_on_id":"dr-epv.3.2","type":"blocks","created_at":"2026-01-16T12:58:36.295544-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.3.4","title":"Document Reader and Writer","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\n## Goal\n\nProvide document I/O operations for reading and writing Lattice documents.\n\n## Files\n\n- `rules_engine/src/lattice/src/document/document_reader.rs` - loading documents\n- `rules_engine/src/lattice/src/document/document_writer.rs` - serializing documents\n- `rules_engine/src/lattice/src/document/markdown_body.rs` - body content utilities\n\n## Document Reader\n\n- Read complete document from filesystem path\n- Split content into frontmatter (YAML) and body (markdown)\n- Parse frontmatter using frontmatter_parser module\n- Return `Document` struct with both components\n- Handle encoding (UTF-8 with BOM detection)\n\n## Document Writer\n\n- Serialize `Document` struct back to file\n- Format: frontmatter YAML + `---` separator + body content\n- **Atomic write**: write to temp file, then rename (prevents corruption)\n- Preserve body content exactly (no reformatting unless explicitly requested)\n- Update `updated-at` timestamp on write\n\n## Markdown Body Utilities\n\n- Extract body content (everything after frontmatter)\n- Utilities for appending content to body\n- Line counting for 500-line soft limit checks\n- Content manipulation helpers for `lat split` command\n\n## Design Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#document-structure\n- @rules_engine/docs/lattice/appendix_file_layout.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T12:58:27.846951-08:00","created_by":"dthurn","updated_at":"2026-01-16T19:43:56.105151-08:00","closed_at":"2026-01-16T19:43:56.105151-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.3.4","depends_on_id":"dr-epv.3","type":"parent-child","created_at":"2026-01-16T12:58:27.847627-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.3.4","depends_on_id":"dr-epv.3.3","type":"blocks","created_at":"2026-01-16T12:58:37.182523-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4","title":"Index Core: SQLite schema, connection management, and core queries","description":"SQLite schema, connection management, and core queries for the Lattice index.\nThe index serves as a performance cache for document metadata - git remains\nthe source of truth, and any index state can be safely deleted and rebuilt.\n\n## Scope\n\n- Schema definition for all tables (documents, links, labels, views, etc.)\n- Connection pool with WAL mode and optimized PRAGMA settings\n- Document CRUD operations and filter queries\n- Link queries (outgoing, incoming, bidirectional)\n- Label queries and management\n- Full-text search via FTS5\n- View tracking for `lat overview` ranking\n- Content cache (L2) for frequently accessed documents\n\n## Key Design Principles\n\n- Index is ephemeral - can always be rebuilt from git\n- WAL mode for concurrent readers/writers\n- Trigger-maintained denormalized counts for query performance\n- FTS5 with external content mode (no duplicate storage)\n\n## References\n\n- Schema: @rules_engine/docs/lattice/appendix_indexing.md\n- File layout: @rules_engine/docs/lattice/appendix_file_layout.md\n- Implementation plan: @rules_engine/docs/lattice/lattice_implementation_plan.md","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2026-01-16T21:01:36.053704-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:01:48.593077-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-16T21:01:36.05484-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4.1","title":"Schema Definition: SQLite table definitions and triggers","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nDefine SQLite schema for the Lattice index in `schema_definition.rs`.\n\n## Tables to Define\n\n- `documents`: Core document metadata (id, path, name, description, task_type,\n  priority, timestamps, computed flags like is_closed, is_root, in_tasks_dir)\n- `links`: Source-to-target relationships with type (body/frontmatter)\n- `labels`: Document-to-label associations\n- `index_metadata`: Single-row table for schema_version, last_commit, last_indexed\n- `client_counters`: Per-client document counter (client_id PK, next_counter)\n- `directory_roots`: Precomputed hierarchy for template composition\n- `content_cache`: L2 body content cache with mtime validation\n- `views`: View counts and last-viewed timestamps\n\n## Triggers\n\n- Maintain denormalized `link_count` and `backlink_count` on documents table\n- Maintain `view_count` denormalization from views to documents table\n- Keep FTS5 index in sync via insert/update/delete triggers\n\n## FTS5 Configuration\n\n- External content mode (no duplicate storage)\n- Configure `automerge=4` for automatic segment merging\n\n## Indices\n\n- documents: path (unique), name\n- links: source_id, target_id\n- labels: document_id, label\n\n## References\n\n- Schema details: @rules_engine/docs/lattice/appendix_indexing.md#schema\n- File: @rules_engine/src/lattice/src/index/schema_definition.rs\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T21:02:53.11199-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:51:58.156416-08:00","closed_at":"2026-01-16T21:51:58.156416-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4.1","depends_on_id":"dr-epv.4","type":"parent-child","created_at":"2026-01-16T21:02:53.112754-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4.2","title":"Connection Pool: SQLite connection handling with WAL mode","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement SQLite connection management in `connection_pool.rs`.\n\n## Connection Setup\n\nOn every connection open, execute:\n- `PRAGMA journal_mode = WAL`\n- `PRAGMA synchronous = NORMAL`\n- `PRAGMA temp_store = MEMORY`\n- `PRAGMA mmap_size = 268435456` (256MB)\n- `PRAGMA busy_timeout = 5000`\n\n## Connection Lifecycle\n\n- Run `PRAGMA optimize` before closing connections\n- After bulk operations: `PRAGMA wal_checkpoint(TRUNCATE)`\n- Index location: `.lattice/index.sqlite` (gitignored)\n\n## Performance Notes\n\n- WAL mode: concurrent readers/writers, 30-60% faster commits\n- Synchronous NORMAL: safe with WAL, acceptable for rebuildable cache\n- Memory-mapped I/O: set mmap_size to expected index size\n- Disable mmap on network filesystems (set to 0)\n\n## Target Performance\n\n- Connection open + configure: \u003c5ms\n- Document lookup by ID: \u003c1ms\n\n## References\n\n- SQLite config: @rules_engine/docs/lattice/appendix_indexing.md#sqlite-configuration\n- File: @rules_engine/src/lattice/src/index/connection_pool.rs\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T21:02:54.325587-08:00","created_by":"dthurn","updated_at":"2026-01-16T22:13:21.041398-08:00","closed_at":"2026-01-16T22:13:21.041398-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4.2","depends_on_id":"dr-epv.4","type":"parent-child","created_at":"2026-01-16T21:02:54.326312-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.4.2","depends_on_id":"dr-epv.4.1","type":"blocks","created_at":"2026-01-16T21:03:21.561797-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4.3","title":"Document Queries: CRUD operations and filter queries","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement document CRUD operations in `document_queries.rs`.\n\n## Core Operations\n\n- Insert document (from parsed Document struct)\n- Update document metadata\n- Delete document by ID\n- Lookup by ID, path, or name\n\n## Filter Queries\n\nBuild SQL queries supporting filters for:\n- State: open, blocked, closed (via is_closed flag)\n- Priority: 0-4\n- Task type: bug, feature, task, chore\n- Labels (AND/OR semantics)\n- Path prefix (for directory-scoped queries)\n- Timestamp ranges (created_at, updated_at, closed_at)\n- Root documents only (is_root = 1)\n- Directory type (in_tasks_dir, in_docs_dir)\n\n## Batch Operations\n\n- Insert multiple documents in single transaction\n- Update multiple documents atomically\n- Delete documents by ID list or path prefix\n\n## Query Building\n\n- Support `--include-closed` flag (default excludes closed)\n- Support sorting by various columns\n- Support limit and offset for pagination\n\n## References\n\n- Schema: @rules_engine/docs/lattice/appendix_indexing.md#documents\n- File: @rules_engine/src/lattice/src/index/document_queries.rs\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T21:02:55.510273-08:00","created_by":"dthurn","updated_at":"2026-01-17T05:36:40.889458-08:00","closed_at":"2026-01-17T05:36:40.889458-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4.3","depends_on_id":"dr-epv.4","type":"parent-child","created_at":"2026-01-16T21:02:55.510968-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.4.3","depends_on_id":"dr-epv.4.2","type":"blocks","created_at":"2026-01-16T21:03:22.644129-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4.4","title":"Link Queries: Bidirectional link tracking","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement link table queries in `link_queries.rs`.\n\n## Core Operations\n\n- Insert links for a document (batch operation for efficiency)\n- Delete all links from a document (for re-indexing)\n- Delete specific link by source + target\n\n## Query Operations\n\n- **Outgoing links** (links-from): Query links where source_id = document\n- **Incoming links** (links-to/backlinks): Query links where target_id = document\n- Filter by link_type ('body' or 'frontmatter')\n- Include position for ordering (links appear in document order)\n\n## Link Metadata\n\nEach link record contains:\n- source_id: Lattice ID of linking document\n- target_id: Lattice ID of linked document\n- link_type: 'body' or 'frontmatter'\n- position: Order of appearance in source document\n\n## Usage by Commands\n\n- `lat links-from \u003cid\u003e`: Show outgoing links\n- `lat links-to \u003cid\u003e`: Show incoming links (backlinks)\n- `lat impact \u003cid\u003e`: Recursive backlink traversal\n- `lat orphans`: Documents with zero incoming links\n\n## References\n\n- Schema: @rules_engine/docs/lattice/appendix_indexing.md#links\n- Linking system: @rules_engine/docs/lattice/appendix_linking_system.md\n- File: @rules_engine/src/lattice/src/index/link_queries.rs\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T21:02:57.098044-08:00","created_by":"dthurn","updated_at":"2026-01-17T07:01:14.703203-08:00","closed_at":"2026-01-17T07:01:14.703203-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4.4","depends_on_id":"dr-epv.4","type":"parent-child","created_at":"2026-01-16T21:02:57.098781-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.4.4","depends_on_id":"dr-epv.4.3","type":"blocks","created_at":"2026-01-16T21:03:23.647472-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4.5","title":"Label Queries: Label management and queries","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement label queries in `label_queries.rs`.\n\n## Core Operations\n\n- Add label to document\n- Remove label from document\n- Check if document has label\n- Get all labels for a document\n\n## Query Operations\n\n- Find documents by label (single label)\n- Find documents by labels (AND semantics: all labels required)\n- Find documents by labels (OR semantics: any label matches)\n- List all unique labels in repository with counts\n\n## Batch Operations\n\n- Add label to multiple documents\n- Remove label from multiple documents\n- Sync all labels for a document (replace existing with new set)\n\n## Index Support\n\n- Index on (document_id, label) for fast document lookup\n- Index on (label, document_id) for fast label searches\n\n## Usage by Commands\n\n- `lat label add \u003cid\u003e \u003clabel\u003e`: Add label to document\n- `lat label remove \u003cid\u003e \u003clabel\u003e`: Remove label from document\n- `lat label list \u003cid\u003e`: Show labels on document\n- `lat label list-all`: Show all labels with counts\n- `lat list --label=X`: Filter by label\n\n## References\n\n- Schema: @rules_engine/docs/lattice/appendix_indexing.md#labels\n- File: @rules_engine/src/lattice/src/index/label_queries.rs\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T21:02:58.297841-08:00","created_by":"dthurn","updated_at":"2026-01-17T07:22:00.168512-08:00","closed_at":"2026-01-17T07:22:00.168512-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4.5","depends_on_id":"dr-epv.4","type":"parent-child","created_at":"2026-01-16T21:02:58.298995-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.4.5","depends_on_id":"dr-epv.4.4","type":"blocks","created_at":"2026-01-16T21:03:24.742209-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4.6","title":"Full-Text Search: FTS5 configuration and search","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement full-text search via FTS5 in `fulltext_search.rs`.\n\n## FTS5 Configuration\n\n- External content mode (no duplicate storage)\n- Virtual table: `fts_content` with document_id and body columns\n- content='documents', content_rowid='rowid'\n- automerge=4 for automatic segment merging\n\n## Sync Mechanisms\n\n- Triggers keep FTS in sync with document changes\n- After full rebuild: `INSERT INTO fts_content(fts_content) VALUES('optimize')`\n\n## Search Operations\n\n- Execute FTS5 queries with standard syntax\n- Support query types: word, phrase, AND, OR, NOT, prefix, NEAR\n- Return results with relevance ranking (BM25)\n- Extract snippets around matching terms\n\n## Query Syntax Support\n\n| Syntax | Example | Matches |\n|--------|---------|---------|\n| Word | `error` | Documents containing \"error\" |\n| Phrase | `\"login bug\"` | Exact phrase |\n| AND | `error AND login` | Both terms |\n| OR | `error OR warning` | Either term |\n| NOT | `error NOT test` | First without second |\n| Prefix | `auth*` | Words starting with \"auth\" |\n| NEAR | `NEAR(error login, 5)` | Terms within 5 words |\n\n## Performance Targets\n\n- Simple FTS search: \u003c20ms\n- Complex FTS search: \u003c50ms\n\n## References\n\n- FTS5 details: @rules_engine/docs/lattice/appendix_indexing.md#full-text-search\n- File: @rules_engine/src/lattice/src/index/fulltext_search.rs\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T21:02:59.506311-08:00","created_by":"dthurn","updated_at":"2026-01-17T08:22:10.138219-08:00","closed_at":"2026-01-17T08:22:10.138219-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4.6","depends_on_id":"dr-epv.4","type":"parent-child","created_at":"2026-01-16T21:02:59.507017-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.4.6","depends_on_id":"dr-epv.4.5","type":"blocks","created_at":"2026-01-16T21:03:25.778185-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4.7","title":"View Tracking: Document view counts for overview ranking","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement view tracking in `view_tracking.rs`.\n\n## Views Table\n\n| Column | Type | Description |\n|--------|------|-------------|\n| document_id | TEXT PK | Lattice ID |\n| view_count | INTEGER | Total views |\n| last_viewed | TEXT | ISO 8601 timestamp |\n\n## Core Operations\n\n- Record view on `lat show` command\n- Query view count for document\n- Query last-viewed timestamp\n- Reset view counts (via `lat overview --reset-views`)\n\n## Denormalization\n\n- `documents.view_count` is denormalized copy of `views.view_count`\n- Maintained by trigger for query performance\n- Allows `lat overview` ranking without table joins\n- `views` table is source of truth\n\n## Concurrency\n\n- SQLite WAL mode handles concurrent reads/writes\n- View recording is transactional\n- Multiple `lat show` commands can run simultaneously\n\n## Usage by Commands\n\n- `lat show \u003cid\u003e`: Records view, increments count\n- `lat overview`: Ranks documents by view frequency + recency\n- `lat overview --reset-views`: Clears all view data\n\n## References\n\n- Views schema: @rules_engine/docs/lattice/appendix_indexing.md#views\n- Overview ranking: @rules_engine/docs/lattice/appendix_overview_command.md\n- File: @rules_engine/src/lattice/src/index/view_tracking.rs\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T21:03:01.723575-08:00","created_by":"dthurn","updated_at":"2026-01-17T08:59:10.816553-08:00","closed_at":"2026-01-17T08:59:10.816553-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4.7","depends_on_id":"dr-epv.4","type":"parent-child","created_at":"2026-01-16T21:03:01.724255-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.4.7","depends_on_id":"dr-epv.4.6","type":"blocks","created_at":"2026-01-16T21:03:26.678646-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.4.8","title":"Content Cache: L2 cache for document body content","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement L2 content cache in `content_cache.rs`.\n\n## Purpose\n\nL2 cache for document body content, reducing filesystem reads for frequently\naccessed documents. L1 cache is the OS filesystem cache; this provides an\nadditional layer within SQLite.\n\n## Content Cache Table\n\n| Column | Type | Description |\n|--------|------|-------------|\n| document_id | TEXT PK | Lattice ID |\n| content | TEXT | Full document body |\n| content_hash | TEXT | SHA-256 for invalidation |\n| accessed_at | TEXT | Last access timestamp |\n| file_mtime | INTEGER | File mtime at cache time |\n\n## Cache Policy\n\n- Validate entries by comparing `file_mtime` against current filesystem mtime\n- Stale entries are refreshed on access (read-through cache)\n- Evict least-recently-accessed entries when cache exceeds 100 documents\n- Cache hit avoids syscall overhead for hot documents\n\n## Core Operations\n\n- Get cached content (with mtime validation)\n- Put content in cache\n- Invalidate specific document\n- Eviction sweep (remove oldest entries over limit)\n- Clear entire cache\n\n## Usage by Commands\n\n- `lat show`: Avoids repeated file reads for multiple documents\n- `lat search`: Result snippets without reading entire files\n- Template composition: Caches ancestor document content\n\n## References\n\n- Content cache schema: @rules_engine/docs/lattice/appendix_indexing.md#content_cache\n- File: @rules_engine/src/lattice/src/index/content_cache.rs\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T21:03:02.934354-08:00","created_by":"dthurn","updated_at":"2026-01-17T11:47:08.004206-08:00","closed_at":"2026-01-17T11:47:08.004206-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.4.8","depends_on_id":"dr-epv.4","type":"parent-child","created_at":"2026-01-16T21:03:02.935131-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.4.8","depends_on_id":"dr-epv.4.7","type":"blocks","created_at":"2026-01-16T21:03:27.369844-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.5","title":"CLI Framework: Argument parsing, command dispatch, output formatting","description":"Implement the CLI framework layer for Lattice: argument parsing, command dispatch, output formatting, and color theme.\n\n## Scope\n\n- **Argument Parser**: Clap-based command definitions for all `lat` subcommands\n- **Command Dispatch**: Route parsed arguments to command implementations with startup operations hook\n- **Output Formatting**: Text/JSON/pretty output helpers with consistent document reference format\n- **Color Theme**: Ayu color palette with terminal detection and semantic coloring\n\n## Status\n\n- C5 (Global Options) is already implemented in `@rules_engine/src/lattice/src/cli/global_options.rs`\n- Files exist as stubs for C1-C4; implementation needed\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/lattice_design.md#command-overview\n- @rules_engine/docs/lattice/appendix_cli_structure.md\n- @rules_engine/docs/lattice/appendix_file_layout.md (cli/ section)\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/argument_parser.rs`\n- `@rules_engine/src/lattice/src/cli/command_dispatch.rs`\n- `@rules_engine/src/lattice/src/cli/output_format.rs`\n- `@rules_engine/src/lattice/src/cli/color_theme.rs`","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-16T21:12:08.469508-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:12:59.086382-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.5","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-16T21:12:08.470348-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.5.1","title":"Color Theme: Ayu palette with terminal detection","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the Ayu color theme for Lattice CLI output.\n\n## Scope\n\n- Define Ayu color palette constants:\n  - Green for success states\n  - Yellow for warnings\n  - Red for errors\n  - Blue for accent/highlighting\n  - Gray for muted/secondary text\n- Implement terminal detection for color support\n- Support `LATTICE_NO_COLOR` environment variable\n- Create semantic coloring functions for common output patterns\n\n## Implementation Notes\n\n- Use a crate like `termcolor` or `owo-colors` for cross-platform terminal colors\n- Detect TTY vs piped output to disable colors when not interactive\n- Provide fallback for terminals without color support\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/lattice_design.md#ui-design\n- @rules_engine/docs/lattice/appendix_cli_structure.md#environment-variables\n\n## File\n\n- `@rules_engine/src/lattice/src/cli/color_theme.rs`\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:12:19.434267-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:52:02.526051-08:00","closed_at":"2026-01-16T21:52:02.526051-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.5.1","depends_on_id":"dr-epv.5","type":"parent-child","created_at":"2026-01-16T21:12:19.43501-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.5.2","title":"Output Formatting: Text, JSON, and pretty formatters","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement text, JSON, and pretty output formatters for Lattice CLI.\n\n## Scope\n\n- **Text Formatter**: Human-readable plain text output\n- **JSON Formatter**: Structured serde serialization for `--json` mode\n- **Pretty Formatter**: Visual trees and colored output using color theme\n- Consistent document reference format: `\u003cid\u003e: \u003cname\u003e - \u003cdescription\u003e [\u003ctype\u003e]`\n\n## Implementation Notes\n\n- Create an `OutputFormat` enum or trait to abstract formatting\n- JSON output should use serde_json with consistent field naming\n- Pretty formatter should use Unicode box-drawing characters for trees\n- Handle long descriptions with truncation and ellipsis\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/appendix_cli_structure.md (output format examples)\n- @rules_engine/docs/lattice/appendix_workflow.md (lat show output format)\n\n## Dependencies\n\n- Uses color theme from `@rules_engine/src/lattice/src/cli/color_theme.rs`\n\n## File\n\n- `@rules_engine/src/lattice/src/cli/output_format.rs`\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:12:29.097259-08:00","created_by":"dthurn","updated_at":"2026-01-16T22:11:15.803529-08:00","closed_at":"2026-01-16T22:11:15.803529-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.5.2","depends_on_id":"dr-epv.5","type":"parent-child","created_at":"2026-01-16T21:12:29.097934-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.5.2","depends_on_id":"dr-epv.5.1","type":"blocks","created_at":"2026-01-16T21:12:29.099097-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.5.3","title":"Argument Parser: Clap definitions for all lat subcommands","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement Clap-based argument parsing for all `lat` subcommands.\n\n## Scope\n\n- Define main `Lat` CLI struct with Clap derive macros\n- Define all subcommands with their arguments per CLI spec\n- Set up global options: `--json`, `--verbose`, `--quiet`, `--help`, `--version`\n- Configure environment variable bindings (`LATTICE_LOG_LEVEL`, etc.)\n\n## Subcommands to Define\n\nshow, create, update, close, reopen, prune, list, ready, search, stale, blocked, changes, stats, tree, roots, children, dep, label, links-from, links-to, path, orphans, impact, claim, overview, prime, track, generate-ids, split, mv, edit, fmt, check, doctor, setup, completion, chaosmonkey\n\n## Implementation Notes\n\n- Use Clap's derive API (`Parser`, `Subcommand`, `Args`)\n- Flatten `GlobalOptions` into each command\n- Group related arguments (e.g., filter options as a shared Args struct)\n- Add help text and examples for each command\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/appendix_cli_structure.md (complete command list)\n- @rules_engine/docs/lattice/lattice_design.md#command-overview\n\n## File\n\n- `@rules_engine/src/lattice/src/cli/argument_parser.rs`\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:12:40.473035-08:00","created_by":"dthurn","updated_at":"2026-01-16T23:19:45.049477-08:00","closed_at":"2026-01-16T23:19:45.049477-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.5.3","depends_on_id":"dr-epv.5","type":"parent-child","created_at":"2026-01-16T21:12:40.473786-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.5.3","depends_on_id":"dr-epv.5.2","type":"blocks","created_at":"2026-01-16T21:12:40.475036-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.5.4","title":"Command Dispatch: Route commands with startup operations hook","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement command dispatch to route parsed arguments to handler functions.\n\n## Scope\n\n- Match parsed commands to handler functions\n- Thread context (GitOps, Index) through handlers\n- Implement startup operations hook (runs before each command)\n- Map results to exit codes per error handling spec\n- Implement hidden `--no-startup` flag for debugging\n\n## Startup Operations Hook\n\nPer @rules_engine/docs/lattice/appendix_startup_operations.md:\n- Index reconciliation\n- Skill symlink sync\n- Claim cleanup\n- Log rotation\n- Performance budget: \u003c100ms total; emit debug log if exceeded\n\n## Implementation Notes\n\n- Create a `CommandContext` struct holding shared state (GitOps, Index, Config)\n- Each command handler receives context and returns `LatticeResult\u003c()\u003e`\n- Convert `LatticeError` to appropriate exit codes\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/appendix_startup_operations.md\n- @rules_engine/docs/lattice/appendix_error_handling.md (exit codes)\n- @rules_engine/docs/lattice/appendix_cli_structure.md#exit-codes\n\n## File\n\n- `@rules_engine/src/lattice/src/cli/command_dispatch.rs`\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:12:49.510818-08:00","created_by":"dthurn","updated_at":"2026-01-17T07:29:39.852424-08:00","closed_at":"2026-01-17T07:29:39.852424-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.5.4","depends_on_id":"dr-epv.5","type":"parent-child","created_at":"2026-01-16T21:12:49.511586-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.5.4","depends_on_id":"dr-epv.5.3","type":"blocks","created_at":"2026-01-16T21:12:49.512869-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.6","title":"Index Core Additions","description":"Implement additional Index Core functionality discovered during post-implementation\nreview that supports Reconciliation and other features.\n\n## Scope\n\n- Index metadata query functions for reconciliation fast-path\n- Client counter management for ID generation\n- Directory roots hierarchy queries for template composition\n- Documentation for document types and filter modules\n- Update file layout appendix to include missing files\n\n## Dependencies\n\n- Requires completed Index Core feature (schema, connection, base queries)\n- Downstream features depend on these exports:\n  - Reconciliation uses index metadata queries (R4)\n  - ID generation uses client counters (F2)\n  - Template composition uses directory roots (TM1, TM3)\n\n## Reference Documentation\n\n- Design: @rules_engine/docs/lattice/lattice_design.md#index-architecture\n- Implementation: @rules_engine/docs/lattice/lattice_implementation_plan.md\n- Schema: @rules_engine/docs/lattice/appendix_indexing.md","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-17T12:04:38.414084-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:04:43.220153-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.6","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-17T12:04:38.417206-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.6.1","title":"Index Metadata Query Functions","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement query functions for the `index_metadata` table to support reconciliation\nfast-path checks and last-indexed tracking.\n\n## Implementation File\n\n`@rules_engine/src/lattice/src/index/index_metadata.rs`\n\n## Required Functions\n\n- `get_metadata()` - retrieve full IndexMetadata struct\n- `get_last_commit()` - get last indexed git commit hash\n- `get_last_indexed()` - get last indexed timestamp\n- `set_last_commit()` - update commit hash and touch timestamp\n- `touch_last_indexed()` - update timestamp only\n\n## Usage Context\n\n- Reconciliation coordinator uses these to detect if index is current\n- Fast-path check: compare HEAD vs last_commit\n- After successful reconciliation: update last_commit\n\n## Schema Reference\n\nSingle-row table per @rules_engine/docs/lattice/appendix_indexing.md:\n- schema_version, last_commit (git hash), last_indexed\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T12:05:16.317252-08:00","created_by":"dthurn","updated_at":"2026-01-17T13:32:24.588428-08:00","closed_at":"2026-01-17T13:32:24.588428-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.6.1","depends_on_id":"dr-epv.6","type":"parent-child","created_at":"2026-01-17T12:05:16.317972-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.6.2","title":"Client Counters Query Functions","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement query functions for the `client_counters` table to support ID generation\nwith per-client document counters.\n\n## Implementation File\n\n`@rules_engine/src/lattice/src/index/client_counters.rs`\n\n## Required Functions\n\n- `get_and_increment()` - atomic get-and-increment for ID generation\n- `get_counter()` - read current counter without incrementing\n- `set_counter()` - set counter value (for recovery)\n- `set_counter_if_higher()` - conditional set for counter recovery\n- `list_all()` - list all client counters\n- `delete()` - remove a client's counter\n\n## Usage Context\n\n- ID generator (F2) uses get_and_increment for new IDs\n- Counter recovery scans documents to find highest counter per client\n- Used when repo is re-cloned and counters need restoration\n\n## Schema Reference\n\nPer @rules_engine/docs/lattice/appendix_indexing.md:\n- client_id (PK), next_counter\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T12:05:17.780197-08:00","created_by":"dthurn","updated_at":"2026-01-17T13:59:14.950818-08:00","closed_at":"2026-01-17T13:59:14.950818-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.6.2","depends_on_id":"dr-epv.6","type":"parent-child","created_at":"2026-01-17T12:05:17.780909-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.6.2","depends_on_id":"dr-epv.6.1","type":"blocks","created_at":"2026-01-17T12:05:29.307389-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.6.3","title":"Directory Roots Hierarchy Queries","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement query functions for the `directory_roots` table to support template\ncomposition and hierarchy queries.\n\n## Implementation File\n\n`@rules_engine/src/lattice/src/index/directory_roots.rs`\n\n## Required Functions\n\n- `upsert()` - insert or update directory root entry\n- `get()` - get full DirectoryRoot entry\n- `get_root_id()` - get just the root document ID for a directory\n- `get_ancestors()` - get all ancestors ordered root-to-parent\n- `get_children()` - get immediate child directories\n- `list_at_depth()` - list all roots at a specific depth\n- `list_all()` - list all roots ordered by depth then path\n- `delete()` - remove a directory root entry\n- `clear_all()` - clear all entries (for full rebuild)\n\n## Usage Context\n\n- Template composer (TM1) walks ancestor chain for context inheritance\n- TM3 populates this table during reconciliation\n- Efficient hierarchy queries without filesystem traversal\n\n## Schema Reference\n\nPer @rules_engine/docs/lattice/appendix_indexing.md:\n- directory_path (PK), root_id, parent_path, depth\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T12:05:18.485266-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:05:51.896447-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.6.3","depends_on_id":"dr-epv.6","type":"parent-child","created_at":"2026-01-17T12:05:18.486001-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.6.3","depends_on_id":"dr-epv.6.2","type":"blocks","created_at":"2026-01-17T12:05:30.810291-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.6.4","title":"Document Types Documentation","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nAdd module documentation explaining the distinction between IndexedDocument and\nthe parsed Document type.\n\n## Implementation File\n\n`@rules_engine/src/lattice/src/index/document_types.rs`\n\n## Documentation Requirements\n\n- Module-level doc comment explaining purpose of file\n- Explain `IndexedDocument` as the cached metadata representation\n- Explain distinction from `Document` (parsed from filesystem)\n- Document when to use each type:\n  - IndexedDocument for queries that need metadata only\n  - Document for operations requiring body content or modification\n\n## File Layout Update\n\nAlso update @rules_engine/docs/lattice/appendix_file_layout.md to add\n`document_types.rs` to the index/ section with description:\n\"Index-specific document types distinct from parsed documents\"\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T12:05:19.690606-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:05:52.006426-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.6.4","depends_on_id":"dr-epv.6","type":"parent-child","created_at":"2026-01-17T12:05:19.69128-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.6.4","depends_on_id":"dr-epv.6.3","type":"blocks","created_at":"2026-01-17T12:05:31.495405-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.6.5","title":"Document Filter Documentation","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nAdd module documentation for the DocumentFilter builder pattern and available\nfilter criteria.\n\n## Implementation File\n\n`@rules_engine/src/lattice/src/index/document_filter.rs`\n\n## Documentation Requirements\n\n- Module-level doc comment explaining the builder pattern\n- Document `name_contains` filter for substring matching on document names\n- Document all available filter criteria:\n  - State filters (open, blocked, closed)\n  - Priority filters\n  - Type filters (task types)\n  - Label filters (AND/OR semantics)\n  - Path prefix filters\n  - Timestamp filters (created, updated)\n- Document sort options and ordering\n\n## File Layout Update\n\nAlso update @rules_engine/docs/lattice/appendix_file_layout.md to add\n`document_filter.rs` to the index/ section with description:\n\"Query builder for document filtering and sorting\"\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T12:05:20.869072-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:05:52.113561-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.6.5","depends_on_id":"dr-epv.6","type":"parent-child","created_at":"2026-01-17T12:05:20.869748-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.6.5","depends_on_id":"dr-epv.6.4","type":"blocks","created_at":"2026-01-17T12:05:32.207215-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.6.6","title":"Index Core Additions Post-Implementation Review","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nPerform structural review of the Index Core Additions feature implementation\nfor completeness and specification compliance.\n\n## Review Reference\n\n- Implementation plan: @rules_engine/docs/lattice/lattice_implementation_plan.md\n- Feature section: \"Index Core (Continued)\"\n- Work items: I9, I10, I11, I12, I13\n\n## Review Questions\n\n1. **Scope Completeness**: Was the scope in the implementation plan complete?\n   - Are there items that should have been included but were missed?\n   - Are there items required for downstream features that are now missing?\n\n2. **Specification Compliance**: Does the implementation fully satisfy the spec?\n   - All query functions implemented with correct signatures?\n   - Error handling follows LatticeError patterns?\n   - Edge cases handled (empty tables, missing entries, concurrent access)?\n   - Documentation complete and accurate?\n\n## Actions Required\n\nAfter review, address any gaps by:\n1. Updating documentation if spec was unclear\n2. Adding work items to a *future* implementation plan milestone (not current)\n3. Fixing immediately if critical for downstream features\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T12:05:21.040519-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:05:52.228852-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.6.6","depends_on_id":"dr-epv.6","type":"parent-child","created_at":"2026-01-17T12:05:21.041271-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.6.6","depends_on_id":"dr-epv.6.5","type":"blocks","created_at":"2026-01-17T12:05:33.237685-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.7","title":"First Working Command (lat show)","description":"End-to-end working `lat show` command that validates the entire Lattice pipeline.\n\n## Goal\n\nAfter this feature is complete, `lat show \u003cid\u003e` works against real repositories.\nThis is the first milestone where all core systems (Foundation, Git Layer, Document\nModel, Index Core, CLI Framework) integrate into a working command.\n\n## Reference Documentation\n\n- Design: @rules_engine/docs/lattice/lattice_design.md\n- Implementation plan: @rules_engine/docs/lattice/lattice_implementation_plan.md\n- Workflow commands: @rules_engine/docs/lattice/appendix_workflow.md (lat show section)\n- CLI structure: @rules_engine/docs/lattice/appendix_cli_structure.md\n- Startup operations: @rules_engine/docs/lattice/appendix_startup_operations.md\n\n## Scope\n\n- S1: Show Command Implementation (show_executor.rs, document_formatter.rs, output_formats.rs)\n- S2: Startup Operations (startup.rs or command_dispatch.rs integration)\n","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2026-01-17T12:10:20.685038-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:12:18.005413-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.7","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-17T12:10:20.689646-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.7.1","title":"Show command document lookup and task formatting","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the core `lat show` functionality for looking up documents and formatting\ntask output.\n\n## Scope\n\n- Implement show_executor.rs entry point and orchestration logic\n- Query index to lookup document by Lattice ID\n- Handle not-found case with appropriate error message\n- Implement task document formatting in document_formatter.rs:\n  - Header line: `\u003cid\u003e: \u003cname\u003e - \u003cdescription\u003e`\n  - Metadata block: state, priority, type, timestamps\n  - Body content display\n  - Parent reference (directory root document)\n  - Dependencies section (blocked-by tasks)\n  - Blocking section (tasks this blocks)\n  - Related documents section (linked from body, excluding deps/blocking/parent)\n- Compute task state from filesystem path (closed if in .closed/, blocked if blockers open)\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/commands/show_command/show_executor.rs`\n- `@rules_engine/src/lattice/src/cli/commands/show_command/document_formatter.rs`\n\n## Reference\n\n- Output format: @rules_engine/docs/lattice/appendix_workflow.md (Task Display Format section)\n\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-17T12:10:33.635085-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:12:40.373454-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.7.1","depends_on_id":"dr-epv.7","type":"parent-child","created_at":"2026-01-17T12:10:33.635923-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.7.1","depends_on_id":"dr-epv.7.6","type":"blocks","created_at":"2026-01-17T12:12:05.22771-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.7.2","title":"Show command knowledge base formatting and related documents","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement knowledge base document display and related documents logic for `lat show`.\n\n## Scope\n\n- Add knowledge base document formatting to document_formatter.rs:\n  - Header: `\u003cid\u003e: \u003cname\u003e - \u003cdescription\u003e` (same as tasks)\n  - Full markdown body content between separators\n  - Related documents section\n- Implement related document selection algorithm:\n  - Extract documents linked from body text (markdown links with Lattice IDs)\n  - Exclude documents already shown in dependencies, blocking, or parent sections\n  - Order by first appearance in body text\n  - Limit to 10 documents in text output\n  - Highlight root documents preferentially\n- Use consistent document reference format throughout:\n  - Tasks: `\u003cid\u003e: \u003cname\u003e - \u003cdescription\u003e [P\u003cN\u003e]` or `[P\u003cN\u003e/closed]`\n  - Knowledge base: `\u003cid\u003e: \u003cname\u003e - \u003cdescription\u003e [doc]`\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/commands/show_command/document_formatter.rs`\n\n## Reference\n\n- KB format: @rules_engine/docs/lattice/appendix_workflow.md (Knowledge Base Display Format)\n- Document reference format: @rules_engine/docs/lattice/appendix_workflow.md (Document Reference Format)\n\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-17T12:10:42.883892-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:12:40.486458-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.7.2","depends_on_id":"dr-epv.7","type":"parent-child","created_at":"2026-01-17T12:10:42.884673-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.7.2","depends_on_id":"dr-epv.7.1","type":"blocks","created_at":"2026-01-17T12:12:05.989313-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.7.3","title":"Show command output modes","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement all output mode variations for `lat show`.\n\n## Scope\n\nCreate output_formats.rs and implement each output mode:\n\n- **--short**: Single-line output\n  - Tasks: `\u003cid\u003e [\u003cstate\u003e] \u003cpriority\u003e \u003ctype\u003e: \u003cname\u003e - \u003cdescription\u003e`\n  - KB: `\u003cid\u003e [doc]: \u003cname\u003e - \u003cdescription\u003e`\n\n- **--peek**: Condensed preview\n  - `\u003cid\u003e: \u003cname\u003e - \u003cdescription\u003e [P\u003cN\u003e/\u003cstate\u003e/\u003ctype\u003e]`\n  - `Parent: \u003cid\u003e | Blocks: \u003cN\u003e | Depends: \u003cN\u003e`\n\n- **--refs**: References to this document\n  - List tasks blocked by this document\n  - List documents that link to this document (backlinks)\n  - Include line numbers for inline references\n\n- **--raw**: Skip template composition, show only document's own content\n  - Omit Context and Acceptance Criteria sections from ancestors\n  - (Template composition itself is implemented in a later feature)\n\n- **--json**: Structured JSON output\n  - Full JSON schema per appendix_workflow.md specification\n  - Include all fields: id, name, description, body, state, priority, task_type,\n    timestamps, path, labels, dependencies, dependents, related, parent, claimed\n  - Return as array even for single document (consistency)\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/commands/show_command/mod.rs` (add output_formats module)\n- `@rules_engine/src/lattice/src/cli/commands/show_command/output_formats.rs` (new file)\n- `@rules_engine/src/lattice/src/cli/commands/show_command/show_executor.rs` (integrate modes)\n\n## Reference\n\n- All formats: @rules_engine/docs/lattice/appendix_workflow.md (lat show section)\n\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-17T12:10:54.06408-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:12:40.596717-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.7.3","depends_on_id":"dr-epv.7","type":"parent-child","created_at":"2026-01-17T12:10:54.064834-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.7.3","depends_on_id":"dr-epv.7.2","type":"blocks","created_at":"2026-01-17T12:12:06.844768-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.7.4","title":"Show command view tracking and multiple documents","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement view tracking and multiple document display for `lat show`.\n\n## Scope\n\n**View Tracking:**\n- Record view when document is shown via `lat show`\n- Call view tracking functions from index module (I7: view_tracking.rs)\n- Increment view count and update last-viewed timestamp\n- Views are tracked in SQLite, not in the document files\n- Views influence `lat overview` ranking\n\n**Multiple Document Support:**\n- Handle `lat show \u003cid1\u003e \u003cid2\u003e ...` with multiple IDs\n- Display each document in sequence\n- Separate documents with blank lines in text output\n- Return as JSON array for --json output\n- Record view for each document shown\n\n**Error Handling:**\n- If any ID not found, report error but continue showing found documents\n- Exit code reflects whether all documents were found\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/commands/show_command/show_executor.rs`\n\n## Reference\n\n- View tracking: @rules_engine/docs/lattice/appendix_indexing.md (views table)\n- Multiple docs: @rules_engine/docs/lattice/appendix_workflow.md (Multiple Documents section)\n\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-17T12:11:02.776179-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:12:40.705625-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.7.4","depends_on_id":"dr-epv.7","type":"parent-child","created_at":"2026-01-17T12:11:02.776897-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.7.4","depends_on_id":"dr-epv.7.3","type":"blocks","created_at":"2026-01-17T12:12:07.685313-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.7.5","title":"Startup operations framework and log rotation","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nCreate the startup operations framework that runs before every `lat` command.\n\n## Scope\n\n**Framework:**\n- Create startup.rs module or integrate startup logic into command_dispatch.rs\n- Define trait/interface for startup operations\n- Execute all startup operations before command dispatch\n- Operations must be idempotent, atomic, and tolerant of concurrent execution\n\n**Log Rotation:**\n- Check `.lattice/logs.jsonl` file size at startup\n- If size \u003e 10MB, rotate to `logs.jsonl.1` (overwrite existing backup)\n- Create fresh log file after rotation\n- Use atomic rename operation for rotation\n- Handle case where .1 file already exists\n\n**--no-startup Flag:**\n- Add hidden `--no-startup` flag to global options\n- When set, skip all startup operations (for debugging only)\n- Document that this may cause stale data issues\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/startup.rs` (new file)\n  OR integrate into `@rules_engine/src/lattice/src/cli/command_dispatch.rs`\n- `@rules_engine/src/lattice/src/cli/global_options.rs` (add --no-startup flag)\n- `@rules_engine/src/lattice/src/cli/mod.rs` (add module declaration if new file)\n\n## Reference\n\n- Design: @rules_engine/docs/lattice/appendix_startup_operations.md\n- Concurrency requirements: Operations must handle multiple concurrent `lat` processes\n\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T12:11:13.10413-08:00","created_by":"dthurn","updated_at":"2026-01-17T13:30:02.413657-08:00","closed_at":"2026-01-17T13:30:02.413657-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.7.5","depends_on_id":"dr-epv.7","type":"parent-child","created_at":"2026-01-17T12:11:13.10489-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.7.6","title":"Startup reconciliation integration and performance monitoring","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nIntegrate index reconciliation into startup operations and add performance monitoring.\n\n## Scope\n\n**Reconciliation Integration:**\n- Call reconciliation coordinator at startup\n- Use fast-path check: if HEAD unchanged and no uncommitted .md changes, skip\n- For the \"First Working Command\" milestone, ensure at minimum full rebuild works\n- Full rebuild is triggered by: missing index, schema mismatch, or corruption\n- Incremental reconciliation may be partially implemented or stubbed\n\n**Additional Startup Hooks (Stubs):**\n- Add hook point for skill symlink sync (implemented in Skill Integration feature)\n- Add hook point for claim cleanup (implemented in Claim System feature)\n- These can be no-ops initially if those features aren't complete\n\n**Performance Monitoring:**\n- Track total startup operation time\n- If startup exceeds 100ms, emit debug log entry for investigation\n- Target performance budget:\n  - Fast path: \u003c20ms total\n  - Incremental: \u003c500ms typical\n  - Full rebuild: seconds (acceptable for initial or corrupted index)\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/startup.rs` or command_dispatch.rs\n- Uses: `@rules_engine/src/lattice/src/index/reconciliation/reconciliation_coordinator.rs`\n\n## Reference\n\n- Performance targets: @rules_engine/docs/lattice/appendix_startup_operations.md\n- Reconciliation: @rules_engine/docs/lattice/appendix_indexing.md (Reconciliation section)\n\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T12:11:24.759542-08:00","created_by":"dthurn","updated_at":"2026-01-17T13:57:38.0223-08:00","closed_at":"2026-01-17T13:57:38.0223-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.7.6","depends_on_id":"dr-epv.7","type":"parent-child","created_at":"2026-01-17T12:11:24.760223-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.7.6","depends_on_id":"dr-epv.7.5","type":"blocks","created_at":"2026-01-17T12:12:04.496978-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.7.7","title":"First Working Command post-implementation review","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nPost-implementation structural review of the First Working Command (lat show) feature.\n\n## Purpose\n\nEnsure the First Working Command feature is complete and properly integrated before\nmoving on to subsequent features.\n\n## Review Questions\n\n**1. Scope Completeness**\n- Was the scope in @rules_engine/docs/lattice/lattice_implementation_plan.md complete?\n- Are there items which should have been included but weren't implemented?\n- Are there gaps that will block later features?\n\n**2. Specification Compliance**\n- Does the implementation fully satisfy the specification?\n- Are all output formats (text, --short, --peek, --refs, --raw, --json) working?\n- Are edge cases handled:\n  - Non-existent IDs\n  - Multiple documents\n  - Documents in .closed/ directories\n  - Documents with/without dependencies\n  - Tasks vs knowledge base documents\n\n**3. Integration Points**\n- Does startup reconciliation correctly populate the index?\n- Does view tracking record views correctly?\n- Are related documents correctly identified and excluded from deps/blocking?\n\n## Actions if Issues Found\n\n1. Update documentation in @rules_engine/docs/lattice/ if specs were unclear\n2. Add a *future* implementation plan milestone for missing scope (do not modify\n   current milestone features that are marked [DONE])\n3. Fix critical issues immediately if they block the milestone goal\n   (\"lat show \u003cid\u003e works against real repositories\")\n\n## Reference\n\n- Implementation plan: @rules_engine/docs/lattice/lattice_implementation_plan.md\n- Show command spec: @rules_engine/docs/lattice/appendix_workflow.md\n- Startup spec: @rules_engine/docs/lattice/appendix_startup_operations.md\n\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-17T12:11:36.645218-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:12:41.041136-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.7.7","depends_on_id":"dr-epv.7","type":"parent-child","created_at":"2026-01-17T12:11:36.646032-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.7.7","depends_on_id":"dr-epv.7.4","type":"blocks","created_at":"2026-01-17T12:12:08.717119-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.8","title":"Index Reconciliation","description":"Feature: Keep SQLite index in sync with git repository state.\n\n## Overview\n\nThe reconciliation system ensures the SQLite index remains consistent with the git repository. It runs at the start of every `lat` command as part of startup operations.\n\n## Key Requirements\n\n- **Fast path** (~1ms): Skip if HEAD unchanged and no uncommitted `.md` changes\n- **Incremental path** (~50-500ms): Re-parse only changed files since last index update\n- **Full rebuild** (seconds): Triggered by missing index, schema mismatch, or corruption\n- **Concurrent safety**: Multiple `lat` processes may run simultaneously\n- **Performance target**: \u003c100ms total startup for fast path\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/appendix_indexing.md#reconciliation\n- @rules_engine/docs/lattice/appendix_startup_operations.md\n- @rules_engine/docs/lattice/lattice_implementation_plan.md (Feature: Index Reconciliation)\n\n## Dependencies\n\n- Depends on: Index Core (I1-I9), Git Layer, Document Model","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-17T12:14:51.923945-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:14:55.820868-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.8","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-17T12:14:51.926316-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.8.1","title":"Reconciliation Coordinator","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the reconciliation coordinator as the entry point for index synchronization.\n\n## File Location\n\n- `rules_engine/src/lattice/src/index/reconciliation/reconciliation_coordinator.rs`\n- `rules_engine/src/lattice/src/index/reconciliation/mod.rs` (module declarations only)\n\n## Implementation Requirements\n\n- Entry point function called from CLI startup operations\n- Accept GitOps trait object and Index connection\n- Determine which reconciliation strategy to use based on repository state\n- Delegate to appropriate strategy (fast path, incremental, or full rebuild)\n- Return result indicating what action was taken (skipped, incremental, rebuilt)\n- Log reconciliation decisions and timing via tracing\n\n## Strategy Selection Logic\n\n1. Check if index exists → if not, trigger full rebuild\n2. Check schema version → if mismatch, trigger full rebuild\n3. Call change detection to determine if fast path applies\n4. Otherwise, call incremental or full rebuild as appropriate\n\n## Error Handling\n\n- Any error during reconciliation should trigger full rebuild attempt\n- If rebuild also fails, propagate error to caller\n- Use `LatticeError` for recoverable issues, panic for corruption\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_indexing.md#reconciliation\n- @rules_engine/docs/lattice/appendix_file_layout.md (index/ section)\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T12:15:07.331379-08:00","created_by":"dthurn","updated_at":"2026-01-17T13:34:31.554253-08:00","closed_at":"2026-01-17T13:34:31.554253-08:00","close_reason":"Closed","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.8.1","depends_on_id":"dr-epv.8","type":"parent-child","created_at":"2026-01-17T12:15:07.332112-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.8.2","title":"Change Detection","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement change detection to determine if the index needs updating.\n\n## File Location\n\n- `rules_engine/src/lattice/src/index/reconciliation/change_detection.rs`\n\n## Implementation Requirements\n\n- Compare current HEAD commit against `index_metadata.last_commit`\n- Check for uncommitted `.md` changes via `git status --porcelain -- '*.md'`\n- Determine if fast path applies (HEAD unchanged AND no uncommitted changes)\n- Return enum indicating: NoChanges, CommittedChanges, UncommittedChanges, Both\n\n## Functions to Implement\n\n- `detect_changes(git: \u0026dyn GitOps, index: \u0026Index) -\u003e Result\u003cChangeStatus\u003e`\n- `get_changed_files(git: \u0026dyn GitOps, from_commit: \u0026str) -\u003e Result\u003cVec\u003cPathBuf\u003e\u003e`\n- `get_uncommitted_changes(git: \u0026dyn GitOps) -\u003e Result\u003cVec\u003cPathBuf\u003e\u003e`\n\n## Git Integration\n\n- Use `git rev-parse HEAD` to get current commit\n- Use `git diff --name-only \u003clast_commit\u003e..HEAD -- '*.md'` for committed changes\n- Use `git status --porcelain -- '*.md'` for uncommitted changes\n- Handle case where last_commit is None (first run after index creation)\n\n## Performance Requirements\n\n- Fast path check must complete in \u003c5ms\n- Avoid unnecessary git calls when possible\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_indexing.md#reconciliation\n- @rules_engine/docs/lattice/appendix_startup_operations.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-17T12:15:17.642394-08:00","created_by":"dthurn","updated_at":"2026-01-17T13:41:55.153528-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.8.2","depends_on_id":"dr-epv.8","type":"parent-child","created_at":"2026-01-17T12:15:17.643136-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.8.2","depends_on_id":"dr-epv.8.1","type":"blocks","created_at":"2026-01-17T12:15:22.259625-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.8.3","title":"Sync Strategies","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nImplement the three reconciliation strategies: fast path, incremental sync, and full rebuild.\n\n## File Location\n\n- `rules_engine/src/lattice/src/index/reconciliation/sync_strategies.rs`\n\n## Fast Path Strategy\n\n- When HEAD unchanged and no uncommitted changes\n- Simply return success without modifying index\n- Log that fast path was taken\n\n## Incremental Sync Strategy\n\n- Parse changed files from git diff result\n- For each modified file: re-parse document, update index entry\n- For each deleted file: remove from index\n- Update links, labels tables for affected documents\n- Update FTS index for affected documents\n- Update last_commit in index_metadata\n\n## Full Rebuild Strategy\n\n- Delete existing index (drop all tables or delete file)\n- Create schema from scratch via schema_definition module\n- Enumerate all `.md` files via `git ls-files '*.md'`\n- Parse each document and insert into index\n- Populate links, labels, directory_roots tables\n- Build FTS index\n- Run `PRAGMA optimize` and `INSERT INTO fts_content(fts_content) VALUES('optimize')`\n\n## Conflict Handling\n\n- Skip files with conflict markers (`\u003c\u003c\u003c\u003c\u003c\u003c\u003c`, `=======`, `\u003e\u003e\u003e\u003e\u003e\u003e\u003e`)\n- Log warning for each skipped conflicted file\n- Continue processing other files\n\n## Schema Migration\n\n- Check schema version in index_metadata against current code version\n- If mismatch, trigger full rebuild\n\n## Performance Requirements\n\n- Incremental sync: \u003c500ms for typical daily changes\n- Full rebuild: \u003c30s for 10,000 documents\n\n## Reference\n\n- @rules_engine/docs/lattice/appendix_indexing.md#reconciliation\n- @rules_engine/docs/lattice/appendix_indexing.md#full-text-search\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T12:15:34.810909-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:16:32.38338-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.8.3","depends_on_id":"dr-epv.8","type":"parent-child","created_at":"2026-01-17T12:15:34.8116-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.8.3","depends_on_id":"dr-epv.8.2","type":"blocks","created_at":"2026-01-17T12:15:38.22958-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.8.4","title":"Index Metadata Integration","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nIntegrate index metadata query functions into the reconciliation workflow.\n\n## Context\n\nIndex Core (I9) implements the index_metadata query functions. This task integrates those functions into reconciliation.\n\n## File Location\n\n- Updates to `rules_engine/src/lattice/src/index/reconciliation/reconciliation_coordinator.rs`\n- Updates to `rules_engine/src/lattice/src/index/reconciliation/sync_strategies.rs`\n\n## Integration Points\n\n- Use `get_last_commit()` in change detection to check if HEAD changed\n- Use `get_metadata()` to retrieve schema version for migration check\n- Call `set_last_commit()` after successful reconciliation to record new HEAD\n- Call `touch_last_indexed()` to update timestamp\n\n## Workflow Integration\n\n1. At start of reconciliation: call `get_last_commit()` for fast path check\n2. After incremental sync: call `set_last_commit(current_head)`\n3. After full rebuild: call `set_last_commit(current_head)`\n4. On any successful path: update `last_indexed` timestamp\n\n## Error Handling\n\n- If metadata retrieval fails, trigger full rebuild\n- If metadata update fails after reconciliation, log warning but don't fail command\n\n## Reference\n\n- @rules_engine/docs/lattice/lattice_implementation_plan.md (I9: Index Metadata Query Functions)\n- @rules_engine/docs/lattice/appendix_indexing.md#index_metadata\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T12:15:48.345405-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:16:32.495395-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.8.4","depends_on_id":"dr-epv.8","type":"parent-child","created_at":"2026-01-17T12:15:48.346143-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.8.4","depends_on_id":"dr-epv.8.3","type":"blocks","created_at":"2026-01-17T12:15:52.24672-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.8.5","title":"Index Reconciliation Post-Implementation Review","description":"\u003c!-- BEADS_TEMPLATE_START --\u003e\n# INTRODUCTION\n\nYou are implementing the Lattice document management tool.\n\nPrimary design doc: @rules_engine/docs/lattice/lattice_design.md\n\nPlease complete exactly one task, provided below. Please put the bead ID at the\nstart of your commit message in [square brackets].\n\n# YOUR TASK\n\n\u003c!-- BEADS_TASK_BODY_START --\u003e\nPerform post-implementation structural review of the Index Reconciliation feature.\n\n## Review Questions\n\n### Scope Completeness\n1. Was the scope in `lattice_implementation_plan.md` complete?\n2. Are there items which should have been included but are now missing?\n3. Are any items required for later work that were not addressed?\n\n### Specification Compliance\n1. Does the implementation fully satisfy the specification?\n2. Are all edge cases from the design documents handled?\n3. Are performance targets being met (\u003c5ms fast path, \u003c500ms incremental)?\n\n## Checklist\n\n- [ ] All files from `appendix_file_layout.md` index/reconciliation/ created\n- [ ] Reconciliation runs automatically at CLI startup\n- [ ] Fast path correctly skips when HEAD unchanged\n- [ ] Incremental sync correctly handles git diff output\n- [ ] Full rebuild triggered on schema mismatch\n- [ ] Conflict marker files are skipped with warnings\n- [ ] Concurrent `lat` processes handled safely (SQLite busy_timeout)\n- [ ] Logging via tracing captures reconciliation decisions\n- [ ] Tests exist in `tests/lattice/index/reconciliation_tests.rs`\n\n## Resolution Actions\n\nIf issues are found:\n1. Update documentation if specification was incomplete\n2. Add future implementation plan milestone for missing features (do NOT modify current milestone)\n3. Fix immediately if critical and small\n\n## Reference\n\n- @rules_engine/docs/lattice/lattice_implementation_plan.md (Feature: Index Reconciliation)\n- @rules_engine/docs/lattice/appendix_indexing.md\n- @rules_engine/docs/lattice/appendix_startup_operations.md\n- @rules_engine/docs/lattice/appendix_file_layout.md\n\u003c!-- BEADS_TASK_BODY_END --\u003e\n\n\n# TASK TRACKING\n\nIssue IDs with `dr-` prefix (e.g., `dr-l3x`) are `bd` issues. Close your task when complete.\n\n- DO NOT `bd close` this bead yourself! The coordinator will do so.\n- Use TodoWrite for in-session progress tracking\n- Do NOT run `bd sync`\n- Do not modify files outside your task scope; file new beads instead\n- Track discovered work via `bd create` (see AGENTS.md for full command reference)\n\n# ACCEPTANCE CRITERIA\n\n## Code Style\n\nFollow all rules in AGENTS.md. Key project-specific conventions:\n- Function calls and enum values: exactly one qualifier (e.g., `move_card::run()`)\n- Struct/enum type names: zero qualifiers (e.g., `BattleState`, not `battle::BattleState`)\n- No `pub use` declarations\n- No code in `mod.rs`/`lib.rs` except module declarations\n- No `use` declarations inside function bodies\n\n## Code Review\n\nReview your work against @rules_engine/docs/lattice/appendix_code_review.md.\n\nCritical points:\n- Expected errors → `LatticeError`; system errors → `panic!` with reason\n- Write high-quality, non duplicative tests\n- Create high-quality, useful logs via `tracing`\n- Functions \u003c 50 lines, files \u003c 500 lines\n- Aggressively refactor code to remove duplication\n\n## Completion Checklist\n\n1. Run `just fmt` then `just review`\n2. Create git commit with detailed description and a '# Manual Testing\n   Instructions' commit message section (\u003c 10 lines) with information about\n   how to validate changes.\n\n\u003c!-- BEADS_TEMPLATE_END --\u003e","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T12:16:03.746218-08:00","created_by":"dthurn","updated_at":"2026-01-17T12:16:32.604699-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.8.5","depends_on_id":"dr-epv.8","type":"parent-child","created_at":"2026-01-17T12:16:03.746964-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.8.5","depends_on_id":"dr-epv.8.4","type":"blocks","created_at":"2026-01-17T12:16:07.59625-08:00","created_by":"dthurn"}]}
{"id":"dr-in8","title":"Implement Output Formatting","description":"Implement text, JSON, and pretty output formatters for Lattice CLI.\n\n## Scope\n\n- **Text Formatter**: Human-readable plain text output\n- **JSON Formatter**: Structured serde serialization for `--json` mode\n- **Pretty Formatter**: Visual trees and colored output using color theme\n- Consistent document reference format: `\u003cid\u003e: \u003cname\u003e - \u003cdescription\u003e [\u003ctype\u003e]`\n\n## Implementation Notes\n\n- Create an `OutputFormat` enum or trait to abstract formatting\n- JSON output should use serde_json with consistent field naming\n- Pretty formatter should use Unicode box-drawing characters for trees\n- Handle long descriptions with truncation and ellipsis\n\n## Reference Documentation\n\n- @rules_engine/docs/lattice/appendix_cli_structure.md (output format examples)\n- @rules_engine/docs/lattice/appendix_workflow.md (lat show output format)\n\n## Dependencies\n\n- Uses color theme from `@rules_engine/src/lattice/src/cli/color_theme.rs`\n\n## Files\n\n- `@rules_engine/src/lattice/src/cli/output_format.rs`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:10:30.161019-08:00","created_by":"dthurn","updated_at":"2026-01-16T21:11:57.134679-08:00","closed_at":"2026-01-16T21:11:57.134679-08:00","close_reason":"Recreating as hierarchical children of dr-epv","labels":["lattice"],"dependencies":[{"issue_id":"dr-in8","depends_on_id":"dr-beu","type":"blocks","created_at":"2026-01-16T21:10:35.58991-08:00","created_by":"dthurn"}]}
