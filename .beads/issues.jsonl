{"id":"dr-epv","title":"Lattice Document System Implementation","description":"Lattice is a unified knowledge base and task tracking system built on markdown files stored in git repositories, with SQLite providing an ephemeral index for query performance.\n\n## Core Innovation\n\nLattice treats markdown documents as first-class database entities while maintaining full git compatibility and human readability. Documents can exist anywhere in a project hierarchy, colocated with relevant code, and are identified by their `lattice-id` YAML annotation rather than filesystem location.\n\n## Design Philosophy\n\n- **Document Atomicity**: 500-line soft limit encourages focused documentation\n- **Git as Source of Truth**: SQLite serves exclusively as a performance cache\n- **Bulletproof Self-Healing**: Graceful error recovery with clear human-readable messages\n- **No Background Daemons**: Maintenance operations run opportunistically before commands\n\n## Key Features\n\n- YAML frontmatter for metadata (lattice-id, name, description, task tracking)\n- ID-based linking with automatic path resolution via `lat fmt`\n- Task tracking (bug/feature/task/chore) with blocking/blocked-by dependencies\n- Filesystem-based state: open tasks vs `.closed/` directory\n- Claude Skill integration (documents with `skill: true` become Skills)\n- Full-text search via FTS5\n- Comprehensive linting and validation\n\n## Design Documents\n\nMain design: @rules_engine/docs/lattice/lattice_design.md\n\n### Core Systems\n- ID System: @rules_engine/docs/lattice/appendix_id_system.md\n- Indexing: @rules_engine/docs/lattice/appendix_indexing.md\n- Linking System: @rules_engine/docs/lattice/appendix_linking_system.md\n- Error Handling: @rules_engine/docs/lattice/appendix_error_handling.md\n\n### Task \u0026 Workflow\n- Task Tracking: @rules_engine/docs/lattice/appendix_task_tracking.md\n- Task Templates: @rules_engine/docs/lattice/appendix_task_templates.md\n- Workflow Commands: @rules_engine/docs/lattice/appendix_workflow.md\n- Overview Command: @rules_engine/docs/lattice/appendix_overview_command.md\n\n### CLI \u0026 Validation\n- CLI Structure: @rules_engine/docs/lattice/appendix_cli_structure.md\n- Linter Rules: @rules_engine/docs/lattice/appendix_linter.md\n- Doctor Command: @rules_engine/docs/lattice/appendix_doctor.md\n\n### Integration\n- Git Integration: @rules_engine/docs/lattice/appendix_git_integration.md\n- Git Edge Cases: @rules_engine/docs/lattice/appendix_git_edge_cases.md\n- AI Integration: @rules_engine/docs/lattice/appendix_ai_integration.md\n- Configuration: @rules_engine/docs/lattice/appendix_configuration.md\n\n### Operations\n- Startup Operations: @rules_engine/docs/lattice/appendix_startup_operations.md\n- File Layout: @rules_engine/docs/lattice/appendix_file_layout.md\n\n### Testing \u0026 Quality\n- Testing Strategy: @rules_engine/docs/lattice/appendix_testing_strategy.md\n- Benchmarking: @rules_engine/docs/lattice/appendix_benchmarking.md\n- Chaos Monkey: @rules_engine/docs/lattice/appendix_chaos_monkey.md\n- Code Review: @rules_engine/docs/lattice/appendix_code_review.md\n\n## Implementation Location\n\nSource code: @rules_engine/src/lattice/\n\nThis epic serves as the parent for all Lattice implementation work. Child tasks should be created with `--parent` referencing this epic.\n","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2026-01-15T16:13:50.275342-08:00","created_by":"dthurn","updated_at":"2026-01-15T16:21:16.166011-08:00"}
{"id":"dr-epv.1","title":"Foundation: Core types, error handling, logging, configuration","description":"Core infrastructure that all other Lattice modules depend on. This feature must be completed before any other work can begin.\n\n## Scope\n\n- Error types and handling patterns (`LatticeError` enum)\n- Lattice ID system (generation, validation, encoding)\n- JSONL logging infrastructure\n- Configuration loading (layered: defaults → user → repo → env → CLI)\n\n## Design References\n\n- Error handling: @rules_engine/docs/lattice/appendix_error_handling.md\n- ID system: @rules_engine/docs/lattice/appendix_id_system.md\n- Configuration: @rules_engine/docs/lattice/appendix_configuration.md\n- Main design: @rules_engine/docs/lattice/lattice_design.md\n\n## Exports\n\n- `LatticeId` type with parsing/validation\n- `LatticeError` enum with all variants\n- `LatticeResult\u003cT\u003e` type alias\n- Logging macros and JSONL writer\n- `Config` struct with layered loading\n","status":"open","priority":1,"issue_type":"feature","created_at":"2026-01-15T16:15:55.629387-08:00","created_by":"dthurn","updated_at":"2026-01-15T16:22:46.490876-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1","depends_on_id":"dr-epv","type":"parent-child","created_at":"2026-01-15T16:15:55.630127-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1.1","title":"Error Types: LatticeError enum and error handling infrastructure","description":"# INTRODUCTION\n\nYou are working on implementing the Lattice document management tool. The primary\ndesign document for Lattice is @rules_engine/docs/lattice/lattice_design.md\n\n\n# YOUR TASK\n\nDefine the error handling infrastructure for Lattice, distinguishing between user errors (recoverable) and system errors (panics).\n\n## Files to Create\n\n- `error/error_types.rs` - `LatticeError` enum with all variants\n- `error/error_formatting.rs` - `Display` and `Error` trait implementations\n- `error/exit_codes.rs` - Exit code constants (0=success, 1=system, 2=validation, 3=user, 4=not found)\n- `error/structured_output.rs` - JSON error serialization for `--json` mode\n\n## Implementation Notes\n\n- Use `thiserror` crate for derive macros\n- Integrate `human-panic` crate for panic formatting\n- Follow the expected/unexpected error distinction from design doc\n- Provide clear guidance messages for user errors\n- Log extensively for system errors\n\n## Design Reference\n\n- @rules_engine/docs/lattice/appendix_error_handling.md (complete error taxonomy)\n- @rules_engine/docs/lattice/lattice_design.md#error-handling\n\n\n\n# TASK TRACKING\n\nWhen you discover work outside of the scope of the current session, please track it\nvia the `bd` task software. If a prompt references something with a `dr-`\nprefix, like `dr-l3x`, this is a `bd` isssue id. When asked to work on a task, please\nclose it when complete.\n\n## Core Rules\n- Track strategic work in beads (multi-session, dependencies, discovered work)\n- Use `bd create` for issues, TodoWrite for simple single-session execution\n- When in doubt, prefer bd—persistence you don't need beats lost context\n- Session management: check `bd ready` for available work\n\n## Essential Commands\n\n### Finding Work\n- `bd list --status=open` - All open issues\n- `bd list --status=in_progress` - Your active work\n- `bd show \u003cid\u003e` - Detailed issue view with dependencies\n\n### Creating \u0026 Updating\n- `bd create --title=\"...\" --type=task|bug|feature --priority=2` - New issue\n  - Priority: 0-4 or P0-P4 (0=critical, 2=medium, 4=backlog). NOT \"high\"/\"medium\"/\"low\"\n- `bd update \u003cid\u003e --status=in_progress` - Claim work\n- `bd update \u003cid\u003e --assignee=username` - Assign to someone\n- `bd close \u003cid\u003e` - Mark complete\n- `bd close \u003cid1\u003e \u003cid2\u003e ...` - Close multiple issues at once (more efficient)\n- `bd close \u003cid\u003e --reason=\"explanation\"` - Close with reason\n\n### Dependencies \u0026 Blocking\n- `bd dep add \u003cissue\u003e \u003cdepends-on\u003e` - Add dependency (issue depends on depends-on)\n- `bd blocked` - Show all blocked issues\n- `bd show \u003cid\u003e` - See what's blocking/blocked by this issue\n\n### Sync \u0026 Collaboration\n\nDO NOT RUN `bd sync` ever. We do not use this workflow.\n\n**Completing work:**\n```bash\nbd close \u003cid1\u003e \u003cid2\u003e ...    # Close all completed issues at once\n```\n\n**Creating dependent work:**\n```bash\n# Run bd create commands in parallel (use subagents for many items)\nbd create --title=\"Implement feature X\" --type=feature\nbd create --title=\"Write tests for X\" --type=task\nbd dep add beads-yyy beads-xxx  # Tests depend on Feature (Feature blocks tests)\n```\n\n\n# ACCEPTANCE CRITERIA\n\nPlease use the TodoWrite tool to track progress on this task and adherence to acceptance criteria.\n\n## Code Style\n\nPlease follow all code style rules in AGENTS.md, in particular:\n\n- Function calls and enum values have exactly one qualifier, struct names and enum types have zero qualifiers\n- Do not \"pub use\" anything\n- Do not add code to `mod.rs` or `lib.rs` files except for module declarations\n- Do not add `use` declarations within function bodies, only place them at the top of files\n\n## Code Review\n\nOnce complete, please perform a review of your work against the code review guidelines\nin @rules_engine/docs/lattice/appendix_code_review.md, in particular:\n\n- **Classify errors:** Expected errors (user's fault) return `LatticeError`;\n  system errors (Lattice's fault) use `panic!`\n- **No silent failures:** Every significant action must be logged via `tracing`\n- **High quality logs:** Always analyze logs for usefulness\n- **Atomic operations:** Multi-step changes use temp file + rename; partial\n  failures leave consistent state\n- **Concurrency safe:** Handle concurrent `lat` invocations, TOCTOU races,\n  SQLite WAL\n- **Performance aware:** No O(n²) algorithms; batch git operations; use indices\n- **Test expected errors:** Each `LatticeError` variant should have test\n  coverage\n- **High quality tests:** Tests are not repetitive and have good assertion messages\n- **Avoid `.unwrap()`:** Use `.ok_or(LatticeError::...)?` or explicit panic with\n  reason\n- **Keep it small:** Functions under 50 lines, files under 500 lines\n- **Avoid code duplication:** Search for opportunities to factor out shared code\n- **Ensure docs are updated:** Verify relevant markdown documentation is\n  still accurate\n\n## File Follow-up tasks\n\nIf there is work remaining for this task or you notice a problem elsewhere, please\nfile a new task via `bd create`.\n\nDo not modify files outside of your task scope, file beads to track issues instead.\n\n## Formatting, Linting, and Checking\n\nWhen work is complete, please run `just fmt` and then `just review` to validate your changes.\n\n## Create git commit\n\nAfter completing all of the above steps, please create a git commit with a detailed description\nof your changes. When asked to modify your work, please amend this commit.\n\n\n## Testing Instructions\n\nAfter completing work, please mark the bead closed and update its text with a\n'# MANUAL TESTING INSTRUCTIONS' section, with short (\u003c10 lines) instructions\non how to manually verify your changes.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-15T16:16:12.921579-08:00","created_by":"dthurn","updated_at":"2026-01-15T19:59:39.558447-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1.1","depends_on_id":"dr-epv.1","type":"parent-child","created_at":"2026-01-15T16:16:12.922222-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1.2","title":"ID System: LatticeId type with generation and validation","description":"# INTRODUCTION\n\nYou are working on implementing the Lattice document management tool. The primary\ndesign document for Lattice is @rules_engine/docs/lattice/lattice_design.md\n\n\n# YOUR TASK\n\nImplement the Lattice ID system: compact, human-typeable identifiers using Base32 encoding.\n\n## Files to Create\n\n- `id/lattice_id.rs` - `LatticeId` newtype with validation\n- `id/base32_encoding.rs` - RFC 4648 Base32 encoding/decoding (alphabet: A-Z, 2-7)\n- `id/id_generator.rs` - Document counter and ID generation\n- `id/client_selection.rs` - Client ID generation with length scaling\n\n## ID Format\n\n- Structure: `L` prefix + Base32 document counter + Base32 client ID\n- Example: `LK3DTX` (document 675, client DTX)\n- Minimum 6 characters total\n- Counter starts at 50 to ensure 6+ char IDs\n\n## Implementation Notes\n\n- Validate: minimum 6 chars, valid Base32, `L` prefix\n- Client ID length scales with known client count (3-6 chars)\n- Counter recovery: scan existing documents on repo re-clone to find highest counter per client\n- Use `LatticeError` for validation failures\n\n## Design Reference\n\n- @rules_engine/docs/lattice/appendix_id_system.md (generation algorithm, collision handling)\n\n\n\n# TASK TRACKING\n\nWhen you discover work outside of the scope of the current session, please track it\nvia the `bd` task software. If a prompt references something with a `dr-`\nprefix, like `dr-l3x`, this is a `bd` isssue id. When asked to work on a task, please\nclose it when complete.\n\n## Core Rules\n- Track strategic work in beads (multi-session, dependencies, discovered work)\n- Use `bd create` for issues, TodoWrite for simple single-session execution\n- When in doubt, prefer bd—persistence you don't need beats lost context\n- Session management: check `bd ready` for available work\n\n## Essential Commands\n\n### Finding Work\n- `bd list --status=open` - All open issues\n- `bd list --status=in_progress` - Your active work\n- `bd show \u003cid\u003e` - Detailed issue view with dependencies\n\n### Creating \u0026 Updating\n- `bd create --title=\"...\" --type=task|bug|feature --priority=2` - New issue\n  - Priority: 0-4 or P0-P4 (0=critical, 2=medium, 4=backlog). NOT \"high\"/\"medium\"/\"low\"\n- `bd update \u003cid\u003e --status=in_progress` - Claim work\n- `bd update \u003cid\u003e --assignee=username` - Assign to someone\n- `bd close \u003cid\u003e` - Mark complete\n- `bd close \u003cid1\u003e \u003cid2\u003e ...` - Close multiple issues at once (more efficient)\n- `bd close \u003cid\u003e --reason=\"explanation\"` - Close with reason\n\n### Dependencies \u0026 Blocking\n- `bd dep add \u003cissue\u003e \u003cdepends-on\u003e` - Add dependency (issue depends on depends-on)\n- `bd blocked` - Show all blocked issues\n- `bd show \u003cid\u003e` - See what's blocking/blocked by this issue\n\n### Sync \u0026 Collaboration\n\nDO NOT RUN `bd sync` ever. We do not use this workflow.\n\n**Completing work:**\n```bash\nbd close \u003cid1\u003e \u003cid2\u003e ...    # Close all completed issues at once\n```\n\n**Creating dependent work:**\n```bash\n# Run bd create commands in parallel (use subagents for many items)\nbd create --title=\"Implement feature X\" --type=feature\nbd create --title=\"Write tests for X\" --type=task\nbd dep add beads-yyy beads-xxx  # Tests depend on Feature (Feature blocks tests)\n```\n\n\n# ACCEPTANCE CRITERIA\n\nPlease use the TodoWrite tool to track progress on this task and adherence to acceptance criteria.\n\n## Code Style\n\nPlease follow all code style rules in AGENTS.md, in particular:\n\n- Function calls and enum values have exactly one qualifier, struct names and enum types have zero qualifiers\n- Do not \"pub use\" anything\n- Do not add code to `mod.rs` or `lib.rs` files except for module declarations\n- Do not add `use` declarations within function bodies, only place them at the top of files\n\n## Code Review\n\nOnce complete, please perform a review of your work against the code review guidelines\nin @rules_engine/docs/lattice/appendix_code_review.md, in particular:\n\n- **Classify errors:** Expected errors (user's fault) return `LatticeError`;\n  system errors (Lattice's fault) use `panic!`\n- **No silent failures:** Every significant action must be logged via `tracing`\n- **High quality logs:** Always analyze logs for usefulness\n- **Atomic operations:** Multi-step changes use temp file + rename; partial\n  failures leave consistent state\n- **Concurrency safe:** Handle concurrent `lat` invocations, TOCTOU races,\n  SQLite WAL\n- **Performance aware:** No O(n²) algorithms; batch git operations; use indices\n- **Test expected errors:** Each `LatticeError` variant should have test\n  coverage\n- **High quality tests:** Tests are not repetitive and have good assertion messages\n- **Avoid `.unwrap()`:** Use `.ok_or(LatticeError::...)?` or explicit panic with\n  reason\n- **Keep it small:** Functions under 50 lines, files under 500 lines\n- **Avoid code duplication:** Search for opportunities to factor out shared code\n- **Ensure docs are updated:** Verify relevant markdown documentation is\n  still accurate\n\n## File Follow-up tasks\n\nIf there is work remaining for this task or you notice a problem elsewhere, please\nfile a new task via `bd create`.\n\nDo not modify files outside of your task scope, file beads to track issues instead.\n\n## Formatting, Linting, and Checking\n\nWhen work is complete, please run `just fmt` and then `just review` to validate your changes.\n\n## Create git commit\n\nAfter completing all of the above steps, please create a git commit with a detailed description\nof your changes. When asked to modify your work, please amend this commit.\n\n\n## Testing Instructions\n\nAfter completing work, please mark the bead closed and update its text with a\n'# MANUAL TESTING INSTRUCTIONS' section, with short (\u003c10 lines) instructions\non how to manually verify your changes.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-15T16:16:22.976198-08:00","created_by":"dthurn","updated_at":"2026-01-15T19:59:39.634437-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1.2","depends_on_id":"dr-epv.1","type":"parent-child","created_at":"2026-01-15T16:16:22.976848-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.1.2","depends_on_id":"dr-epv.1.1","type":"blocks","created_at":"2026-01-15T16:16:44.767351-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1.3","title":"Logging: JSONL logging infrastructure with tracing","description":"# INTRODUCTION\n\nYou are working on implementing the Lattice document management tool. The primary\ndesign document for Lattice is @rules_engine/docs/lattice/lattice_design.md\n\n\n# YOUR TASK\n\nImplement JSONL-based logging infrastructure using the tracing crate.\n\n## Files to Create\n\n- `log/jsonl_writer.rs` - JSONL file writer with rotation\n- `log/log_entry.rs` - Log entry struct (timestamp, level, operation, duration, details)\n- `log/log_reader.rs` - Log file reading utilities for debugging\n\n## Logging Behavior\n\n- Write to `.lattice/logs.jsonl`\n- Log rotation: rename to `.1` when \u003e10MB\n- Support `--verbose` flag for debug output to stderr\n- All git/SQLite/file operations must be logged\n\n## Implementation Notes\n\n- Configure `tracing` crate with custom JSONL subscriber\n- Structured logging for git operations, SQLite queries, file I/O\n- Include operation duration for performance tracking\n- Silent failure is a critical design flaw - log everything\n\n## Design Reference\n\n- @rules_engine/docs/lattice/lattice_design.md#logging\n\n\n\n# TASK TRACKING\n\nWhen you discover work outside of the scope of the current session, please track it\nvia the `bd` task software. If a prompt references something with a `dr-`\nprefix, like `dr-l3x`, this is a `bd` isssue id. When asked to work on a task, please\nclose it when complete.\n\n## Core Rules\n- Track strategic work in beads (multi-session, dependencies, discovered work)\n- Use `bd create` for issues, TodoWrite for simple single-session execution\n- When in doubt, prefer bd—persistence you don't need beats lost context\n- Session management: check `bd ready` for available work\n\n## Essential Commands\n\n### Finding Work\n- `bd list --status=open` - All open issues\n- `bd list --status=in_progress` - Your active work\n- `bd show \u003cid\u003e` - Detailed issue view with dependencies\n\n### Creating \u0026 Updating\n- `bd create --title=\"...\" --type=task|bug|feature --priority=2` - New issue\n  - Priority: 0-4 or P0-P4 (0=critical, 2=medium, 4=backlog). NOT \"high\"/\"medium\"/\"low\"\n- `bd update \u003cid\u003e --status=in_progress` - Claim work\n- `bd update \u003cid\u003e --assignee=username` - Assign to someone\n- `bd close \u003cid\u003e` - Mark complete\n- `bd close \u003cid1\u003e \u003cid2\u003e ...` - Close multiple issues at once (more efficient)\n- `bd close \u003cid\u003e --reason=\"explanation\"` - Close with reason\n\n### Dependencies \u0026 Blocking\n- `bd dep add \u003cissue\u003e \u003cdepends-on\u003e` - Add dependency (issue depends on depends-on)\n- `bd blocked` - Show all blocked issues\n- `bd show \u003cid\u003e` - See what's blocking/blocked by this issue\n\n### Sync \u0026 Collaboration\n\nDO NOT RUN `bd sync` ever. We do not use this workflow.\n\n**Completing work:**\n```bash\nbd close \u003cid1\u003e \u003cid2\u003e ...    # Close all completed issues at once\n```\n\n**Creating dependent work:**\n```bash\n# Run bd create commands in parallel (use subagents for many items)\nbd create --title=\"Implement feature X\" --type=feature\nbd create --title=\"Write tests for X\" --type=task\nbd dep add beads-yyy beads-xxx  # Tests depend on Feature (Feature blocks tests)\n```\n\n\n# ACCEPTANCE CRITERIA\n\nPlease use the TodoWrite tool to track progress on this task and adherence to acceptance criteria.\n\n## Code Style\n\nPlease follow all code style rules in AGENTS.md, in particular:\n\n- Function calls and enum values have exactly one qualifier, struct names and enum types have zero qualifiers\n- Do not \"pub use\" anything\n- Do not add code to `mod.rs` or `lib.rs` files except for module declarations\n- Do not add `use` declarations within function bodies, only place them at the top of files\n\n## Code Review\n\nOnce complete, please perform a review of your work against the code review guidelines\nin @rules_engine/docs/lattice/appendix_code_review.md, in particular:\n\n- **Classify errors:** Expected errors (user's fault) return `LatticeError`;\n  system errors (Lattice's fault) use `panic!`\n- **No silent failures:** Every significant action must be logged via `tracing`\n- **High quality logs:** Always analyze logs for usefulness\n- **Atomic operations:** Multi-step changes use temp file + rename; partial\n  failures leave consistent state\n- **Concurrency safe:** Handle concurrent `lat` invocations, TOCTOU races,\n  SQLite WAL\n- **Performance aware:** No O(n²) algorithms; batch git operations; use indices\n- **Test expected errors:** Each `LatticeError` variant should have test\n  coverage\n- **High quality tests:** Tests are not repetitive and have good assertion messages\n- **Avoid `.unwrap()`:** Use `.ok_or(LatticeError::...)?` or explicit panic with\n  reason\n- **Keep it small:** Functions under 50 lines, files under 500 lines\n- **Avoid code duplication:** Search for opportunities to factor out shared code\n- **Ensure docs are updated:** Verify relevant markdown documentation is\n  still accurate\n\n## File Follow-up tasks\n\nIf there is work remaining for this task or you notice a problem elsewhere, please\nfile a new task via `bd create`.\n\nDo not modify files outside of your task scope, file beads to track issues instead.\n\n## Formatting, Linting, and Checking\n\nWhen work is complete, please run `just fmt` and then `just review` to validate your changes.\n\n## Create git commit\n\nAfter completing all of the above steps, please create a git commit with a detailed description\nof your changes. When asked to modify your work, please amend this commit.\n\n\n## Testing Instructions\n\nAfter completing work, please mark the bead closed and update its text with a\n'# MANUAL TESTING INSTRUCTIONS' section, with short (\u003c10 lines) instructions\non how to manually verify your changes.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-15T16:16:31.260375-08:00","created_by":"dthurn","updated_at":"2026-01-15T19:59:39.714704-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1.3","depends_on_id":"dr-epv.1","type":"parent-child","created_at":"2026-01-15T16:16:31.261082-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.1.3","depends_on_id":"dr-epv.1.2","type":"blocks","created_at":"2026-01-15T16:16:44.804667-08:00","created_by":"dthurn"}]}
{"id":"dr-epv.1.4","title":"Configuration: Layered config loading from multiple sources","description":"# INTRODUCTION\n\nYou are working on implementing the Lattice document management tool. The primary\ndesign document for Lattice is @rules_engine/docs/lattice/lattice_design.md\n\n\n# YOUR TASK\n\nImplement layered configuration loading with precedence: defaults → user → repo → env vars → CLI flags.\n\n## Files to Create\n\n- `config/config_loader.rs` - Layered configuration loading logic\n- `config/config_schema.rs` - `Config` struct with all configuration fields\n- `git/client_config.rs` - Client ID storage and retrieval\n\n## Configuration Sources (in precedence order)\n\n1. Built-in defaults\n2. `~/.lattice.toml` - User config (client IDs, personal defaults)\n3. `.lattice/config.toml` - Repo config (overview weights, format settings)\n4. Environment variables (`LATTICE_*`)\n5. CLI flags (highest precedence)\n\n## Implementation Notes\n\n- Use TOML format for config files\n- All fields should have sensible defaults\n- Log config loading with sources for debugging\n- Handle missing config files gracefully\n- Validate config values are in acceptable ranges\n\n## Design Reference\n\n- @rules_engine/docs/lattice/appendix_configuration.md (complete field list and defaults)\n\n\n\n# TASK TRACKING\n\nWhen you discover work outside of the scope of the current session, please track it\nvia the `bd` task software. If a prompt references something with a `dr-`\nprefix, like `dr-l3x`, this is a `bd` isssue id. When asked to work on a task, please\nclose it when complete.\n\n## Core Rules\n- Track strategic work in beads (multi-session, dependencies, discovered work)\n- Use `bd create` for issues, TodoWrite for simple single-session execution\n- When in doubt, prefer bd—persistence you don't need beats lost context\n- Session management: check `bd ready` for available work\n\n## Essential Commands\n\n### Finding Work\n- `bd list --status=open` - All open issues\n- `bd list --status=in_progress` - Your active work\n- `bd show \u003cid\u003e` - Detailed issue view with dependencies\n\n### Creating \u0026 Updating\n- `bd create --title=\"...\" --type=task|bug|feature --priority=2` - New issue\n  - Priority: 0-4 or P0-P4 (0=critical, 2=medium, 4=backlog). NOT \"high\"/\"medium\"/\"low\"\n- `bd update \u003cid\u003e --status=in_progress` - Claim work\n- `bd update \u003cid\u003e --assignee=username` - Assign to someone\n- `bd close \u003cid\u003e` - Mark complete\n- `bd close \u003cid1\u003e \u003cid2\u003e ...` - Close multiple issues at once (more efficient)\n- `bd close \u003cid\u003e --reason=\"explanation\"` - Close with reason\n\n### Dependencies \u0026 Blocking\n- `bd dep add \u003cissue\u003e \u003cdepends-on\u003e` - Add dependency (issue depends on depends-on)\n- `bd blocked` - Show all blocked issues\n- `bd show \u003cid\u003e` - See what's blocking/blocked by this issue\n\n### Sync \u0026 Collaboration\n\nDO NOT RUN `bd sync` ever. We do not use this workflow.\n\n**Completing work:**\n```bash\nbd close \u003cid1\u003e \u003cid2\u003e ...    # Close all completed issues at once\n```\n\n**Creating dependent work:**\n```bash\n# Run bd create commands in parallel (use subagents for many items)\nbd create --title=\"Implement feature X\" --type=feature\nbd create --title=\"Write tests for X\" --type=task\nbd dep add beads-yyy beads-xxx  # Tests depend on Feature (Feature blocks tests)\n```\n\n\n# ACCEPTANCE CRITERIA\n\nPlease use the TodoWrite tool to track progress on this task and adherence to acceptance criteria.\n\n## Code Style\n\nPlease follow all code style rules in AGENTS.md, in particular:\n\n- Function calls and enum values have exactly one qualifier, struct names and enum types have zero qualifiers\n- Do not \"pub use\" anything\n- Do not add code to `mod.rs` or `lib.rs` files except for module declarations\n- Do not add `use` declarations within function bodies, only place them at the top of files\n\n## Code Review\n\nOnce complete, please perform a review of your work against the code review guidelines\nin @rules_engine/docs/lattice/appendix_code_review.md, in particular:\n\n- **Classify errors:** Expected errors (user's fault) return `LatticeError`;\n  system errors (Lattice's fault) use `panic!`\n- **No silent failures:** Every significant action must be logged via `tracing`\n- **High quality logs:** Always analyze logs for usefulness\n- **Atomic operations:** Multi-step changes use temp file + rename; partial\n  failures leave consistent state\n- **Concurrency safe:** Handle concurrent `lat` invocations, TOCTOU races,\n  SQLite WAL\n- **Performance aware:** No O(n²) algorithms; batch git operations; use indices\n- **Test expected errors:** Each `LatticeError` variant should have test\n  coverage\n- **High quality tests:** Tests are not repetitive and have good assertion messages\n- **Avoid `.unwrap()`:** Use `.ok_or(LatticeError::...)?` or explicit panic with\n  reason\n- **Keep it small:** Functions under 50 lines, files under 500 lines\n- **Avoid code duplication:** Search for opportunities to factor out shared code\n- **Ensure docs are updated:** Verify relevant markdown documentation is\n  still accurate\n\n## File Follow-up tasks\n\nIf there is work remaining for this task or you notice a problem elsewhere, please\nfile a new task via `bd create`.\n\nDo not modify files outside of your task scope, file beads to track issues instead.\n\n## Formatting, Linting, and Checking\n\nWhen work is complete, please run `just fmt` and then `just review` to validate your changes.\n\n## Create git commit\n\nAfter completing all of the above steps, please create a git commit with a detailed description\nof your changes. When asked to modify your work, please amend this commit.\n\n\n## Testing Instructions\n\nAfter completing work, please mark the bead closed and update its text with a\n'# MANUAL TESTING INSTRUCTIONS' section, with short (\u003c10 lines) instructions\non how to manually verify your changes.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-15T16:16:38.741186-08:00","created_by":"dthurn","updated_at":"2026-01-15T19:59:39.792014-08:00","labels":["lattice"],"dependencies":[{"issue_id":"dr-epv.1.4","depends_on_id":"dr-epv.1","type":"parent-child","created_at":"2026-01-15T16:16:38.74182-08:00","created_by":"dthurn"},{"issue_id":"dr-epv.1.4","depends_on_id":"dr-epv.1.3","type":"blocks","created_at":"2026-01-15T16:16:44.841773-08:00","created_by":"dthurn"}]}
